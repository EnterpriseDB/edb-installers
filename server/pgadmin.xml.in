<component>
    <name>pgAdmin</name>
    <description>pgAdmin 4</description>
    <canBeEdited>1</canBeEdited>
    <detailedDescription>${msg(pgadmin.desc)}</detailedDescription>
    <selected>1</selected>
    <folderList>
        <!-- LINUX: Program files -->
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileslinux</name>
            <platforms>linux</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/linux/pgadmin4/pgAdmin 4</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>staging/linux/pgadmin4/pgAdmin_3rd_party_licenses.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>staging/linux/pgadmin4/pgAdmin_license.txt</origin>
                </distributionFile>
            </distributionFileList>
            <ruleList>
                <compareText>
                    <logic>does_not_equal</logic>
                    <text>${platform_name}</text>
                    <value>linux-x64</value>
                </compareText>
            </ruleList>
        </folder>
        <folder>
            <description>Script Files</description>
            <destination>${installdir}</destination>
            <name>scriptfileslinux</name>
            <platforms>linux</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/linux/pgadmin4/scripts</origin>
                </distributionDirectory>
                <distributionDirectory>
                    <origin>staging/linux/pgadmin4/installer</origin>
                </distributionDirectory>
            </distributionFileList>
            <ruleList>
                <compareText>
                    <logic>does_not_equal</logic>
                    <text>${platform_name}</text>
                    <value>linux-x64</value>
                </compareText>
            </ruleList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}/server/scripts</destination>
            <name>scriptfileslinux_2</name>
            <platforms>linux4</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/linux/pgadmin4/scripts/xdg</origin>
                </distributionDirectory>
            </distributionFileList>
            <ruleList>
                <compareText>
                    <logic>does_not_equal</logic>
                    <text>${platform_name}</text>
                    <value>linux-x64</value>
                </compareText>
            </ruleList>
        </folder>
        <!-- LINUX_X64: Program files -->
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileslinux-x64</name>
            <platforms>linux-x64</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/linux-x64/pgadmin4/pgAdmin 4</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>staging/linux-x64/pgadmin4/pgAdmin_3rd_party_licenses.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>staging/linux-x64/pgadmin4/pgAdmin_license.txt</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <folder>
            <description>Script Files</description>
            <destination>${installdir}</destination>
            <name>scriptfileslinux-x64</name>
            <platforms>linux-x64</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/linux-x64/pgadmin4/scripts</origin>
                </distributionDirectory>
                <distributionDirectory>
                    <origin>staging/linux-x64/pgadmin4/installer</origin>
                </distributionDirectory>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}/server/scripts</destination>
            <name>scriptfileslinux-x64_2</name>
            <platforms>linux-x64</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/linux-x64/pgadmin4/scripts/xdg</origin>
                </distributionDirectory>
            </distributionFileList>
        </folder>
        <!-- LINUX_PPC64: Program files -->
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileslinux-ppc64</name>
            <platforms>linux-ppc</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/linux-ppc64/pgAdmin 4</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>../resources/license.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>staging/linux-ppc64/server_3rd_party_licenses.txt</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <!-- MAC: Program files -->
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfilesmacosx</name>
            <platforms>osx</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/osx/pgadmin4/pgAdmin 4.app</origin>
                </distributionDirectory>
                <distributionDirectory>
                    <origin>staging/osx/pgadmin4/installer</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>staging/osx/pgadmin4/pgAdmin_3rd_party_licenses.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>staging/osx/pgadmin4/pgAdmin_license.txt</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <!-- WIN: Program files -->
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileswindows</name>
            <platforms>windows</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/@@WINDIR@@/pgadmin4/pgAdmin 4</origin>
                </distributionDirectory>
                <distributionDirectory>
                    <origin>staging/@@WINDIR@@/pgadmin4/scripts</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>staging/@@WINDIR@@/pgadmin4/pgAdmin_3rd_party_licenses.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>staging/@@WINDIR@@/pgadmin4/pgAdmin_license.txt</origin>
                </distributionFile>
            </distributionFileList>
</folder>
        <!-- SOLARIS_X64: Program files -->
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfilessolaris-x64</name>
            <platforms>solaris-intel</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/solaris-x64/pgAdmin 4</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>../resources/license.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>staging/solaris-x64/server_3rd_party_licenses.txt</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <!-- SOLARIS_SPARC: Program files -->
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfilessolaris-sparc</name>
            <platforms>solaris-sparc</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>staging/solaris-sparc/pgAdmin 4</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>../resources/license.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>staging/solaris-sparc/server_3rd_party_licenses.txt</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
    </folderList>
    <componentSelectionValidationActionList>
        <throwError>
            <text>${msg(commandlinetools.not.selected.pgadmin.error)}</text>
            <ruleList>
                <componentTest name="commandlinetools" logic="not_selected"/>
            </ruleList>
      </throwError>
    </componentSelectionValidationActionList>

    <!-- WIN: Start Menu -->
    <startMenuShortcutList>
        <startMenuFolder>
            <name>Documentation</name>
            <platforms>windows</platforms>
            <startMenuShortcutList>
                <!-- pgAdmin -->
                <startMenuLinkShortcut>
                    <name>pgAdmin documentation</name>
                    <runInTerminal>0</runInTerminal>
                    <url>file://${installdir}/pgAdmin 4/docs/en_US/html/index.html</url>
                    <windowsIcon>${installdir}\scripts\images\pgadmin-help.ico</windowsIcon>
                    <ruleList>
                        <isTrue value="${create_shortcuts}" />
                    </ruleList>
                </startMenuLinkShortcut>
            </startMenuShortcutList>
        </startMenuFolder>
        
        <!-- pgAdmin -->
        <startMenuShortcut>
            <name>pgAdmin 4</name>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}\pgAdmin 4\bin\pgAdmin4.exe</windowsExec>
            <ruleList>
                <isTrue value="${create_shortcuts}" />
            </ruleList>
        </startMenuShortcut>
    </startMenuShortcutList>
    <!-- Postinstallation actions -->
    <postInstallationActionList>
    <!-- Remove the QtWebkit/QtWebengine files in upgrade mode -->
    <actionGroup>
        <actionList>
            <deleteFile path="${installdir}/pgAdmin 4/plugins/qtwebengine">
                <ruleList>
                    <fileExists path="${installdir}/pgAdmin 4/plugins/qtwebengine"/>
                </ruleList>
            </deleteFile>
            <deleteFile path="${installdir}/pgAdmin 4/translations">
                <ruleList>
                    <fileExists path="${installdir}/pgAdmin 4/translations"/>
                </ruleList>
            </deleteFile>
            <deleteFile path="${installdir}/pgAdmin 4/bin/qtwebengine*.pak">
                <ruleList>
                    <fileExists path="${installdir}/pgAdmin 4/bin/qtwebengine*.pak"/>
                </ruleList>
            </deleteFile>
            <deleteFile path="${installdir}/pgAdmin 4/bin/QtWebEngineProcess">
                <ruleList>
                    <fileExists path="${installdir}/pgAdmin 4/bin/QtWebEngineProcess"/>
                </ruleList>
            </deleteFile>
            <deleteFile path="${installdir}/pgAdmin 4/lib/libQt5WebEngine*">
                <ruleList>
                    <fileExists path="${installdir}/pgAdmin 4/lib/libQt5WebEngine*"/>
                </ruleList>
            </deleteFile>
            <deleteFile path="${installdir}/pgAdmin 4/lib/libQt5WebChannel.so*">
                <ruleList>
                    <fileExists path="${installdir}/pgAdmin 4/lib/libQt5WebChannel.so*"/>
                </ruleList>
            </deleteFile>
        </actionList>
        <ruleList>
             <compareText logic="contains" text="${platform_name}" value="linux"/>
        </ruleList>
    </actionGroup>
    <actionGroup>
        <actionList>
            <deleteFile path="${installdir}/pgAdmin 4/bin/Qt5WebKit*.dll">
                <ruleList>
                    <fileExists path="${installdir}/pgAdmin 4/bin/Qt5WebKit*.dll"/>
                </ruleList>
            </deleteFile>
            <deleteFile path="${installdir}/pgAdmin 4/bin/Qt5WebChannel.dll">
                <ruleList>
                    <fileExists path="${installdir}/pgAdmin 4/bin/Qt5WebChannel.dll"/>
                </ruleList>
            </deleteFile>
        </actionList>
        <ruleList>
            <compareText logic="equals" text="${platform_name}" value="windows"/>
       </ruleList>
    </actionGroup>

        <createTempDir dirPrefix="postgresql_installer"/>
        <runProgram>
            <program>${installdir}/installer/server/createshortcuts_pgadmin.sh</program>
            <programArguments>${product_version} "${branding}" "${installdir}" "${system_temp_directory}/postgresql_installer_${random_number}"</programArguments>
            <progressText>${msg(progress.text.creating.shortcuts)}</progressText>
            <abortOnError>0</abortOnError>
            <showMessageOnError>0</showMessageOnError>
                <ruleList>
                    <compareText>
                        <logic>equals</logic>
                        <text>${create_shortcuts}</text>
                        <value>1</value>
                    </compareText>
                    <compareText>
                        <logic>does_not_equal</logic>
                        <text>${platform_name}</text>
                        <value>windows</value>
                    </compareText>
                </ruleList>
        </runProgram>

        <!-- RM # 39338 Remove the webkit files-->
        <actionGroup>
            <actionList>
                <deleteFile path="${installdir}/pgAdmin 4/lib/Qt5WebEngine.dll" >
                    <ruleList>
                        <fileTest path="${installdir}/pgAdmin 4/lib/Qt5WebEngine.dll" condition="exists" />
                    </ruleList>
                </deleteFile>
                <deleteFile path="${installdir}/pgAdmin 4/lib/Qt5WebEngineWidgets.dll" >
                    <ruleList>
                        <fileTest path="${installdir}/pgAdmin 4/lib/Qt5WebEngineWidgets.dll" condition="exists" />
                    </ruleList>
                </deleteFile>
            </actionList>
            <ruleList>
                <compareText text="${platform_name}" logic="equals" value="windows" />
            </ruleList>
        </actionGroup>
        
        <actionGroup>
            <actionList>
                <deleteFile path="${installdir}/pgAdmin 4/lib/libQt5WebKit.so*" >
                    <ruleList>
                        <fileTest path="${installdir}/pgAdmin 4/lib/libQt5WebKit.so*" condition="exists" />
                    </ruleList>
                </deleteFile>
                <deleteFile path="${installdir}/pgAdmin 4/lib/libQt5WebKitWidgets.so*" >
                    <ruleList>
                    <fileTest path="${installdir}/pgAdmin 4/lib/libQt5WebKitWidgets.so*" condition="exists" />
                    </ruleList>
                </deleteFile>
            </actionList>
            <ruleList>
                <compareText text="${platform_name}" logic="contains" value="Linux" />
            </ruleList>
        </actionGroup>

        <actionGroup>
            <actionList>
                <deleteFile path="${installdir}/pgAdmin 4.app/Contents/Frameworks/QtWebEngine.framework" >
                    <ruleList>
                        <fileTest path="${installdir}/pgAdmin 4.app/Contents/Frameworks/QtWebEngine.framework" condition="exists" />
                    </ruleList>
                </deleteFile>
                <deleteFile path="${installdir}/pgAdmin 4.app/Contents/Frameworks/QtWebEngineWidgets.framework" >
                    <ruleList>
                        <fileTest path="${installdir}/pgAdmin 4.app/Contents/Frameworks/QtWebEngineWidgets.framework" condition="exists" />
                    </ruleList>
                </deleteFile>
            </actionList>
            <ruleList>
                <compareText text="${platform_name}" logic="equals" value="osx" />
            </ruleList>
        </actionGroup>

        <!-- Delete the temp scripts directory -->
        <logMessage>
            <text>Delete the temporary scripts directory...</text>
        </logMessage>
        <deleteFile>
            <path>${system_temp_directory}/postgresql_installer_${random_number}</path>
            <abortOnError>0</abortOnError>
            <showMessageOnError>0</showMessageOnError>
        </deleteFile>
        <setInstallerVariable name="pgAdmin_installation_done" value="1" persist="1"/>
    </postInstallationActionList>

    <preUninstallationActionList>
        <createTempDir dirPrefix="postgresql_installer"/>
        <actionGroup>
                <actionList>
                    <runProgram>
                        <program>${installdir}/installer/server/removeshortcuts_pgadmin.sh</program>
                        <programArguments>"${installdir}" ${product_version} "${branding}" "${system_temp_directory}/postgresql_installer_${random_number}"</programArguments>
                    </runProgram>
                </actionList>
                <ruleList>
                    <compareText>
                        <logic>contains</logic>
                        <text>${platform_name}</text>
                        <value>linux</value>
                    </compareText>
                </ruleList>
        </actionGroup>
        <!-- MAC: Remove menu shortcuts -->
        <actionGroup>
            <actionList>
                <deleteFile path="/Applications/${branding}/pgAdmin 4.app"/>
                    <deleteFile path="/Applications/${branding}/Documentation/pgAdmin*"/>
            </actionList>
            <ruleList>
                <compareText>
                    <logic>equals</logic>
                    <text>${platform_name}</text>
                    <value>osx</value>
                    </compareText>
            </ruleList>
        </actionGroup>
        <iniFileSet>
            <file>${PostgreSqlIni}</file>
            <key>pgAdmin_Version</key>
            <section>PostgreSQL/${product_version}</section>
            <value></value>
            <ruleList>
                <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
                <fileTest path="${PostgreSqlIni}" condition="exists"/>
            </ruleList>
        </iniFileSet>
        <registryDelete>
            <key>HKEY_LOCAL_MACHINE\SOFTWARE\PostgreSQL\Installations\postgresql${service_suffix}-${product_version}</key>
            <name>pgAdmin_Version</name>
            <ruleList>
                <compareText logic="equals" text="${platform_name}" value="windows"/>
            </ruleList>
        </registryDelete>

        <createTimeStamp format="%Y-%m-%d(YYYY-MM-DD) - %H:%M:%S(HH:MM:SS)" variable="timestamp"/>
        <addTextToFile file="${installdir}${slash}installation_summary.log" insertAt="end">
            <text>
===== pgAdmin 4 uninstallation completed at: ${timestamp} =====
            </text>
            <ruleList>
                <fileTest path="${installdir}${slash}installation_summary.log" condition="exists" />
            </ruleList>
        </addTextToFile>
    </preUninstallationActionList>

   <readyToInstallActionList>
       <!-- pgAdmin 3.x runs in the system tray. But, unfortunately the system tray was removed
            in GNOME version 3.26. Hence, extensions like TopIcons Plus or an equivalent needs
            to be installed on the target system if the deaktop session is GNOME and it's version
            is equal or higher than 3.26.  The user should be warned of this -->
       <actionGroup>
           <actionList>
                <showWarning text="${msg(warning.gnome.desktop)}" />
           </actionList>
           <ruleList>
               <compareVersions logic="greater_or_equal"
                   version1="${gnome_version}" version2="3.26" />
               <isTrue value="${component(pgAdmin).selected}"/>
               <compareText logic="contains" text="${current_desktop}" value="GNOME" />
               <compareText logic="contains" text="${platform_name}" value="linux"/>
               <compareText text="${installer_interactivity}" logic="equals" value="normal"/>
                 <isFalse value="${extract_mode}"/>
             </ruleList>
         </actionGroup>
         <!-- log the warning message in unattended mode -->
         <actionGroup>
             <actionList>
                 <logMessage text="${msg(warning.gnome.desktop)}" />
                 <consoleWrite text="&#xA;Warning: ${msg(warning.gnome.desktop)}&#xA;"/>
             </actionList>
             <ruleList>
                 <compareText logic="contains" text="${current_desktop}" value="GNOME" />
                 <compareVersions logic="greater_or_equal"
                             version1="${gnome_version}" version2="3.26" />
                 <compareText text="${installer_interactivity}" logic="does_not_equal" value="normal"/>
                 <!-- following check means mode equals unattended -->
                 <compareText logic="contains" text="${platform_name}" value="linux"/>
                 <isFalse value="${extract_mode}"/>
             </ruleList>
         </actionGroup>
         <!-- Always remove the old venv and web/pgadmin in upgrade -->
         <actionGroup>
             <actionList>
                 <!-- Show warning if pgAdmin server is on while doing upgrademode installation -->
                  <showWarning text="${msg(warning.upgrademode.installation)}" />
                  <logMessage text="${msg(warning.upgrademode.installation)}" />
                  <deleteFile path="${installdir}/pgAdmin 4/venv">
                     <ruleList>
                         <fileExists path="${installdir}/pgAdmin 4/venv"/>
                     </ruleList>
                 </deleteFile>
                  <deleteFile path="${installdir}/pgAdmin 4.app/Contents/Resources/venv">
                    <ruleList>
                        <fileExists path="${installdir}/pgAdmin 4.app/Contents/Resources/venv"/>
                        <compareText logic="equals" text="${platform_name}" value="osx" />
                    </ruleList>
                 </deleteFile>
                  <deleteFile path="${installdir}/pgAdmin 4/web/pgadmin">
                     <ruleList>
                         <fileExists path="${installdir}/pgAdmin 4/web/pgadmin"/>
                     </ruleList>
                 </deleteFile>
                  <deleteFile path="${installdir}/pgAdmin 4.app/Contents/Resources/web/pgadmin">
                    <ruleList>
                        <fileExists path="${installdir}/pgAdmin 4.app/Contents/Resources/web/pgadmin"/>
                        <compareText logic="equals" text="${platform_name}" value="osx" />
                    </ruleList>
                </deleteFile>
             </actionList>
             <ruleList>
                  <isFalse value="${extract_mode}"/>
                  <stringTest text="${pgadmin_version}" type="not_empty"/>
             </ruleList>
         </actionGroup>
   </readyToInstallActionList>

 <preInstallationActionList>
  <!-- Get the GNOME Version -->
  <actionGroup>
      <actionList>
          <setInstallerVariableFromScriptOutput name="current_desktop"
              exec="echo"
              execArgs="$XDG_CURRENT_DESKTOP"
              abortOnError="0" showMessageOnError="0" />
          <setInstallerVariableFromScriptOutput name="gnome_version"
              exec="echo"
              execArgs=" `gnome-shell --version | awk '{print $3}' | cut -d '.' -f1,2`"
              abortOnError="0" showMessageOnError="0" >
              <ruleList>
                  <compareText logic="contains" text="${current_desktop}" value="GNOME" />
              </ruleList>
          </setInstallerVariableFromScriptOutput>
      </actionList>
      <ruleList>
          <isTrue value="${component(pgAdmin).selected}"/>
          <compareText logic="contains" text="${platform_name}" value="linux"/>
      </ruleList>
  </actionGroup>
 </preInstallationActionList>
</component>
