set currentUser to ""
try
set currentUser to do shell script "whoami"
end try

if currentUser = "@@AGENTSERVICEUSER@@" then
  try
    set ret to do shell script "@@INSTALLDIR@@/scripts/agentctl.sh --no-wait stop > /tmp/pphq_agent_stop_@@AGENTSERVICEUSER@@.log 2>&1"
  end try
  set output to do shell script "cat /tmp/pphq_agent_stop_@@AGENTSERVICEUSER@@.log"
  set ret to do shell script "rm /tmp/pphq_agent_stop_@@AGENTSERVICEUSER@@.log"
  display dialog output buttons {"OK"} with icon 1 default button 1
else
  try
    set ret to do shell script "su @@AGENTSERVICEUSER@@ -c \"@@INSTALLDIR@@/scripts/agentctl.sh --no-wait stop> /tmp/pphq_agent_stop.log 2>&1\"" with administrator privileges
  end try
  set output to do shell script "cat /tmp/pphq_agent_stop.log" with administrator privileges
  set ret to do shell script "rm /tmp/pphq_agent_stop.log" with administrator privileges
  display dialog output buttons {"OK"} with icon 1 default button 1
end if

