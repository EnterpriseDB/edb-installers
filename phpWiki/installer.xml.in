
<project>
    <!-- Package details -->
    <shortName>phpWiki</shortName>
    <fullName>phpWiki</fullName>
    <version>PG_PHPWIKI_VERSION</version>
    
    <!-- Windows Specific Options -->
    <startMenuGroupName>PostgreSQL</startMenuGroupName>

    <!-- product Specific Options -->	
    <productComments>${product_fullname} ${product_version} by EnterpriseDB</productComments>
    <productDisplayName>phpWiki ${product_version} by EnterpriseDB</productDisplayName>
    <productUrlHelpLink>http://www.enterprisedb.com</productUrlHelpLink>
    <productUrlInfoAbout>http://www.enterprisedb.com</productUrlInfoAbout>
    
    <!-- The options are used for RPM registration -->
    <description>${product_shortname} ${product_version} by EnterpriseDB</description>
    <summary>${msg(install.summary)}</summary>
    <vendor>EnterpriseDB</vendor>
    <release>1</release>

    <!-- Installer Size -->
    <width>550</width>
    <height>400</height>
    
    <!-- Misc options -->
    <installerFilename>${product_shortname}-${product_version}-${platform_name}.${platform_exec_suffix}</installerFilename>
    <compressionAlgorithm>lzma</compressionAlgorithm>
    <enableRollback>0</enableRollback>
    <requireInstallationByRootUser>1</requireInstallationByRootUser>
    <saveRelativePaths>1</saveRelativePaths>
    <outputDirectory>../output</outputDirectory>
    <uninstallerName>uninstall-${product_shortname}</uninstallerName>
    <uninstallerDirectory>${installdir}/phpWiki</uninstallerDirectory>
    <installationLogFile>${system_temp_directory}/install-${product_shortname}.log</installationLogFile>
    
    <!-- Images -->
    <leftImage>resources/leftImage.png</leftImage>
    <logoImage>resources/edblogo.png</logoImage>
    <splashImage>resources/splash.png</splashImage>
    <productDisplayIcon>${installdir}/phpwiki/scripts/images/logo.ico</productDisplayIcon>
    <windowsExecutableIcon>resources/logo.ico</windowsExecutableIcon>
    <wmImage>resources/logo.png</wmImage>
    
    <!-- i18n files for the UI -->
    <customLanguageFileList>
        <language>
            <code>en</code>
            <encoding>iso8859-1</encoding>
            <file>i18n/en.lng</file>
        </language>
    </customLanguageFileList>
    
    <!-- Initialisation actions -->
    <initializationActionList>
        <!-- Set the Apache Home -->
        <setInstallerVariable name="apachehome" value="">
            <persist>0</persist>
        </setInstallerVariable>
        
        <!-- Set the Apache Port -->
        <setInstallerVariable name="apacheport" value="8080">
            <persist>0</persist>
        </setInstallerVariable>
        
        <!-- Set the php Home -->
        <setInstallerVariable name="phphome" value="">
            <persist>0</persist>
        </setInstallerVariable>
        
        <!-- Set the pghost varaible to localhost -->
        <setInstallerVariable name="pghost" value="localhost">
            <persist>0</persist>
        </setInstallerVariable>
        
        <!-- Set the phpWiki version(if exists) -->
        <setInstallerVariable name="phpWikiVersion" value="">
            <persist>0</persist>
        </setInstallerVariable>        
	
        <!-- Set the default values -->
        <setInstallerVariable name="defaultuser" value=""/>
        <setInstallerVariable name="defaultpassword" value=""/>
        <setInstallerVariable name="defaultpghome" value=""/>

        <!-- Set the default values for unattended mode -->
        <actionGroup>
           <actionList>
                <setInstallerVariable name="defaultuser" value="postgres"/>
                <setInstallerVariable name="defaultpassword" value="postgres"/>                
           </actionList>
           <ruleList>
                <compareText>
                    <logic>equals</logic>
                    <text>${installer_ui}</text>
                    <value>unattended</value>
                </compareText>
           </ruleList>
        </actionGroup>
        
        <!-- WIN: Set the  pghome default value for unattended mode -->
        <actionGroup>
            <actionList>
              <setInstallerVariable name="defaultpghome" value="${env(SYSTEMDIR)}\Program Files\PostgreSQL\8.3"/>
            </actionList>
            <ruleList>
              <compareText>
                    <logic>equals</logic>
                    <text>${installer_ui}</text>
                    <value>unattended</value>
                </compareText>
                <compareText>
                    <logic>equals</logic>
                    <text>${platform_name}</text>
                    <value>windows</value>
                </compareText>
            </ruleList>
        </actionGroup>
        
        <!-- LIN: Set the  pghome default value for unattended mode -->
        <actionGroup>
            <actionList>
              <setInstallerVariable name="defaultpghome" value="/opt/PostgreSQL/8.3"/>
            </actionList>
            <ruleList>
              <compareText>
                    <logic>equals</logic>
                    <text>${installer_ui}</text>
                    <value>unattended</value>
                </compareText>
                <compareText>
                    <logic>contains</logic>
                    <text>${platform_name}</text>
                    <value>linux</value>
                </compareText>
            </ruleList>
        </actionGroup>
	
        
    </initializationActionList>
    
   <!-- Preinstallation actions -->
    <preInstallationActionList>
        
        <!-- LIN: Check Previous Installation of phpWiki -->
        <actionGroup>
            <actionList>
                <iniFileGet>
                  <file>/etc/postgres-reg.ini</file>  
                  <section>phpWiki</section>
                  <key>Version</key>
                  <variable>phpWikiVersion</variable>
              </iniFileGet>
            </actionList>            
              <ruleList>
                  <compareText>
                    <logic>contains</logic>
                    <text>${platform_name}</text>
                    <value>linux</value>
                  </compareText>
              </ruleList>
        </actionGroup>
        
        <!-- WIN: Check Previous Installation of phpWiki -->
         <actionGroup>
            <actionList>
                <registryGet>
                    <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\phpWiki</key>
                    <name>Version</name>
                    <variable>phpWikiVersion</variable>
                </registryGet>
            </actionList>
            <ruleList>
              <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
              </compareText>
          </ruleList>
        </actionGroup>
       
        <!-- Setting the installation type as upgrade if previous installation found -->
        <actionGroup>
            <actionList>
                <setInstallerVariable name="installationType" value="upgrade" />
            </actionList>
            <ruleList>
                <compareText>
                    <logic>does_not_equal</logic>
                    <text>${phpWikiVersion}</text>
                    <value></value>
                </compareText>
            </ruleList>
        </actionGroup> 
        <!-- WIN : Set the Apache Home , Php Home and Port(default 8080) from registry. ApachePhp Installation would have set these values -->
        <actionGroup>
            <actionList>
                <registryGet>
                    <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\ApachePhp</key>
                    <name>APACHE_HOME</name>
                    <variable>apachehome</variable>
                </registryGet>
                <registryGet>
                    <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\ApachePhp</key>
                    <name>APACHE_PORT</name>
                    <variable>apacheport</variable>
                </registryGet>
                <registryGet>
                    <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\ApachePhp</key>
                    <name>PHP_HOME</name>
                    <variable>phphome</variable>
                </registryGet>
            </actionList>
            <ruleList>
                <compareText>
                    <logic>equals</logic>
                    <text>${platform_name}</text>
                    <value>windows</value>
                </compareText>
            </ruleList>
        </actionGroup>
               
        <!-- LIN : Set the Apache Home , Php Home and Apache Port(default 8080) from registry. ApachePhp Installation would have set these values -->       
        <actionGroup>
          <actionList>
              <iniFileGet>
                  <file>/etc/postgres-reg.ini</file>  
                  <section>ApachePhp</section>
                  <key>APACHE_HOME</key>
                  <variable>apachehome</variable>
              </iniFileGet>
              <iniFileGet>
                  <file>/etc/postgres-reg.ini</file>  
                  <section>ApachePhp</section>
                  <key>APACHE_PORT</key>
                  <variable>apacheport</variable>
              </iniFileGet>
              <iniFileGet>
                  <file>/etc/postgres-reg.ini</file>  
                  <section>ApachePhp</section>
                  <key>PHP_HOME</key>
                  <variable>phphome</variable>
              </iniFileGet>
          </actionList>
          <ruleList>
              <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
              </compareText>
          </ruleList>
        </actionGroup>

        <!-- Abort Installation as Apache Home not found -->
        <actionGroup>
            <actionList>
                <throwError>
                    <customErrorMessage>${msg(error.apache.notfound)}</customErrorMessage>
                    <text>Unknown Error</text>
                </throwError>
            </actionList>
            <ruleList>
                <compareTextLength>
                    <length>0</length>
                    <logic>equals</logic>
                    <text>${apachehome}</text>
                </compareTextLength>
            </ruleList>
        </actionGroup>
        
        <!-- Abort Installation as php Home not found -->
        <actionGroup>
            <actionList>
                <throwError>
                    <customErrorMessage>${msg(error.php.notfound)}</customErrorMessage>
                    <text>Unknown Error</text>
                </throwError>
            </actionList>
            <ruleList>
                <compareTextLength>
                    <length>0</length>
                    <logic>equals</logic>
                    <text>${phphome}</text>
                </compareTextLength>
            </ruleList>
        </actionGroup>
        
        <!-- LIN: Set the Installation Directory -->
        <actionGroup>
            <actionList>
                <setInstallerVariable name="installdir" value="${apachehome}/www">
                    <persist>0</persist>
                </setInstallerVariable>
            </actionList>
	    <ruleList>
              <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
              </compareText>
	    </ruleList>
        </actionGroup>

	<!-- WIN: Set the Installation Directory -->
        <actionGroup>
            <actionList>
                <setInstallerVariable name="installdir" value="${apachehome}\www">
                    <persist>0</persist>
                </setInstallerVariable>
            </actionList>
            <ruleList>
              <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
              </compareText>
            </ruleList>
        </actionGroup>


        <!-- WIN: Creating back up of config file -->	
        <actionGroup>
            <actionList>
              <createBackupFile>
                  <path>${installdir}\phpWiki\lib\config.php</path>
              </createBackupFile>
            </actionList>
            <ruleList>
                <compareText>
                    <value></value>
                    <logic>does_not_equal</logic>
                    <text>${phpWikiVersion}</text>
                </compareText>
		<compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
               </compareText>
            </ruleList>
        </actionGroup>
	
	<!-- LIN: Creating back up of config file -->
        <actionGroup>
            <actionList>
              <createBackupFile>
                  <path>${installdir}/phpWiki/lib/config.php</path>
              </createBackupFile>
            </actionList>
            <ruleList>
                <compareText>
                    <value></value>
                    <logic>does_not_equal</logic>
                    <text>${phpWikiVersion}</text>
                </compareText>
		<compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
            </ruleList>
        </actionGroup>

   </preInstallationActionList>
    
    
    <!-- Postinstallation actions -->
    <postInstallationActionList>

        <!-- WIN: Restore thr Backup File if it is Upgrade -->
        <actionGroup>
           <actionList>
                <deleteFile>
                  <path>${installdir}\phpWiki\lib\config.php</path>
                </deleteFile>		
                <renameFile>
                  <origin>${installdir}\phpWiki\lib\config.php.bak0</origin>
                  <destination>${installdir}\phpWiki\lib\config.php</destination>
                </renameFile>
                <deleteFile>
                  <path>${installdir}\phpWiki\lib\config.php.bak0</path>
                </deleteFile>		
           </actionList>
           <ruleList>
              <compareText>
                <value></value>
                <logic>does_not_equal</logic>
                <text>${phpWikiVersion}</text>
              </compareText>
	      <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
              </compareText>
	      <fileExists>
                <path>${installdir}\phpWiki\lib\config.php.bak0</path>
              </fileExists>
           </ruleList>
        </actionGroup>

	<!-- LIN: Restore thr Backup File if it is Upgrade -->
        <actionGroup>
           <actionList>
                <deleteFile>
                  <path>${installdir}/phpWiki/lib/config.php</path>
                </deleteFile>
                <renameFile>
                  <origin>${installdir}/phpWiki/lib/config.php.bak0</origin>
                  <destination>${installdir}/phpWiki/lib/config.php</destination>
                </renameFile>
                <deleteFile>
                  <path>${installdir}/phpWiki/lib/config.php.bak0</path>
                </deleteFile>
           </actionList>
           <ruleList>
              <compareText>
                <value></value>
                <logic>does_not_equal</logic>
                <text>${phpWikiVersion}</text>
              </compareText>
	      <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
               </compareText>
	       <fileExists>
		  <path>${installdir}/phpWiki/lib/config.php.bak0</path>
	       </fileExists>
           </ruleList>
        </actionGroup>
        
        <!-- LIN: Write the phpWiki Info to INI File -->
        <actionGroup>
            <actionList>
	      <iniFileSet>
                  <file>/etc/postgres-reg.ini</file>
                  <section>phpWiki</section>
                  <key>Description</key>
                  <value>${msg(install.summary)}</value>
              </iniFileSet>
	      <iniFileSet>
                  <file>/etc/postgres-reg.ini</file>
                  <section>phpWiki</section>
                  <key>InstallationDirectory</key>
                  <value>${installdir}/phpWiki</value>
              </iniFileSet>	
              <iniFileSet>
                  <file>/etc/postgres-reg.ini</file>  
                  <section>phpWiki</section>
                  <key>Version</key>
                  <value>${product_version}</value>
              </iniFileSet>
            </actionList>
	    <ruleList>
		<compareText>
	  	   <text>${platform_name}</text>
		   <logic>contains</logic>
		   <value>linux</value>
		</compareText>
	    </ruleList>	
        </actionGroup>
        
        
        <!-- Substitute phgost and pgport in the conf file -->
        <actionGroup>
            <actionList>                          
              <substitute>
                  <files>${installdir}/phpWiki/lib/config.php</files>
                  <substitutionList>
                      <substitution>
                        <pattern>@@PGHOST@@</pattern>
                        <value>${pghost}</value>
                      </substitution>
                  </substitutionList>
              </substitute>        
              <substitute>
                  <files>${installdir}/phpWiki/lib/config.php</files>
                  <substitutionList>
                      <substitution>
                        <pattern>@@PGPORT@@</pattern>
                        <value>${pgport}</value>
                      </substitution>
                  </substitutionList>
              </substitute>
          </actionList>
          <ruleList>
              <compareText>
                   <text>${phpWikiVersion}</text>
                   <logic>equals</logic>
                   <value></value>
              </compareText>
          </ruleList>
        </actionGroup>
        
        <!-- WIN : Run Script to create Role and database -->
        <actionGroup>     	
            <actionList>			  
              <runProgram>
                <program>${installdir}\phpWiki\installer\phpWiki\install.bat</program>
                <programArguments> "${pghost}" "${pgport}" "${pguser}" "${pgpassword}" "${pghome}" "${installdir}"</programArguments>
		<workingDirectory>${installdir}\phpWiki\installer\phpWiki</workingDirectory>
              </runProgram>
              <!-- Inform user about the database and role creation -->
              <showInfo>
                  <text>${msg(db.create.info)}</text>
              </showInfo>
            </actionList>
            <ruleList>
              <compareText>
                <logic>equals</logic>
                <text>${platform_name}</text>
                <value>windows</value>
              </compareText>
              <compareText>
                <text>${dbexist}</text>
                <logic>equals</logic>
                <value></value>
              </compareText>
	      <compareText>
                <text>${userexist}</text>
                <logic>equals</logic>
                <value></value>
              </compareText>	
              <compareText>
                <text>${phpWikiVersion}</text>
                <logic>equals</logic>
                <value></value>
              </compareText>
            </ruleList>
        </actionGroup>	
        
        <!-- LIN : Run Script to create Role and database -->
        <actionGroup>     	
            <actionList>
              <runProgram>
                <program>${installdir}/phpWiki/installer/phpWiki/install.sh</program>
                <programArguments>"${pghost}" "${pgport}" "${pguser}" "${pgpassword}" "${pghome}" "${installdir}"</programArguments>
		<workingDirectory>${installdir}/phpWiki/installer/phpWiki</workingDirectory>
              </runProgram>
              <!-- Inform user about the database and role creation -->
              <showInfo>
                  <text>${msg(db.create.info)}</text>
              </showInfo>
            </actionList>
            <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
                <compareText>
                  <text>${dbexist}</text>
                  <logic>equals</logic>
                  <value></value>
                </compareText>
		<compareText>
                <text>${userexist}</text>
                <logic>equals</logic>
                <value></value>
              </compareText>
		<compareText>
        	  <text>${phpWikiVersion}</text>
  	          <logic>equals</logic>
                  <value></value>
                </compareText>
            </ruleList>
        </actionGroup>
        
        <!-- LIN: Create Menu Shortcuts -->
        <actionGroup>
            <actionList>
                <runProgram>
                  <program>${installdir}/phpWiki/installer/phpWiki/createshortcuts.sh</program>
                  <programArguments>"${installdir}"</programArguments>
                  <progressText>${msg(progress.text.creating.shortcuts)}</progressText>
  	 	  <workingDirectory>${installdir}/phpWiki/installer/phpWiki</workingDirectory>
                  <abortOnError>0</abortOnError>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>              
            </actionList>
            <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
            </ruleList>
        </actionGroup>


    </postInstallationActionList>

    <!-- preUninstallation actions -->    
    <preUninstallationActionList>
	
	<!-- LIN: Unset the phpWiki Info from the ini file -->
        <actionGroup>
            <actionList>
		<iniFileSet>
                  <file>/etc/postgres-reg.ini</file>
                  <section>phpWiki</section>
                  <key>Description</key>
                  <value></value>
                </iniFileSet>
		<iniFileSet>
                  <file>/etc/postgres-reg.ini</file>
                  <section>phpWiki</section>
                  <key>InstallationDirectory</key>
                  <value></value>
                </iniFileSet>
		<iniFileSet>
                  <file>/etc/postgres-reg.ini</file>
                  <section>phpWiki</section>
                  <key>Version</key>
                  <value></value>
	        </iniFileSet>	
		<!-- Remove the menu shortcuts -->
                <runProgram>
                  <program>${installdir}/phpWiki/installer/phpWiki/removeshortcuts.sh</program>
                  <programArguments>"${installdir}"</programArguments>
		  <workingDirectory>${installdir}/phpWiki/installer/phpWiki</workingDirectory>
                </runProgram>
            </actionList>
            <ruleList>
                <compareText>
                    <logic>contains</logic>
                    <text>${platform_name}</text>
                    <value>linux</value>
                </compareText>
            </ruleList>
        </actionGroup>
    </preUninstallationActionList>
     
    <!-- postUninstallation actions -->
    <postUninstallationActionList>

	<!-- Prompt user about the Role and Database Deletion/Drop -->
        <showInfo>
            <text>${msg(db.drop.info)}</text>
        </showInfo> 		
    </postUninstallationActionList>
     
    <!-- Components -->
    <componentList>
        <component>
            <name>phpWiki</name>
            <description>phpWiki components </description>
            <canBeEdited>0</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
               
               <!-- LIN: Program files -->
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux</name>
                    <platforms>linux</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>staging/linux/phpWiki</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
		<folder>
                    <description>Installer Files</description>
                    <destination>${installdir}/phpWiki</destination>
                    <name>installfileslinux</name>
                    <platforms>linux</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>staging/linux/installer</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
		<folder>
                    <description>Menu And Launch Scripts</description>
                    <destination>${installdir}/phpWiki</destination>
                    <name>menuandlaunchfileslinux</name>
                    <platforms>linux</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>staging/linux/scripts</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
		
		<!-- WIN: Program files -->
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>staging/windows/phpWiki</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Installer Files</description>
                    <destination>${installdir}/phpWiki</destination>
                    <name>installfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>staging/windows/installer</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Menu And Launch Scripts</description>
                    <destination>${installdir}/phpWiki</destination>
                    <name>menuandlaunchfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>staging/windows/scripts</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>                
	
            </folderList>
            
            <!-- WIN: Start Menu -->
            <startMenuShortcutList>
               <!-- Launch phpWiki -->
               <startMenuShortcut>
                   <comment>phpWiki</comment>
                   <name>phpWiki</name>
                   <runInTerminal>0</runInTerminal>
                   <windowsExec>wscript</windowsExec>
                   <windowsExecArgs>//NoLogo "${installdir}\phpWiki\scripts\launchPhpWiki.vbs"</windowsExecArgs>
                   <windowsIcon>${installdir}\phpWiki\scripts\images\logo.ico</windowsIcon>
               </startMenuShortcut>                        
             </startMenuShortcutList>
        </component>
    </componentList>
    
    <!-- PostgreSQL Details Verification Page -->
    <parameterList>
        <parameterGroup>
            <name>pgdetails</name>
            <title>${msg(pgplus.details.title)}</title>
            <explanation>${msg(pgplus.details.explanation)}</explanation>
            <value></value>
            <default></default>
            <parameterList>
                <!-- Postgres Host(Default localhost) -->
                <stringParameter>
                    <name>pghost</name>
                    <description>Host</description>
                    <explanation></explanation>
                    <value></value>
                    <default></default>
                    <allowEmptyValue>1</allowEmptyValue>
                    <width>40</width>
                </stringParameter>
                
                <!-- Postgres Port(Default 6543) -->
                <stringParameter>
                    <name>pgport</name>
                    <description>Port</description>
                    <explanation></explanation>
                    <value></value>
                    <default>5432</default>
                    <allowEmptyValue>1</allowEmptyValue>
                    <width>40</width>
                </stringParameter>
                
                <!-- Postgres User -->
                <stringParameter>
                    <name>pguser</name>
                    <description>User Name</description>
                    <explanation></explanation>
                    <value></value>
                    <default>${defaultuser}</default>
                    <allowEmptyValue>1</allowEmptyValue>
                    <width>40</width>
                </stringParameter>
                
                <!-- Postgres User Password -->
                <passwordParameter>
                    <name>pgpassword</name>
                    <title>Password</title>
                    <description>Password</description>
                    <explanation></explanation>
                    <value></value>
                    <default>${defaultpassword}</default>
                    <allowEmptyValue>1</allowEmptyValue>
                    <askForConfirmation>0</askForConfirmation>
                    <descriptionRetype></descriptionRetype>
                    <width>40</width>
                </passwordParameter>
                
                <!-- Postgres Home Directory -->
                <directoryParameter>
                    <name>pghome</name>
                    <description>PostgreSQL Home Directory</description>
                    <explanation></explanation>
                    <value></value>
                    <default>${defaultpghome}</default>
                    <allowEmptyValue>1</allowEmptyValue>
                    <mustBeWritable>0</mustBeWritable>
                    <mustExist>0</mustExist>
                    <width>40</width>
                </directoryParameter>
                
                <!-- PostgreSQL Server Installed? -->
                <booleanParameter>
                    <name>pginstalled</name>
                    <description>PostgreSQL Installed</description>
                    <explanation></explanation>
                    <value>${pginstalled}</value>
                    <default></default>
                    <ask>0</ask>
                    <displayStyle>checkbox-right</displayStyle>
                </booleanParameter>
            </parameterList>
            <ruleList>
              <compareText>
                <text>${phpWikiVersion}</text>
                <logic>equals</logic>
                <value></value>
              </compareText>
            </ruleList>

            <!-- Checking the validity of PostgreSQL Server Details -->
            <validationActionList>
              <actionGroup>
                <actionList>
                  <throwError>
                    <text>${msg(pgplus.blank.error)}</text>
                  </throwError>
                </actionList>
          	   <ruleEvaluationLogic>OR</ruleEvaluationLogic>
                <ruleList>
                  <compareText>
                    <text>${pghost}</text>
                    <logic>equals</logic>
                    <value></value>
                  </compareText>			
                  <compareText>
                           <text>${pgport}</text>
                           <logic>equals</logic>
                           <value></value>
                  </compareText>
                  <compareText>
                           <text>${pguser}</text>
                           <logic>equals</logic>
                           <value></value>
                  </compareText>
                  <compareText>
                           <text>${pgpassword}</text>
                           <logic>equals</logic>
                           <value></value>
                  </compareText>
                  <compareText>
                           <text>${pghome}</text>
                           <logic>equals</logic>
                           <value></value>
                  </compareText> 
                </ruleList>	
              </actionGroup>
            
             <!-- Creating a temporary directory -->
             <createDirectory path="${system_temp_directory}/${product_fullname}"/>

             <!-- WIN - Unpack Script Files -->
	      <actionGroup>
                <actionList>
                  <!-- Unpacking the Script file to temporary directory -->
                  <unpackFile>
                    <component>phpWiki</component>
                    <destination>${system_temp_directory}/${product_fullname}/check-connection.bat</destination>
                    <folder>installfileswindows</folder>
                    <origin>installer/phpWiki/check-connection.bat</origin>
                  </unpackFile>
                  <unpackFile>
                    <component>phpWiki</component>
                    <destination>${system_temp_directory}/${product_fullname}/check-db.bat</destination>
                    <folder>installfileswindows</folder>
                    <origin>installer/phpWiki/check-db.bat</origin>
                  </unpackFile>
                </actionList>
                <ruleList>
                  <compareText>
                    <logic>equals</logic>
                    <text>${platform_name}</text>
                    <value>windows</value>
                  </compareText>
                </ruleList>
              </actionGroup>	
               
              <!-- LIN: Unpack Script Files -->
              <actionGroup>
                <actionList>
                  <!-- Unpacking the Script file to temporary directory -->
                  <unpackFile>
                    <component>phpWiki</component>
                    <destination>${system_temp_directory}/${product_fullname}/check-connection.sh</destination>
                    <folder>installfileslinux</folder>
                    <origin>installer/phpWiki/check-connection.sh</origin>
                  </unpackFile>
                  <unpackFile>
                    <component>phpWiki</component>
                    <destination>${system_temp_directory}/${product_fullname}/check-db.sh</destination>
                    <folder>installfileslinux</folder>
                    <origin>installer/phpWiki/check-db.sh</origin>
                  </unpackFile>
                </actionList>
                <ruleList>
                  <compareText>
                    <logic>contains</logic>
                    <text>${platform_name}</text>
                    <value>linux</value>
                  </compareText>
                </ruleList>
              </actionGroup> 

              <!-- WIN: validate the PostgreSQL Server Details -->
              <actionGroup>
                <actionList>
                  <!-- Running the Script to validate the PostgreSQL Server Details -->
                  <setInstallerVariableFromScriptOutput>
                        <exec>${system_temp_directory}/${product_fullname}/check-connection.bat</exec>
                        <execArgs>${pghost} ${pgport} ${pguser} "${pgpassword}" "${pghome}"</execArgs>
                        <name>connection</name>
                        <workingDirectory>${system_temp_directory}/${product_fullname}</workingDirectory>
                        <customErrorMessage>${msg(pgplus.details.error)}</customErrorMessage>
                  </setInstallerVariableFromScriptOutput>
                </actionList>
                <ruleList>
                  <compareText>
                    <logic>equals</logic>
                    <text>${platform_name}</text>
                    <value>windows</value>
                  </compareText>
                </ruleList>
              </actionGroup>

              <!-- LIN: validate the PostgreSQL Server Details -->
              <actionGroup>
                <actionList>
                  <!-- Running the Script to validate the PostgreSQL Server Details -->
                  <setInstallerVariableFromScriptOutput>
                        <exec>${system_temp_directory}/${product_fullname}/check-connection.sh</exec>
                        <execArgs>${pghost} ${pgport} ${pguser} "${pgpassword}" "${pghome}"</execArgs>
                        <name>connection</name>
                        <workingDirectory>${system_temp_directory}/${product_fullname}</workingDirectory>
                        <customErrorMessage>${msg(pgplus.details.error)}</customErrorMessage>
                  </setInstallerVariableFromScriptOutput>
                </actionList>
                <ruleList>
                  <compareText>
                    <logic>contains</logic>
                    <text>${platform_name}</text>
                    <value>linux</value>
                  </compareText>
                </ruleList>
              </actionGroup>

              <setInstallerVariable name="dbexist" value="" />
              <setInstallerVariable name="userexist" value="" />

               <!-- WIN - Check whether the database and user already exists -->
	       <actionGroup>
                <actionList>
                    <!-- WIN - Check whether the database already exists -->
                    <setInstallerVariableFromScriptOutput>
                              <name>dbexist</name>
                              <exec>${system_temp_directory}\${product_fullname}\check-db.bat</exec>
                              <execArgs>${pghost} ${pgport} ${pguser} "${pgpassword}" "${pghome}" "phpwiki"</execArgs>
                              <workingDirectory>${system_temp_directory}\${product_fullname}</workingDirectory>
                              <abortOnError>0</abortOnError>
                              <showMessageOnError>0</showMessageOnError>
                   </setInstallerVariableFromScriptOutput>
                    <!-- WIN - Check whether the user already exists -->
                    <setInstallerVariableFromScriptOutput>
                              <name>userexist</name>
                              <exec>${system_temp_directory}\${product_fullname}\check-db.bat</exec>
                              <execArgs>${pghost} ${pgport} ${pguser} "${pgpassword}" "${pghome}" "phpwikiuser"</execArgs>
                              <workingDirectory>${system_temp_directory}\${product_fullname}</workingDirectory>
                              <abortOnError>0</abortOnError>
                              <showMessageOnError>0</showMessageOnError>
                   </setInstallerVariableFromScriptOutput>
                </actionList>
                <ruleList>
                   <compareText>
                       <text>${phpWikiVersion}</text>
                       <logic>equals</logic>
                       <value></value>
                    </compareText>
                    <compareText>
                      <logic>equals</logic>
                      <text>${platform_name}</text>
                        <value>windows</value>
                    </compareText>
                  </ruleList>
                </actionGroup>	

               <!-- LIN: Check whether the database and user already exists -->
               <actionGroup>
                  <actionList>
                     <!-- LIN: Check whether the database already exists -->
                     <setInstallerVariableFromScriptOutput>
                        <name>dbexist</name>
                        <exec>${system_temp_directory}/${product_fullname}/check-db.sh</exec>
                        <execArgs>${pghost} ${pgport} ${pguser} "${pgpassword}" "${pghome}" "phpwiki"</execArgs>
                        <workingDirectory>${system_temp_directory}/${product_fullname}</workingDirectory>
                        <abortOnError>0</abortOnError>
                        <showMessageOnError>0</showMessageOnError>
                      </setInstallerVariableFromScriptOutput>
                      <!-- LIN: Check whether the user already exists -->
                       <setInstallerVariableFromScriptOutput>
                        <name>userexist</name>
                        <exec>${system_temp_directory}/${product_fullname}/check-db.sh</exec>
                        <execArgs>${pghost} ${pgport} ${pguser} "${pgpassword}" "${pghome}" "phpwikiuser"</execArgs>
                        <workingDirectory>${system_temp_directory}/${product_fullname}</workingDirectory>
                        <abortOnError>0</abortOnError>
                        <showMessageOnError>0</showMessageOnError>
                      </setInstallerVariableFromScriptOutput>
                  </actionList>
                  <ruleList>
                    <compareText>
                      <text>${phpWikiVersion}</text>
                       <logic>equals</logic>
                      <value></value>
                     </compareText>
                      <compareText>
                        <logic>contains</logic>
                        <text>${platform_name}</text>
                        <value>linux</value>
                      </compareText>
                   </ruleList>
              </actionGroup> 

              <!-- Inform user about the Existance of database and user  -->
              <actionGroup>
                   <actionList>
                     <showQuestion>
                       <text>${msg(db.found.info)}</text>
                       <variable>response</variable>
                     </showQuestion>
                   </actionList>
                   <ruleEvaluationLogic>OR</ruleEvaluationLogic>
                   <ruleList>
                     <compareText>
                      <text>${dbexist}</text>
                      <logic>does_not_equal</logic>
                      <value></value>
                     </compareText>
		     <compareText>
                      <text>${userexist}</text>
                      <logic>does_not_equal</logic>
                      <value></value>
                     </compareText>
                     <compareText>
                      <text>${phpWikiVersion}</text>
                      <logic>does_not_equal</logic>
                      <value></value>
                     </compareText>
                   </ruleList>
               </actionGroup>

               <!-- Exit the installation if the user wants to quit -->
	       <actionGroup>
		  <actionList>
			<exit>
			   <exitCode>0</exitCode>
			</exit>	
                  </actionList>
		  <ruleList>
			<compareText>
			   <logic>equals</logic>
			   <value>no</value>
			   <text>${response}</text>
			</compareText>
		  </ruleList>
	       </actionGroup>
            </validationActionList>
        </parameterGroup>
    </parameterList>
</project>

