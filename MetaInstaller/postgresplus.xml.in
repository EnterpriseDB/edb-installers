<project>
  <shortName>postgresplus</shortName>
  <fullName>Postgres Plus</fullName>
  <windowsSoftwareRegistryPrefix/>
  <version>PG_VERSION_METAINSTALLER</version>
  <productDisplayName>${product_fullname} ${product_version}</productDisplayName>
  <leftImage>../resources/edb-side.png</leftImage>
  <!--<logoImage>resources/enterprisedb.gif</logoImage>-->
  <splashImage>../resources/splash_screen.png</splashImage>
  <installationLogFile>${system_temp_directory}/install-${product_shortname}.log</installationLogFile>
  <outputDirectory>../output</outputDirectory>
  <vendor>EnterpriseDB</vendor>
  <requireInstallationByRootUser>${admin_rights}</requireInstallationByRootUser>

  <!-- i18n files for the UI -->
  <allowedLanguages>en</allowedLanguages>
  <customLanguageFileList>
    <language>
      <code>en</code>
      <file>i18n/en.lng</file>
    </language>
  </customLanguageFileList>

  <!-- Languages allowed? -->
  <!-- <allowLanguageSelection>1</allowLanguageSelection> -->
  <allowedLanguages>en</allowedLanguages>
  <enableRollback>0</enableRollback>
  <height>400</height>
  <width>600</width>
  <saveRelativePaths>1</saveRelativePaths>
  <startMenuGroupName></startMenuGroupName>

  <!-- Prebuild Actons-->
  <preBuildActionList>
    <setInstallerVariable name="originalplatform" value="${platform_name}"/>
    <setInstallerVariable name="originalplatform" value="linux-x32">
      <ruleList>
        <compareText text="${platform_name}" value="linux"/>
      </ruleList>
    </setInstallerVariable>
    <setInstallerVariable name="project.parameter(servicepassword).ask" value="0">
      <ruleList>
        <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
      </ruleList>
    </setInstallerVariable>
  </preBuildActionList>

  <preShowHelpActionList>
    <!-- Set the default installation directory -->
    <setInstallerVariable>
      <name>default_installdir</name>
      <persist>1</persist>
      <value>/Library/PostgresPlus/${product_version}SS</value>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${platform_name}</text>
          <value>osx</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>

    <setInstallerVariable>
      <name>default_installdir</name>
      <persist>1</persist>
      <value>${platform_install_prefix}/PostgresPlus/${product_version}SS</value>
      <ruleList>
        <compareText>
          <logic>contains</logic>
          <text>${platform_name}</text>
          <value>linux</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>

    <setInstallerVariable>
      <name>default_installdir</name>
      <persist>1</persist>
      <value>${platform_install_prefix}/PostgresPlus/${product_version}SS</value>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${platform_name}</text>
          <value>windows</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>

    <!-- Get a default port number - ideally 5432 -->
    <getFreePort>
      <variable>defaultport</variable>
      <initialPort>5432</initialPort>
      <finalPort>65535</finalPort>
      <ruleList>
         <isTrue value="${installer_is_root_install}"/>
      </ruleList>
    </getFreePort>
    <!-- Set the default password, to be used only in unnattended mode -->
    <setInstallerVariable>
      <name>defaultpassword</name>
      <value>postgres</value>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${installer_ui}</text>
          <value>unattended</value>
        </compareText>
      </ruleList>

    </setInstallerVariable>
    <setInstallerVariable>
      <name>defaultpassword</name>
      <value></value>
      <ruleList>
        <compareText>
          <logic>does_not_equal</logic>
          <text>${installer_ui}</text>
          <value>unattended</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>

  </preShowHelpActionList>

  <initializationActionList>
    <setInstallerVariable name="project.parameter(extract_mode).ask" value="0"/>
    <!-- Abort Installation as trying to  run a 32-bit installer on 64-bit machine -->
    <throwError>
      <customErrorMessage>${msg(platform.not.match)}</customErrorMessage>
      <text>Unknown Error</text>
      <ruleList>
        <platformTest type="linux-x64"/>
        <compareText text="${originalplatform}" value="linux-x32">
          <logic>equals</logic>
        </compareText>
      </ruleList>
    </throwError>

    <setInstallerVariable name="showInstallationTuning" value="1"/>
    <setInstallerVariable name="showUpdateNotification" value="1"/>
    <setInstallerVariable name="showValueAddedServicePage" value="1"/>
    <setInstallerVariable name="project.parameter(superaccount).ask" value="0"/>
    <setInstallerVariable name="project.parameter(serviceaccount).ask" value="0"/>
    <setInstallerVariable name="project.parameter(servicepassword).ask" value="0"/>
    <setInstallerVariable name="project.parameter(servicename).ask" value="0"/>

    <!-- Set Proxy values from environement variables if any -->
    <setInstallerVariable name="proxyHost" value="${env(PROXY_HOST)}" />
    <setInstallerVariable name="proxyPort" value="${env(PROXY_PORT)}" />

    <!-- Set the pghost varaible to localhost -->
    <setInstallerVariable name="pghost" value="localhost">
      <persist>0</persist>
    </setInstallerVariable>

    <!-- Set the default values for pgAgent -->
    <setInstallerVariable name="defaultpghost" value="localhost"/>
    <setInstallerVariable name="defaultpguser" value="postgres"/>
    <!--<setInstallerVariable name="defaultpgport" value="5432"/>-->
    <setInstallerVariable name="defaultpgdbname" value="postgres"/>

    <!-- Set the default system password, to be used only in unnattended mode -->
    <setInstallerVariable name="defaultsyspassword" value=""/>
    <setInstallerVariable name="schema" value="install">
      <ruleList>
        <compareText logic="equals" text="${installer_ui}" value="unattended"/>
      </ruleList>
    </setInstallerVariable>
    <setInstallerVariable name="showAuthenticateScreen" value="0">
      <ruleList>
        <compareText logic="equals" text="${installer_ui}" value="unattended"/>
      </ruleList>
    </setInstallerVariable>

    <setInstallerVariable name="defaultsyspassword" value="postgres">
      <ruleList>
        <compareText logic="equals" text="${installer_ui}" value="unattended"/>
      </ruleList>
    </setInstallerVariable>

    <setInstallerVariable name="cliServicePassword" value=""/>
    <setInstallerVariable name="servicename" value=""/>
    <setInstallerVariable name="iServiceName" value=""/>
    <setInstallerVariable name="serviceaccount" value=""/>
    <setInstallerVariable name="iServiceAccount" value=""/>
    <setInstallerVariable name="superaccount" value=""/>
    <setInstallerVariable name="iSuperAccount" value=""/>

    <setInstallerVariable name="installMonitoring" value="0"/>

    <!-- Abort Installation as trying to  run a 32-bit installer on 64-bit machine -->
    <throwError>
      <customErrorMessage>${msg(platform.not.match)}</customErrorMessage>
      <text>Unknown Error</text>
      <ruleList>
        <platformTest type="linux-x64"/>
        <compareText text="${originalplatform}" value="linux-x32">
          <logic>equals</logic>
        </compareText>
      </ruleList>
    </throwError>

    <setInstallerVariable>
      <name>noComponentSelected</name>
      <persist>1</persist>
      <value>true</value>
    </setInstallerVariable>

    <!-- Track if any errors occurred so we can hide the Run Stackbuilder option -->
    <setInstallerVariable>
      <name>didError</name>
      <value>0</value>
    </setInstallerVariable>

    <!-- Set supername to empty -->
    <setInstallerVariable>
      <name>supername</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>

    <setInstallerVariable>
      <name>dbserver_guid</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>processor_arch</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>total_mem_in_gb</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>os</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>number_of_processors</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>processor_type</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>language</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>shared_memory_in_mb</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>

    <!-- Set the default password, to be used only in unnattended mode -->
    <setInstallerVariable>
      <name>defaultpassword</name>
      <persist>0</persist>
      <value>postgres</value>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${installer_ui}</text>
          <value>unattended</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>

    <setInstallerVariable>
      <name>defaultpassword</name>
      <persist>0</persist>
      <value></value>
      <ruleList>
        <compareText>
          <logic>does_not_equal</logic>
          <text>${installer_ui}</text>
          <value>unattended</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>

    <!--Web Service DynaTune Variables -->
    <setInstallerVariable>
      <name>work_mem_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>max_connections_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>maintenance_work_mem_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>shared_buffers_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>max_fsm_relations_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>max_fsm_pages_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>wal_buffers_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>effective_cache_size_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>random_page_cost_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>checkpoint_segments_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>autovacuum_vacuum_threshold_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>autovacuum_vacuum_scale_factor_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>autovacuum_analyze_threshold_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>autovacuum_analyze_scale_factor_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>autovacuum_naptime_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>stats_row_level_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>autovacuum_var</name>
      <persist>1</persist>
      <value></value>
    </setInstallerVariable>

    <!-- Get a default port number - ideally 5432 -->
    <getFreePort>
      <finalPort>65535</finalPort>
      <initialPort>5432</initialPort>
      <variable>defaultport</variable>
      <ruleList>
         <isTrue value="${installer_is_root_install}"/>
      </ruleList>
    </getFreePort>

    <!-- Get a default port number - ideally 8080 -->
    <getFreePort>
      <finalPort>65535</finalPort>
      <initialPort>8080</initialPort>
      <variable>defaultwebport</variable>
      <ruleList>
         <isTrue value="${installer_is_root_install}"/>
      </ruleList>
    </getFreePort>

    <!-- Upgrading? -->
    <setInstallerVariable>
      <name>IsUpgrade</name>
      <persist>0</persist>
      <value>0</value>
    </setInstallerVariable>

    <!-- Set the uninstaller name -->
    <setInstallerVariable>
      <name>uninstallerName</name>
      <persist>1</persist>
      <value>uninstall-postgresplus</value>
    </setInstallerVariable>

    <!-- Catalog version -->
    <setInstallerVariable>
      <name>CatalogVersion</name>
      <persist>0</persist>
      <value>PG_CATALOG_VERSION</value>
      <!--<value>200711281</value>-->
    </setInstallerVariable>
    <actionGroup>
      <actionList>
        <!-- Set the ini filename -->
        <setInstallerVariable>
          <name>PostgreSqlIni</name>
          <persist>1</persist>
          <value>/etc/postgres-reg.ini</value>
        </setInstallerVariable>
        <logMessage>
          <text>Using ini file: ${PostgreSqlIni}</text>
        </logMessage>
      </actionList>
      <ruleList>
        <compareText>
          <logic>does_not_equal</logic>
          <text>${platform_name}</text>
          <value>windows</value>
        </compareText>
      </ruleList>
    </actionGroup>

    <setInstallerVariable>
      <name>pg_full_version</name>
      <value>PG_FULL_VERSION</value>
    </setInstallerVariable>

    <setInstallerVariable name="ppss_temp_directory" value="${system_temp_directory}\postgresplus_${system_username}">
      <ruleList>
        <compareText logic="equals" text="${platform_name}" value="windows"/>
      </ruleList>
    </setInstallerVariable>
    <setInstallerVariable name="ppss_temp_directory" value="${system_temp_directory}/postgresplus_${system_username}">
      <ruleList>
        <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
      </ruleList>
    </setInstallerVariable>
  </initializationActionList>

  <!-- Test code Preinstallation actions -->
  <preInstallationActionList>
 
    <setInstallerVariable name="iDataDirectory" value=""/>
    <setInstallerVariable name="iBaseDirectory" value=""/>
    <setInstallerVariable name="iMonitorServer" value=""/>
    <setInstallerVariable name="iVersion" value=""/>
    <setInstallerVariable name="iServiceName" value=""/>
    <setInstallerVariable name="iServiceAccount" value=""/>
    <setInstallerVariable name="iSuperAccount" value=""/>

    <!-- MAC: Set the default installation directory -->
    <setInstallerVariable>
      <name>default_installdir</name>
      <persist>1</persist>
      <value>/Library/PostgresPlus/${product_version}SS</value>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${platform_name}</text>
          <value>osx</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>default_installdir</name>
      <persist>1</persist>
      <value>${platform_install_prefix}/PostgresPlus/${product_version}SS</value>
      <ruleList>
        <compareText>
          <logic>contains</logic>
          <text>${platform_name}</text>
          <value>linux</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>
    <setInstallerVariable>
      <name>default_installdir</name>
      <persist>1</persist>
      <value>${platform_install_prefix}\PostgresPlus\${product_version}SS</value>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${platform_name}</text>
          <value>windows</value>
        </compareText>
      </ruleList>
    </setInstallerVariable>

    <actionGroup>
      <actionList>
        <!-- Do not allow component-selection in extract-only mode -->
        <setInstallerVariable name="allowComponentSelection" value="0"/>
        <setInstallerVariable name="branding" value=""/>
        <!-- Do not create uninstaller in case of extract-only mode -->
        <setInstallerVariable name="createUninstaller" value="0" persist="1"/>
        <componentSelection select="dbserver,slony,pgJdbc,postgis,psqlOdbc,npgsql,pgbouncer,pgmemcache,pgagent"/>
      </actionList>
      <ruleList>
        <isTrue value="${extract_mode}"/>
      </ruleList>
    </actionGroup>

    <!-- Check if dbserver component is deselected in unattended mode -->
    <throwError>
        <text>${msg(dbserver.required.pgerror)}</text>
        <ruleList>
            <compareText text="${component(dbserver).selected}" value="0" logic="equals"/>
            <compareText text="${installer_ui}" value="unattended" logic="equals" />
        </ruleList>
    </throwError>

    <actionGroup>
      <actionList>
        <setInstallerVariable>
          <name>component(pgmemcache).canBeEdited</name>
          <persist>0</persist>
          <value>0</value>
        </setInstallerVariable>
        <componentSelection>
          <deselect>pgmemcache</deselect>
          <select></select>
        </componentSelection>
        <setInstallerVariable>
          <name>component(pgmemcache).show</name>
          <persist>0</persist>
          <value>0</value>
        </setInstallerVariable>
      </actionList>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${platform_name}</text>
          <value>windows</value>
        </compareText>
      </ruleList>
    </actionGroup>

    <actionGroup>
      <actionList>
        <!-- Abort installation if not super-user and not running in extract-only mode-->
        <throwError text="${msg(Installer.Warning.RootPrivileges)}">
          <ruleList>
            <isFalse value="${installer_is_root_install}"/>
          </ruleList>
        </throwError>
        <setInstallerVariable name="windowsSoftwareRegistryPrefix" value="EnterpriseDB\PostgresPlus\Installations\postgresplus-${product_version}" persist="1"/>

        <actionGroup>
          <actionList>
            <!-- Check for unixodbc -->
    
            <setInstallerVariableFromScriptOutput>
              <exec>which</exec>
              <execArgs>odbcinst</execArgs>
              <name>unixodbccheck</name>
              <workingDirectory>.</workingDirectory>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>
            <actionGroup>
              <actionList>
                <showInfo>
                  <text>${msg(unixodbc.not.exists)}</text>
                  <ruleList>
                    <compareText>
                       <logic>does_not_equal</logic>
                       <text>${installer_ui}</text>
                       <value>unattended</value>
                    </compareText>
                  </ruleList>
                </showInfo>
                <setInstallerVariable>
                  <name>component(psqlOdbc).canBeEdited</name>
                  <persist>0</persist>
                  <value>0</value>
                </setInstallerVariable>
                <componentSelection>
                  <deselect>psqlOdbc</deselect>
                  <select></select>
                </componentSelection>
              </actionList>
              <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${unixodbccheck}</text>
                  <value></value>
                </compareText>
              </ruleList>
            </actionGroup>
            <logMessage>
              <text>unixOdbc found at: ${unixodbccheck}</text>
              <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
              </ruleList>
            </logMessage>
          </actionList>
        </actionGroup>
    
        <!-- Creates the ini file if not exists -->
        <touchFile path="/etc/postgres-reg.ini">
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </touchFile>
    
        <iniFileGet>
          <file>${PostgreSqlIni}</file>
          <key>InstallationDirectory</key>
          <section>PostgreSQL/${product_version}</section>
          <variable>iBaseDirectory</variable>
          <ruleList>
            <fileTest>
              <condition>readable</condition>
              <path>${PostgreSqlIni}</path>
            </fileTest>
          </ruleList>
        </iniFileGet>
        <setInstallerVariable>
          <name>iBaseDirectory</name>
          <persist>0</persist>
          <value></value>
          <ruleList>
            <fileTest>
              <condition>not_readable</condition>
              <path>${PostgreSqlIni}</path>
            </fileTest>
          </ruleList>
        </setInstallerVariable>
        <actionGroup>
          <actionList>
            <registryGet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\PostgreSQL\Installations\postgresql-${product_version}</key>
              <name>Base Directory</name>
              <variable>iBaseDirectory</variable>
            </registryGet>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
        <setInstallerVariable>
          <name>IsUpgrade</name>
          <persist>1</persist>
          <value>1</value>
          <ruleList>
            <stringTest>
              <text>${iBaseDirectory}</text>
              <type>not_empty</type>
            </stringTest>
          </ruleList>
        </setInstallerVariable>
        <createDirectory path="${ppss_temp_directory}"/>
    
        <actionGroup>
          <actionList>
            <unpackDirectory>
              <component>dbserver</component>
              <destination>${ppss_temp_directory}\</destination>
              <folder>programfileswindows</folder>
              <origin>pgcontrol</origin>
            </unpackDirectory>
    
            <!-- We will also need to get the VC++ runtimes installed on Windows, before we do anything with binaries -->
            <unpackFile>
              <component>dbserver</component>
              <destination>${ppss_temp_directory}\vcredist_x86.exe</destination>
              <folder>programfileswindows</folder>
              <origin>vcredist_x86.exe</origin>
              <customErrorMessage>${msg(error.installing.runtimes)}</customErrorMessage>
            </unpackFile>
            <unpackFile>
              <component>dbserver</component>
              <destination>${ppss_temp_directory}\installruntimes.vbs</destination>
              <folder>programfileswindows</folder>
              <origin>installruntimes.vbs</origin>
              <customErrorMessage>${msg(error.installing.runtimes)}</customErrorMessage>
            </unpackFile>
            <runProgram>
              <program>cscript</program>
              <programArguments>//NoLogo "${ppss_temp_directory}\installruntimes.vbs" "${ppss_temp_directory}\vcredist_x86.exe"</programArguments>
              <abortOnError>1</abortOnError>
              <showMessageOnError>1</showMessageOnError>
              <customErrorMessage>${msg(error.installing.runtimes)}</customErrorMessage>
            </runProgram>
            <throwError>
              <text>${msg(script.command.line.error)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>127</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </throwError>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
    
        <!-- Preinstall script -->
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/preinstall.sh</destination>
          <folder>programfilesmacosx</folder>
          <origin>preinstall.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/validateUserClient.o</destination>
          <folder>programfileslinux</folder>
          <origin>validateUserClient.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/validateUserClient.o</destination>
          <folder>programfileslinux-x64</folder>
          <origin>validateUserClient.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/runvalidateUserClient.sh</destination>
          <folder>programfileslinux</folder>
          <origin>runvalidateUserClient.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/runvalidateUserClient.sh</destination>
          <folder>programfileslinux-x64</folder>
          <origin>runvalidateUserClient.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/dynaTuneClient.o</destination>
          <folder>programfileslinux</folder>
          <origin>dynaTuneClient.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/dynaTuneClient.o</destination>
          <folder>programfileslinux-x64</folder>
          <origin>dynaTuneClient.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/rundynaTuneClient.sh</destination>
          <folder>programfileslinux</folder>
          <origin>rundynaTuneClient.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/rundynaTuneClient.sh</destination>
          <folder>programfileslinux-x64</folder>
          <origin>rundynaTuneClient.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/isUserValidated.o</destination>
          <folder>programfileslinux</folder>
          <origin>isUserValidated.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/isUserValidated.o</destination>
          <folder>programfileslinux-x64</folder>
          <origin>isUserValidated.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/runisUserValidated.sh</destination>
          <folder>programfileslinux</folder>
          <origin>runisUserValidated.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/runisUserValidated.sh</destination>
          <folder>programfileslinux-x64</folder>
          <origin>runisUserValidated.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <unpackDirectory>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/</destination>
          <folder>programfileslinux</folder>
          <origin>lib</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackDirectory>
        <unpackDirectory>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/</destination>
          <folder>programfileslinux-x64</folder>
          <origin>lib</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackDirectory>
    
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/modifyPostgresql.o</destination>
          <folder>programfileslinux</folder>
          <origin>modifyPostgresql.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/modifyPostgresql.o</destination>
          <folder>programfileslinux-x64</folder>
          <origin>modifyPostgresql.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <!-- generate uuid script -->
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/generate_uuid.sh</destination>
          <folder>programfileslinux</folder>
          <origin>generate_uuid.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/generate_uuid.sh</destination>
          <folder>programfileslinux-x64</folder>
          <origin>generate_uuid.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <!-- run generate_uuid.sh -->
        <actionGroup>
          <actionList>
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/generate_uuid.sh</program>
              <programArguments></programArguments>
              <showMessageOnError>0</showMessageOnError>
            </runProgram>
          </actionList>
          <ruleList>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <!-- generate sysinfo script -->
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/sysinfo.sh</destination>
          <folder>programfileslinux</folder>
          <origin>sysinfo.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/sysinfo.sh</destination>
          <folder>programfileslinux-x64</folder>
          <origin>sysinfo.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <!-- run sysinfo.sh -->
        <actionGroup>
          <actionList>
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/sysinfo.sh</program>
              <programArguments></programArguments>
              <showMessageOnError>0</showMessageOnError>
            </runProgram>
          </actionList>
          <ruleList>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <!-- Getlocales script -->
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/getlocales.sh</destination>
          <folder>programfileslinux</folder>
          <origin>getlocales.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/getlocales.sh</destination>
          <folder>programfileslinux-x64</folder>
          <origin>getlocales.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
    
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/getlocales.sh</destination>
          <folder>programfilesmacosx</folder>
          <origin>getlocales.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/validateUserClient.o</destination>
          <folder>programfilesmacosx</folder>
          <origin>validateUserClient.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/dynaTuneClient.o</destination>
          <folder>programfilesmacosx</folder>
          <origin>dynaTuneClient.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/modifyPostgresql.o</destination>
          <folder>programfilesmacosx</folder>
          <origin>modifyPostgresql.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/isUserValidated.o</destination>
          <folder>programfilesmacosx</folder>
          <origin>isUserValidated.o</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <!-- generate uuid script -->
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/generate_uuid.sh</destination>
          <folder>programfilesmacosx</folder>
          <origin>generate_uuid.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <!-- run generate_uuid.sh -->
        <actionGroup>
          <actionList>
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/generate_uuid.sh</program>
              <programArguments></programArguments>
              <showMessageOnError>0</showMessageOnError>
            </runProgram>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <!-- generate sysinfo script -->
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/sysinfo.sh</destination>
          <folder>programfilesmacosx</folder>
          <origin>sysinfo.sh</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <!-- run sysinfo.sh -->
        <actionGroup>
          <actionList>
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/sysinfo.sh</program>
              <programArguments></programArguments>
              <showMessageOnError>0</showMessageOnError>
            </runProgram>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <!--Unpack Windows scripts-->
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/getlocales.exe</destination>
          <folder>programfileswindows</folder>
          <origin>getlocales.exe</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/createuser.exe</destination>
          <folder>programfileswindows</folder>
          <origin>createuser.exe</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/validateuser.exe</destination>
          <folder>programfileswindows</folder>
          <origin>validateuser.exe</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/validateUserClient.exe</destination>
          <folder>programfileswindows</folder>
          <origin>validateUserClient.exe</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/getDynaTune.exe</destination>
          <folder>programfileswindows</folder>
          <origin>getDynaTune.exe</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/modifyPostgresql.exe</destination>
          <folder>programfileswindows</folder>
          <origin>modifyPostgresql.exe</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </unpackFile>
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/isUserValidated.exe</destination>
          <folder>programfileswindows</folder>
          <origin>isUserValidated.exe</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <!-- generate uuid script -->
        <unpackFile>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}\dbserver_guid.exe</destination>
          <folder>programfileswindows</folder>
          <origin>dbserver_guid.exe</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </unpackFile>
    
        <setInstallerVariableFromScriptOutput>
          <customErrorMessage>${msg(ws.exception.from.server)}</customErrorMessage>
          <exec>${ppss_temp_directory}\dbserver_guid.exe</exec>
          <execArgs></execArgs>
          <name>dbserver_guid_result</name>
          <workingDirectory>${ppss_temp_directory}</workingDirectory>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariableFromScriptOutput>
    
        <writeFile>
          <path>${ppss_temp_directory}/a.properties</path>
          <text>${dbserver_guid_result}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </writeFile>
    
    
        <!-- pg_controldata (used to check existing clusters) -->
    
        <!-- Starts here -->
        <unpackDirectory>
          <component>dbserver</component>
          <destination>${ppss_temp_directory}/</destination>
          <folder>programfilesmacosx</folder>
          <origin>pgcontrol</origin>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </unpackDirectory>
    
        <actionGroup>
          <actionList>
            <unpackDirectory>
              <component>dbserver</component>
              <destination>${ppss_temp_directory}/</destination>
              <folder>programfileslinux</folder>
              <origin>pgcontrol</origin>
            </unpackDirectory>
            <unpackFile>
              <component>dbserver</component>
              <destination>${ppss_temp_directory}/runpgcontroldata.sh</destination>
              <folder>programfileslinux</folder>
              <origin>runpgcontroldata.sh</origin>
            </unpackFile>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <actionGroup>
          <actionList>
            <unpackDirectory>
              <component>dbserver</component>
              <destination>${ppss_temp_directory}/</destination>
              <folder>programfileslinux-x64</folder>
              <origin>pgcontrol</origin>
            </unpackDirectory>
            <unpackFile>
              <component>dbserver</component>
              <destination>${ppss_temp_directory}/runpgcontroldata.sh</destination>
              <folder>programfileslinux-x64</folder>
              <origin>runpgcontroldata.sh</origin>
            </unpackFile>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <!-- Ends here -->
    
        <actionGroup>
          <actionList>
            <!-- Get the existing data directory. -->
            <iniFileGet>
              <file>${PostgreSqlIni}</file>
              <key>DataDirectory</key>
              <section>PostgreSQL/${product_version}</section>
              <variable>iDataDirectory</variable>
              <ruleList>
                <fileTest>
                  <condition>readable</condition>
                  <path>${PostgreSqlIni}</path>
                </fileTest>
              </ruleList>
            </iniFileGet>
            <setInstallerVariable>
              <name>iDataDirectory</name>
              <persist>0</persist>
              <value></value>
              <ruleList>
                <fileTest>
                  <condition>not_readable</condition>
                  <path>${PostgreSqlIni}</path>
                </fileTest>
              </ruleList>
            </setInstallerVariable>
    
            <!-- Get the base installation path. Any previous package could have set this. -->
            <iniFileGet>
              <file>${PostgreSqlIni}</file>
              <key>InstallationDirectory</key>
              <section>PostgreSQL/${product_version}</section>
              <variable>iBaseDirectory</variable>
              <ruleList>
                <fileTest>
                  <condition>readable</condition>
                  <path>${PostgreSqlIni}</path>
                </fileTest>
              </ruleList>
            </iniFileGet>
            <setInstallerVariable>
              <name>iBaseDirectory</name>
              <persist>0</persist>
              <value></value>
              <ruleList>
                <fileTest>
                  <condition>not_readable</condition>
                  <path>${PostgreSqlIni}</path>
                </fileTest>
              </ruleList>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <!-- WIN: Get existing directories -->
        <actionGroup>
          <actionList>
            <!-- Get the existing data directory. -->
            <registryGet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\PostgreSQL\Installations\postgresql-${product_version}</key>
              <name>Data Directory</name>
              <variable>iDataDirectory</variable>
            </registryGet>
    
            <!-- Get the existing installation directory. -->
            <registryGet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\PostgreSQL\Installations\postgresql-${product_version}</key>
              <name>Base Directory</name>
              <variable>iBaseDirectory</variable>
            </registryGet>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <!-- If we have an existing data directory location and it's not empty, check it looks sane -->
        <actionGroup>
          <!-- Starts here -->
          <actionList>
    
            <!-- Do we have a pg_control file? -->
            <throwError>
              <text>${msg(error.data.directory.registered.broken)}</text>
              <ruleList>
                <fileTest>
                  <path>${iDataDirectory}/global/pg_control</path>
                  <condition>not_exists</condition>
                </fileTest>
              </ruleList>
            </throwError>
    
            <!-- Do we have a valid catalog version? -->
            <runProgram>
              <program>${ppss_temp_directory}/pgcontrol/bin/pg_controldata</program>
              <programArguments>"${iDataDirectory}"</programArguments>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>osx</value>
                </compareText>
              </ruleList>
            </runProgram>
    
            <runProgram>
              <program>${ppss_temp_directory}/runpgcontroldata.sh</program>
              <programArguments>${ppss_temp_directory}/pgcontrol "${iDataDirectory}"</programArguments>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
              </ruleList>
            </runProgram>
    
            <runProgram>
              <program>${ppss_temp_directory}\pgcontrol\pg_controldata.exe</program>
              <programArguments>"${iDataDirectory}"</programArguments>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </runProgram>
    
            <setInstallerVariableFromRegEx>
              <name>CurrentCatalogVersion</name>
              <text>${program_stdout}</text>
              <pattern>^.*Catalog version number:\s+([\d]+).*$</pattern>
              <substitution>\1</substitution>
            </setInstallerVariableFromRegEx>
    
            <logMessage>
              <text>Existing cluster catalog version: ${CurrentCatalogVersion}, installer catalog version: ${CatalogVersion}</text>
            </logMessage>
    
            <throwError>
              <text>${msg(error.data.directory.incompatible)}</text>
              <ruleList>
                <compareText>
                  <value>${CurrentCatalogVersion}</value>
                  <logic>does_not_equal</logic>
                  <text>${CatalogVersion}</text>
                </compareText>
              </ruleList>
            </throwError>
    
          </actionList>
          <!-- Ends here -->
          <ruleList>
            <stringTest>
              <text>${iDataDirectory}</text>
              <type>not_empty</type>
            </stringTest>
            <fileExists>
              <path>${iDataDirectory}</path>
            </fileExists>
            <fileTest>
              <condition>is_not_empty</condition>
              <path>${iDataDirectory}</path>
            </fileTest>
          </ruleList>
        </actionGroup>

        <actionGroup>
          <actionList>
            <!-- Set the installdir in case of an Upgrade -->
            <setInstallerVariable>
              <name>installdir</name>
              <persist>0</persist>
              <value>${iBaseDirectory}</value>
            </setInstallerVariable>
    
            <!-- Read servicename, serviceaccount & superaccount from windows registry -->
            <actionGroup>
              <actionList>
    
                <!-- Get the currently installed version -->
                <registryGet name="Version" variable="iVersion"
                  key="HKEY_LOCAL_MACHINE\SOFTWARE\PostgreSQL\Installations\postgresql-${product_version}"/>
    
                <!-- Get the ServiceName -->
                <registryGet name="Service ID" variable="iServiceName"
                  key="HKEY_LOCAL_MACHINE\SOFTWARE\PostgreSQL\Installations\postgresql-${product_version}"/>
    
                <!-- Get the Serviceaccount (OS User) -->
                <registryGet name="Service Account" variable="iServiceAccount"
                  key="HKEY_LOCAL_MACHINE\SOFTWARE\PostgreSQL\Installations\postgresql-${product_version}"/>
    
                <!-- Get the Superuser -->
                <registryGet name="Super User" variable="iSuperAccount"
                  key="HKEY_LOCAL_MACHINE\SOFTWARE\PostgreSQL\Installations\postgresql-${product_version}"/>
              </actionList>
              <ruleList>
                <compareText logic="equals" text="${platform_name}" value="windows"/>
              </ruleList>
            </actionGroup>
    
            <!-- Read servicename, serviceaccount & superaccount from /etc/postgres-reg.ini -->
            <actionGroup>
              <actionList>
                <!-- Get the currently installed version -->
                <iniFileGet file="${PostgreSqlIni}" section="PostgreSQL/${product_version}"
                  key="Version" variable="iVersion"/>
    
                <!-- Get the ServiceName -->
                <iniFileGet file="${PostgreSqlIni}" section="PostgreSQL/${product_version}"
                  key="ServiceID" variable="iServiceName"/>
    
                <!-- Get the Serviceaccount (OS User) -->
                <iniFileGet file="${PostgreSqlIni}" section="PostgreSQL/${product_version}"
                  key="Serviceaccount" variable="iServiceAccount"/>
    
                <!-- Get the Superuser -->
                <iniFileGet file="${PostgreSqlIni}" section="PostgreSQL/${product_version}"
                  key="Superuser" variable="iSuperAccount"/>
              </actionList>
              <ruleList>
                <fileTest condition="readable" path="${PostgreSqlIni}"/>
                <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
              </ruleList>
            </actionGroup>
          </actionList>
          <ruleList>
            <stringTest text="${iBaseDirectory}" type="not_empty"/>
            <fileExists path="${iBaseDirectory}"/>
            <fileTest condition="is_not_empty" path="${iBaseDirectory}"/>
          </ruleList>
        </actionGroup>
    
        <!-- Debugging -->
        <logMessage>
          <text>Existing base directory: ${iBaseDirectory}</text>
        </logMessage>
        <logMessage>
          <text>Existing data directory: ${iDataDirectory}</text>
        </logMessage>
     
        <!-- So, is this an upgrade of an existing cluster? 
             At this point, if we have an existing data directory it either looks valid, or is empty -->
        <actionGroup>
          <actionList>
            <setInstallerVariable>
              <name>IsUpgrade</name>
              <persist>0</persist>
              <value>1</value>
            </setInstallerVariable>
            <setInstallerVariable>
              <name>datadir</name>
              <persist>0</persist>
              <value>${iDataDirectory}</value>
            </setInstallerVariable>
            <logMessage>
              <text>Switching to upgrade mode with cluster: ${datadir}</text>
            </logMessage>
          </actionList>
          <ruleList>
            <stringTest>
              <text>${iDataDirectory}</text>
              <type>not_empty</type>
            </stringTest>
            <fileExists>
              <path>${iDataDirectory}</path>
            </fileExists>
            <fileTest>
              <condition>is_not_empty</condition>
              <path>${iDataDirectory}</path>
            </fileTest>
          </ruleList>
        </actionGroup>
    
        <!-- MAC: Preinstall script. -->
        <actionGroup>
          <actionList>
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/preinstall.sh</program>
              <programArguments></programArguments>
              <showMessageOnError>0</showMessageOnError>
            </runProgram>
            <logMessage>
              <text>Checking for Preinstall libraries</text>
            </logMessage>
            <!-- Check the output from the preinstall script -->
            <throwError>
              <text>${msg(error.shared.memory.manual)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>1</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </throwError>
            <throwError>
              <text>${msg(error.shared.memory.updated)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>2</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </throwError>
            <throwError>
              <text>${msg(error.shared.memory.shmall.manual)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>3</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </throwError>
            <throwError>
              <text>${msg(error.shared.memory.shmall.updated)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>4</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </throwError>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <stringModify text="${superaccount}" variable="superaccount" logic="trim"/>
        <stringModify text="${serviceaccount}" variable="serviceaccount" logic="trim"/>
        <!-- Save the service-password provided through the command-line into a
             variable called cliServicePassword -->
        <setInstallerVariable name="cliServicePassword" value="${servicepassword}"/>
    
        <!-- SECTION: START: ServiceName -->
        <!-- New installation and got the service-name through the command-line -->
        <actionGroup>
          <actionList>
            <!--
              1. Validate the service name
    
              Service name must match the following criteria:
              * Starts with any alphabet
              * Ends with alphanumeric character
              * atleast 6 characters long
              * Maximum length 50 characters
              * - (hyphen), . (dot), _ (underscore) are allowed characters
              i.e. postgresql-8.4, pg_8_4, pgsql-8.3.8_1
              -->
            <throwError>
              <customErrorMessage>${msg(servicename.not.valid)}</customErrorMessage>
              <text>Unknown Error</text>
              <ruleList>
                <regExMatch>
                  <text>${servicename}</text>
                  <logic>does_not_match</logic>
                  <pattern>^([a-zA-Z]{1})([0-9a-zA-Z_\.\-]{4,48})([0-9a-zA-Z]{1})$</pattern>
                </regExMatch>
              </ruleList>
            </throwError>
    
            <!--
              2. Check if service already exists with the same name
              -->
            <!-- WIN -->
            <actionGroup>
              <actionList>
                <getUniqueWindowsServiceName>
                  <selectedServiceNameVariable>temp_service_name</selectedServiceNameVariable>
                  <serviceName>${servicename}</serviceName>
                </getUniqueWindowsServiceName>
                <throwError>
                  <customErrorMessage>${msg(servicename.already.exists.windows)}</customErrorMessage>
                  <text>Duplicate Service Exists</text>
                  <ruleList>
                    <compareText text="${servicename}" logic="does_not_equal" value="${temp_service_name}" />
                  </ruleList>
                </throwError>
              </actionList>
              <ruleList>
                <compareText logic="equals" text="${platform_name}" value="windows"/>
              </ruleList>
            </actionGroup>
    
            <!-- LIN/LIN-X64 -->
            <throwError>
              <customErrorMessage>${msg(servicename.already.exists.linux)}</customErrorMessage>
              <text>Duplicate Service Exists</text>
              <ruleList>
                <compareText logic="contains" text="${platform_name}" value="linux"/>
                <fileExists path="/etc/init.d/${servicename}"/>
              </ruleList>
            </throwError>
    
            <!-- OSX -->
            <throwError>
              <customErrorMessage>${msg(servicename.already.exists.osx)}</customErrorMessage>
              <text>Duplicate Service Exists</text>
              <ruleList>
                <compareText logic="contains" text="${platform_name}" value="osx"/>
                <fileExists path="/Library/LaunchDaemons/com.edb.launchd.${servicename}.plist"/>
              </ruleList>
            </throwError>
          </actionList>
          <ruleList>
            <stringTest text="${servicename}" type="not_empty"/>
            <stringTest text="${iServiceName}" type="empty"/>
            <stringTest text="${iVersion}" type="empty"/>
          </ruleList>
        </actionGroup>
    
        <!-- Existing install, with servicename. Ignore command line. -->
        <setInstallerVariable name="servicename" persist="1" value="${iServiceName}">
          <ruleList>
            <stringTest text="${iServiceName}" type="not_empty"/>
            <stringTest text="${iVersion}" type="not_empty"/>
          </ruleList>
        </setInstallerVariable>
    
        <!-- Existing install, without servicename. Ignore command line. -->
        <setInstallerVariable name="servicename" persist="1" value="postgresql-PG_MAJOR_VERSION">
          <ruleList>
            <stringTest text="${iServiceName}" type="empty"/>
            <stringTest text="${iVersion}" type="not_empty"/>
          </ruleList>
        </setInstallerVariable>
    
        <!-- New install, with nothing set on command line -->
        <setInstallerVariable name="servicename" persist="1" value="postgresql-PG_MAJOR_VERSION">
          <ruleList>
            <stringTest text="${servicename}" type="empty"/>
          </ruleList>
        </setInstallerVariable>
        <!-- SECTION: END: ServiceName -->
    
        <!-- SECTION: START: ServiceAccount -->
    
        <!-- Existing install, with serviceaccount. Ignore command line. -->
        <setInstallerVariable name="serviceaccount" value="${iServiceAccount}">
          <ruleList>
             <stringTest text="${iServiceAccount}" type="not_empty"/>
          </ruleList>
        </setInstallerVariable>
    
        <!-- Older version of installer for this version of PostgreSQL installed, but service-account not given -->
        <setInstallerVariable name="serviceaccount" value="postgres">
          <ruleList>
            <stringTest text="${iBaseDirectory}" type="not_empty"/>
            <fileExists path="${iBaseDirectory}"/>
            <fileTest condition="is_not_empty" path="${iBaseDirectory}"/>
             <stringTest text="${iServiceAccount}" type="empty"/>
          </ruleList>
        </setInstallerVariable>
    
        <!-- New install, with nothing set on command line -->
        <setInstallerVariable name="serviceaccount"  value="postgres">
          <ruleList>
             <stringTest text="${serviceaccount}" type="empty"/>
          </ruleList>
        </setInstallerVariable>
        <!-- SECTION: END: ServiceAccount -->
    
        <!-- SECTION: START: SuperAccount -->
        <!-- Existing install, with serviceaccount. Ignore command-line. -->
        <setInstallerVariable name="superaccount" value="${iSuperAccount}">
          <ruleList>
             <stringTest text="${iSuperAccount}" type="not_empty"/>
          </ruleList>
        </setInstallerVariable>
    
        <!-- New install, with nothing set on command line -->
        <setInstallerVariable name="superaccount"  value="postgres">
          <ruleList>
             <stringTest text="${superaccount}" type="empty"/>
          </ruleList>
        </setInstallerVariable>
    
        <!-- Used supername at all the places, copying superaccount to supername variable -->
        <setInstallerVariable name="supername" value="${superaccount}"/>
    
        <actionGroup>
          <actionList>
            <!-- seperate out domain name from ${serviceaccount} and assign it to ${servicedomain} -->
            <setInstallerVariable name="servicedomain" value="."/>
            <setInstallerVariableFromRegEx name="servicedomain"
                text="${serviceaccount}" pattern="\\.*" substitution="">
              <ruleList>
                 <compareText text="${serviceaccount}" logic="contains" value="\"/>
              </ruleList>
            </setInstallerVariableFromRegEx>
    
            <!-- we need serviceaccount without domain details -->
            <setInstallerVariable name="serviceaccount_wo_domain"
                value="${serviceaccount}">
              <ruleList>
                <compareText text="${serviceaccount}" logic="does_not_contain" value="\"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariableFromRegEx name="serviceaccount_wo_domain"
                text="${serviceaccount}" pattern="^.*?\\" substitution="">
              <ruleList>
                <compareText text="${serviceaccount}" logic="contains" value="\"/>
              </ruleList>
            </setInstallerVariableFromRegEx>
          </actionList>
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="windows"/>
          </ruleList>
        </actionGroup>
    
        <!-- SECTION: END: SuperAccount -->
    
        <!-- Get the locales available -->
        <actionGroup>
          <actionList>
            <addChoiceOptions>
              <name>locale</name>
              <optionList>
                <option>
                  <description></description>
                  <image></image>
                  <text>[${msg(default.locale)}]</text>
                  <value>DEFAULT</value>
                </option>
              </optionList>
            </addChoiceOptions>
            <runProgram>
              <program>${ppss_temp_directory}/getlocales.sh</program>
              <programArguments></programArguments>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </runProgram>
            <runProgram>
              <program>${ppss_temp_directory}\getlocales.exe</program>
              <programArguments></programArguments>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </runProgram>
            <throwError>
              <text>${msg(script.command.line.error)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>127</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </throwError>
            <addChoiceOptionsFromText>
              <name>locale</name>
              <text>${program_stdout}</text>
            </addChoiceOptionsFromText>
          </actionList>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <throwError>
          <text>${msg(locale.error)}</text>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <text>${locale}</text>
              <value/>
              <logic>does_not_equal</logic>
            </compareText>
            <compareText>
              <text>${program_stdout}</text>
              <value>${locale}</value>
              <logic>does_not_contain</logic>
            </compareText>
          </ruleList>
        </throwError>
    
        <!-- Set the default locale if needed. -->
        <actionGroup>
          <actionList>
            <setInstallerVariable>
              <name>locale</name>
              <persist>0</persist>
              <value>DEFAULT</value>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <stringTest>
              <text>${locale}</text>
              <type>empty</type>
            </stringTest>
          </ruleList>
        </actionGroup>
    
        <!-- Convert the locale value to something the choiceParameter will like -->
        <setInstallerVariableFromRegEx>
          <name>locale</name>
          <pattern>_</pattern>
          <substitution>xxUSxx</substitution>
          <text>${locale}</text>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>locale</name>
          <pattern>\.</pattern>
          <substitution>xxDOTxx</substitution>
          <text>${locale}</text>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>locale</name>
          <pattern>-</pattern>
          <substitution>xxDASHxx</substitution>
          <text>${locale}</text>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>locale</name>
          <pattern>@</pattern>
          <substitution>xxATxx</substitution>
          <text>${locale}</text>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>locale</name>
          <pattern>\s</pattern>
          <substitution>xxSPxx</substitution>
          <text>${locale}</text>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>locale</name>
          <pattern>\(</pattern>
          <substitution>xxOBxx</substitution>
          <text>${locale}</text>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>locale</name>
          <pattern>\)</pattern>
          <substitution>xxCBxx</substitution>
          <text>${locale}</text>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>locale</name>
          <pattern>,</pattern>
          <substitution>xxCOMMAxx</substitution>
          <text>${locale}</text>
        </setInstallerVariableFromRegEx>
    
        <!-- Check whether pgAgent was installed previously -->
        <iniFileGet>
          <file>/etc/postgresplus-reg.ini</file>
          <key>pgagent</key>
          <section>PostgreSQL/${product_version}</section>
          <variable>pgagent_installed</variable>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <fileExists>
              <path>/etc/postgresplus-reg.ini</path>
            </fileExists>
          </ruleList>
        </iniFileGet>
        <registryGet>
            <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\pgAgent</key>
            <name>Version</name>
            <variable>pgagent_installed</variable>
        </registryGet>
    
        <!-- Set schema to upgrade if pgagent is installed -unattended mode -->
        <setInstallerVariable name="schema" value="upgrade">
            <ruleList>
                <isTrue>
                   <value>${pgagent_installed}</value>
                </isTrue>
                <compareText>
                   <logic>equals</logic>
                   <text>${installer_ui}</text>
                   <value>unattended</value>
                </compareText>
            </ruleList>
        </setInstallerVariable>
    
        <!-- In upgrade Mode:
             * Deselect all the components.
             * Check for the components, which were installed previously.
             * Select the previously installed components and mark them as not editable, if user has not uninstall them manually
        -->
        <actionGroup>
          <actionList>
            <actionGroup>
              <actionList>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>databaseServer</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_dbserver</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>slony</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_slony</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>pgJdbc</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_pgjdbc</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>sbp</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_sbp</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>postgis</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_postgis</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>psqlOdbc</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_psqlOdbc</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>pgbouncer</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_pgbouncer</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>pgmemcache</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_pgmemcache</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>pgagent</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_pgagent</variable>
                </iniFileGet>
                <iniFileGet>
                  <file>/etc/postgresplus-reg.ini</file>
                  <key>npgsql</key>
                  <section>PostgreSQL/${product_version}</section>
                  <variable>upgrade_npgsql</variable>
                </iniFileGet>
              </actionList>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
                <fileExists>
                   <path>/etc/postgresplus-reg.ini</path>
                </fileExists>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>databaseServer</name>
                  <variable>upgrade_dbserver</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>slony</name>
                  <variable>upgrade_slony</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>pgJdbc</name>
                  <variable>upgrade_pgjdbc</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>sbp</name>
                  <variable>upgrade_sbp</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>postgis</name>
                  <variable>upgrade_postgis</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>psqlOdbc</name>
                  <variable>upgrade_psqlOdbc</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>npgsql</name>
                  <variable>upgrade_npgsql</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>pgmemcache</name>
                  <variable>upgrade_pgmemcache</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>pgbouncer</name>
                  <variable>upgrade_pgbouncer</variable>
                </registryGet>
                <registryGet>
                  <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
                  <name>pgagent</name>
                  <variable>upgrade_pgagent</variable>
                </registryGet>
              </actionList>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </actionGroup>
            <componentSelection>
              <deselect>dbserver,slony,pgJdbc,postgis,psqlOdbc,npgsql,pgbouncer,pgmemcache,pgagent</deselect>
              <ruleEvaluationLogic>or</ruleEvaluationLogic>
              <ruleList>
                <isTrue value="${upgrade_dbserver}"/>
                <isTrue value="${upgrade_slony}"/>
                <isTrue value="${upgrade_pgjdbc}"/>
                <isTrue value="${upgrade_postgis}"/>
                <isTrue value="${upgrade_pgagent}"/>
                <isTrue value="${upgrade_pgmemcache}"/>
                <isTrue value="${upgrade_pgbouncer}"/>
                <isTrue value="${upgrade_npgsql}"/>
                <isTrue value="${upgrade_psqlOdbc}"/>
              </ruleList>
            </componentSelection>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>dbserver</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(dbserver).canBeEdited</name>
                  <value>0</value>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_dbserver}"/>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>slony</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(slony).canBeEdited</name>
                  <value>0</value>
                  <ruleEvaluationLogic>or</ruleEvaluationLogic>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_slony}"/>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>pgJdbc</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(pgJdbc).canBeEdited</name>
                  <value>0</value>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_pgjdbc}"/>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>postgis</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(postgis).canBeEdited</name>
                  <value>0</value>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_postgis}"/>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>psqlOdbc</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(psqlOdbc).canBeEdited</name>
                  <value>0</value>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_psqlOdbc}"/>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>npgsql</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(npgsql).canBeEdited</name>
                  <value>0</value>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_npgsql}"/>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>pgbouncer</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(pgbouncer).canBeEdited</name>
                  <value>0</value>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_pgbouncer}"/>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>pgmemcache</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(pgmemcache).canBeEdited</name>
                  <value>0</value>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_pgmemcache}"/>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <componentSelection>
                  <select>pgagent</select>
                </componentSelection>
                <setInstallerVariable>
                  <name>component(pgagent).canBeEdited</name>
                  <value>0</value>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <isTrue value="${upgrade_pgagent}"/>
              </ruleList>
            </actionGroup>
          </actionList>
          <ruleList>
            <isTrue>
              <value>${IsUpgrade}</value>
            </isTrue>
          </ruleList>
        </actionGroup>
    
        <!-- We need to figure out whether we are using an existing cluster / upgrading from only postgresql -->
    
        <setInstallerVariable name="showInstallationTuning" value="0">
           <ruleList>
              <stringTest>
                <text>${iDataDirectory}</text>
                <type>not_empty</type>
              </stringTest>
              <fileExists>
                <path>${iDataDirectory}</path>
              </fileExists>
              <fileTest>
                <condition>is_not_empty</condition>
                <path>${iDataDirectory}</path>
              </fileTest>
          </ruleList>
        </setInstallerVariable>
    
        <!-- Check whether UpdateMonitoring is installed -->
        <iniFileGet file="/etc/postgres-reg.ini" section="StackBuilderPlus_PG_PG_VERSION_STR" key="MonitorServer" variable="iMonitorServer">
           <ruleList>
                <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
           </ruleList>
        </iniFileGet>
        <registryGet name="MonitorServer" key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\StackBuilderPlus_PG_PG_VERSION_STR" variable="iMonitorServer">
           <ruleList>
                <compareText logic="equals" text="${platform_name}" value="windows"/>
           </ruleList>
        </registryGet>
    
        <setInstallerVariable  name="showUpdateNotification" value="0" > 
           <ruleList>
                <compareText logic="does_not_equal" text="${iMonitorServer}" value=""/>
           </ruleList>
        </setInstallerVariable>
    
        <setInstallerVariable  name="showValueAddedServicePage" value="0" > 
           <ruleList>
                <compareText logic="equals" text="${showInstallationTuning}" value="0"/>
                <compareText logic="equals" text="${showUpdateNotification}" value="0"/>
           </ruleList>
        </setInstallerVariable>

      </actionList>
      <ruleList>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </actionGroup>
  </preInstallationActionList>
  <postInstallationActionList>
    <setInstallerVariable name="monitor_server" value="">
      <ruleList>
        <isFalse value="${updateNotification}"/>
      </ruleList>
    </setInstallerVariable>
    <setInstallerVariable name="monitor_server" value="--server PG_MAJOR_VERSION">
      <ruleEvaluationLogic>or</ruleEvaluationLogic>
      <ruleList>
        <isTrue value="${updateNotification}"/>
        <isTrue value="${extract_mode}"/>
      </ruleList>
    </setInstallerVariable>

    <!-- Do not perform these action in extract-only mode -->
    <actionGroup>
      <actionList>

        <!-- Make sure: we set the servicepassword to superpassword, if not provided through the command-line -->
        <setInstallerVariable name="servicepassword" value="${superpassword}">
          <ruleList>
            <stringTest type="empty" text="${cliServicePassword}"/>
            <stringTest text="${servicepassword}" type="empty"/>
          </ruleList>
        </setInstallerVariable>
    
        <actionGroup>
          <actionList>
            <!-- FB#13072: Installation on Windows 2008 fails in unattended mode: password complexity requirement not met -->
            <!-- Unattended mode: Stop installation, if user creation/validation fails on windows -->
            <actionGroup>
              <actionList>
                <runProgram>
                  <program>${ppss_temp_directory}\createuser.exe</program>
                  <!-- The dot at the beginning of the arguments is the domain -->
                  <programArguments>"${servicedomain}" "${serviceaccount_wo_domain}" "${servicepassword.password}"</programArguments>
                  <abortOnError>0</abortOnError>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>
                <setInstallerVariable name="createuser_exist_code" value="${program_exit_code}"/>
                <throwError text="${msg(script.command.line.error)}">
                  <ruleList>
                    <compareText logic="equals" text="127" value="${createuser_exist_code}"/>
                  </ruleList>
                </throwError>
                <throwError text="${msg(error.could.not.create.user)}">
                  <ruleList>
                    <compareText logic="does_not_equal" text="2224" value="${createuser_exist_code}"/>
                    <compareText logic="does_not_equal" text="2203" value="${createuser_exist_code}"/>
                    <compareText logic="does_not_equal" text="2245" value="${createuser_exist_code}"/>
                    <compareText logic="does_not_equal" text="0" value="${createuser_exist_code}"/>
                  </ruleList>
                </throwError>
                <throwError text="${msg(config.superpassword.format.error.windows)}">
                  <ruleEvaluationLogic>or</ruleEvaluationLogic>
                  <ruleList>
                    <compareText logic="equals" text="2203" value="${createuser_exist_code}"/>
                    <compareText logic="equals" text="2245" value="${createuser_exist_code}"/>
                  </ruleList>
                </throwError>
                <runProgram>
                  <abortOnError>0</abortOnError>
                  <program>${ppss_temp_directory}\validateuser.exe</program>
                  <programArguments>"${servicedomain}" "${serviceaccount_wo_domain}" "${servicepassword.password}"</programArguments>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>
                <setInstallerVariable name="validateuser_exit_code" value="${program_exit_code}"/>
                <throwError text="${msg(script.command.line.error)}">
                  <ruleList>
                    <compareText logic="equals" text="127" value="${validateuser_exit_code}"/>
                  </ruleList>
                </throwError>
                <throwError text="${msg(config.servicepassword.incorrect)}">
                  <ruleList>
                    <compareText logic="does_not_equal" text="0" value="${validateuser_exit_code}"/>
                  </ruleList>
                </throwError>
              </actionList>
              <ruleList>
                <compareText logic="equals" text="${platform_name}" value="windows"/>
                <compareText logic="equals" text="${installer_ui}" value="unattended"/>
              </ruleList>
            </actionGroup>
            <deleteFile>
              <path>${ppss_temp_directory}/a.properties</path>
            </deleteFile>
            <deleteFile>
              <path>${ppss_temp_directory}/sysinfo.properties</path>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </deleteFile>
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>databaseServer</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(dbserver).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
              <name>databaseServer</name>
              <type>REG_SZ</type>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(dbserver).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </registrySet>
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>slony</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(slony).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
              <name>slony</name>
              <type>REG_SZ</type>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(slony).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </registrySet>
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>pgJdbc</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(pgJdbc).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
              <name>pgJdbc</name>
              <type>REG_SZ</type>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(pgJdbc).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </registrySet>
            <iniFileSet file="/etc/postgresplus-reg.ini"
                        key="sbp"
                        value="true"
                        section="PostgreSQL/${product_version}">
              <ruleList>
                <isTrue value="${component(stackbuilderplus).selected}"/>
                <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
              </ruleList>
            </iniFileSet>
            <registrySet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                         name="sbp"
                         type="REG_SZ"
                         value="true">
              <ruleList>
                <isTrue value="${component(stackbuilderplus).selected}"/>
                <compareText logic="equals" text="${platform_name}" value="windows"/>
              </ruleList>
            </registrySet>
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>postgis</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(postgis).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
              <name>postgis</name>
              <type>REG_SZ</type>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(postgis).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </registrySet>
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>psqlOdbc</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(psqlOdbc).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
              <name>psqlOdbc</name>
              <type>REG_SZ</type>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(psqlOdbc).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </registrySet>
    
            <!-- pgbouncer, pgmemcache and pgagent enteries -->
    
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>pgbouncer</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(pgbouncer).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
              <name>pgbouncer</name>
              <type>REG_SZ</type>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(pgbouncer).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </registrySet>
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>pgmemcache</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(pgmemcache).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
    
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>pgagent</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(pgagent).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
              <name>pgagent</name>
              <type>REG_SZ</type>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(pgagent).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </registrySet>
    
            <!-- Npgsql registry entry-->
            <iniFileSet>
              <file>/etc/postgresplus-reg.ini</file>
              <key>npgsql</key>
              <section>PostgreSQL/${product_version}</section>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(npgsql).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </iniFileSet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}</key>
              <name>npgsql</name>
              <type>REG_SZ</type>
              <value>true</value>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(npgsql).selected}</text>
                  <value>1</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </registrySet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Installations\postgresplus-${product_version}</key>
              <name>Base Directory</name>
              <type>REG_SZ</type>
              <value>${installdir}</value>
            </registrySet>
            <registrySet>
              <key>HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Installations\postgresplus-${product_version}</key>
              <name>Version</name>
              <type>REG_SZ</type>
              <value>${product_version}</value>
            </registrySet>
    
            <!-- Write the EnterpriseDB user-name(email address) in the postgres-reg.ini/registry -->
            <iniFileSet file="/etc/postgres-reg.ini"
                        section="PostgresPlus/PG_MAJOR_VERSION"
                        key="Username"
                        value="${existingEmail}">
              <ruleList>
                <stringTest text="${existingEmail}" type="not_empty"/>
                <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
              </ruleList>
            </iniFileSet>
            <registrySet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Installations\postgresplus-${product_version}"
                         name="Username"
                         value="${existingEmail}">
              <ruleList>
                <stringTest text="${existingEmail}" type="not_empty"/>
              </ruleList>
            </registrySet>
          </actionList>
        </actionGroup>
        <setInstallerVariable>
          <name>didError</name>
          <persist>0</persist>
          <value>0</value>
        </setInstallerVariable>
    
        <!-- LIN/LIN-X64: Install dbserver, if selected -->
        <actionGroup>
          <actionList>
            <logMessage>
              <text>Installing Database Server in ${installdir} having data directory ${datadir} using Port:${serverport} and Locale:${locale}</text>
            </logMessage>
            <!-- linux -->
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/postgresql-PG_PACKAGE_VERSION-linux.bin</program>
              <programArguments>--mode unattended --disable-stackbuilder 1 --installdir "${installdir}" --datadir "${datadir}" --serviceaccount "${serviceaccount}" --superaccount "${supername}" --superpassword "${superpassword.password}" --serverport ${serverport} --locale "${locale}" --branding "Postgres Plus Standard Server ${product_version}" --servicename "${servicename}"</programArguments>
              <progressText>Installing Database Server ... </progressText>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
              </ruleList>
            </runProgram>
            <!-- linux-x64 -->
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/postgresql-PG_PACKAGE_VERSION-linux-x64.bin</program>
              <programArguments>--mode unattended --disable-stackbuilder 1 --installdir "${installdir}" --datadir "${datadir}" --serviceaccount "${serviceaccount}" --superaccount "${supername}" --superpassword "${superpassword.password}" --serverport ${serverport} --locale "${locale}" --branding "Postgres Plus Standard Server ${product_version}" --servicename "${servicename}"</programArguments>
              <progressText>Installing Database Server ... </progressText>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>linux-x64</value>
                </compareText>
              </ruleList>
            </runProgram>
            <setInstallerVariable>
              <name>didError</name>
              <value>1</value>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>0</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${IsUpgrade}</text>
              <value>0</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <!-- LIN/LIN-X64: Upgrade dbserver, if selected -->
        <actionGroup>
          <actionList>
            <logMessage>
              <text>Upgrading Database Server in ${installdir} and data directory: ${datadir}</text>
            </logMessage>
            <!-- linux -->
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/postgresql-PG_PACKAGE_VERSION-linux.bin</program>
              <programArguments>--mode unattended --disable-stackbuilder 1 --prefix "${installdir}" --datadir "${datadir}" --superpassword "${superpassword.password}" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
              <progressText>Installing Database Server ... </progressText>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
              </ruleList>
            </runProgram>
            <!-- linux-x64 -->
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}/postgresql-PG_PACKAGE_VERSION-linux-x64.bin</program>
              <programArguments>--mode unattended --disable-stackbuilder 1 --prefix "${installdir}" --datadir "${datadir}" --superpassword "${superpassword.password}" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
              <progressText>Installing Database Server ... </progressText>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>linux-x64</value>
                </compareText>
              </ruleList>
            </runProgram>
            <setInstallerVariable>
              <name>didError</name>
              <value>1</value>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>0</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <logMessage>
          <text>Installing Slony in ${installdir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(slony).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-linux.bin</program>
          <programArguments>--mode unattended --installdir ${installdir} --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing Slony ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(slony).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- linux-x64-->
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-linux-x64.bin</program>
          <programArguments>--mode unattended --installdir ${installdir} --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing Slony ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(slony).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </runProgram>
        
        <logMessage>
          <text>Installing pgJDBC in ${installdir}/pgJDBC</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgJdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-linux.bin</program>
          <programArguments>--mode unattended --installdir ${installdir}/pgJDBC --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing pgJDBC ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgJdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- linux-x64-->
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-linux-x64.bin</program>
          <programArguments>--mode unattended --installdir ${installdir}/pgJDBC --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing pgJDBC ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgJdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing psqlODBC in ${installdir}/psqlODBC</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(psqlOdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-linux.bin</program>
          <programArguments>--mode unattended --installdir ${installdir}/psqlODBC --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing psqlODBC ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(psqlOdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- linux-x64 -->
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-linux-x64.bin</program>
          <programArguments>--mode unattended --installdir ${installdir}/psqlODBC --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing psqlODBC ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(psqlOdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing Npgsql in ${installdir}/Npgsql</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(npgsql).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-linux.bin</program>
          <programArguments>--mode unattended --prefix "${installdir}/Npgsql" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing NpgSQL ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(npgsql).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-linux-x64.bin</program>
          <programArguments>--mode unattended --prefix "${installdir}/Npgsql" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing NpgSQL ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(npgsql).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing PostGIS in ${installdir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-linux.bin</program>
          <programArguments>--mode unattended --installdir ${installdir} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing PostGIS ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- linux-x64 -->
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-linux-x64.bin</program>
          <programArguments>--mode unattended --installdir ${installdir} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing PostGIS ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing pgbouncer in ${installdir}/pgbouncer</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-linux.bin</program>
          <programArguments>--mode unattended --prefix ${installdir}/pgbouncer --pghost ${defaultpghost} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --system_user "${serviceaccount}" --autostart no</programArguments>
          <progressText>Installing pgbouncer ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- linux-x64 -->
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-linux-x64.bin</program>
          <programArguments>--mode unattended --prefix ${installdir}/pgbouncer --pghost ${defaultpghost} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --system_user "${serviceaccount}" --autostart no</programArguments>
          <progressText>Installing pgbouncer ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing pgmemcache in ${installdir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgmemcache).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgmemcache-pgPG_CURRENT_VERSION-PG_VERSION_PGMEMCACHE-PG_BUILDNUM_PGMEMCACHE-linux.bin</program>
          <programArguments>--mode unattended --installdir ${installdir}</programArguments>
          <progressText>Installing pgmemcache ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgmemcache).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgmemcache-pgPG_CURRENT_VERSION-PG_VERSION_PGMEMCACHE-PG_BUILDNUM_PGMEMCACHE-linux-x64.bin</program>
          <programArguments>--mode unattended --installdir ${installdir}</programArguments>
          <progressText>Installing pgmemcache ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgmemcache).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- pgAgent -->
        <logMessage>
          <text>Installing pgAgent in ${installdir}/pgAgent</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-linux.bin</program>
          <programArguments>--mode unattended --prefix ${installdir}/pgAgent --pghost ${defaultpghost} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --systemuser "${serviceaccount}" --schema ${schema} --autostart no</programArguments>
          <progressText>Installing pgAgent ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-linux-x64.bin</program>
          <programArguments>--mode unattended --installdir ${installdir}/pgAgent --pghost ${defaultpghost} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --systemuser "${serviceaccount}" --schema ${schema} --autostart no</programArguments>
          <progressText>Installing pgAgent ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>linux-x64</value>
            </compareText>
          </ruleList>
        </runProgram>
        
        <!-- Always install StackBuilderPlus as the last component -->
        <actionGroup>
          <actionList>
            <logMessage text="Installing StackBuilderPlus in ${installdir}/StackBuilderPlus"/>
            <!-- Linux -->
            <runProgram abortOnError="0"
                        progressText="Installing StackBuilderPlus ... "
                        showMessageOnError="1"
                        program="${ppss_temp_directory}/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-linux.bin"
                        programArguments="--mode unattended --installdir ${installdir}/StackBuilderPlus --branding &quot;Postgres Plus Standard Server ${product_version}&quot;  ${monitor_server} --install-monitoring ${installMonitoring}">
              <ruleList>
                <compareText logic="equals" text="${platform_name}" value="linux"/>
              </ruleList>
            </runProgram>
            <!-- Linux-x64 -->
            <runProgram abortOnError="0"
                        progressText="Installing StackBuilderPlus ... "
                        showMessageOnError="1"
                        program="${ppss_temp_directory}/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-linux-x64.bin"
                        programArguments="--mode unattended --installdir ${installdir}/StackBuilderPlus --branding &quot;Postgres Plus Standard Server ${product_version}&quot;  ${monitor_server} --install-monitoring ${installMonitoring}">
              <ruleList>
                <compareText logic="equals" text="${platform_name}" value="linux-x64"/>
              </ruleList>
            </runProgram>
          </actionList>
          <ruleList>
            <isTrue value="${component(stackbuilderplus).selected}"/>
            <compareText logic="contains" text="${platform_name}" value="linux"/>
          </ruleList>
        </actionGroup>
    
    
        <!-- Run Windows Programs -->
        <!-- dbserver installation/upgradation -->
        <actionGroup>
          <actionList>
            <!-- Run in install mode -->
            <actionGroup>
              <actionList>
                <logMessage>
                  <text>Installing Database Server in ${installdir} having data directory ${datadir} using Port:${serverport} and Locale:${locale}</text>
                </logMessage>
                <runProgram>
                  <abortOnError>0</abortOnError>
                  <program>${ppss_temp_directory}\postgresql-PG_PACKAGE_VERSION-windows.exe</program>
                  <programArguments>--mode unattended --disable-stackbuilder 1 --prefix "${installdir}" --datadir "${datadir}" --serviceaccount "${serviceaccount}" --servicepassword "${servicepassword.password}" --superaccount "${supername}" --superpassword "${superpassword.password}" --serverport "${serverport}" --locale "${locale}" --branding "Postgres Plus Standard Server ${product_version}" --install_runtimes 0 --servicename "${servicename}"</programArguments>
                  <progressText>Installing Database Server ... </progressText>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>
              </actionList>
              <ruleList>
                <isFalse>
                  <value>${IsUpgrade}</value>
                </isFalse>
              </ruleList>
            </actionGroup>
            <!-- Run in upgrade mode -->
            <actionGroup>
              <actionList>
                <logMessage>
                  <text>Upgrading Database Server in ${installdir} and data directory:${datadir}</text>
                </logMessage>
                <runProgram>
                  <abortOnError>0</abortOnError>
                  <program>${ppss_temp_directory}\postgresql-PG_PACKAGE_VERSION-windows.exe</program>
                  <programArguments>--mode unattended --prefix "${installdir}" --datadir "${datadir}" --servicepassword "${servicepassword.password}" --superpassword "${superpassword.password}" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
                  <progressText>Installing Database Server ... </progressText>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>
              </actionList>
              <ruleList>
                <isTrue>
                  <value>${IsUpgrade}</value>
                </isTrue>
              </ruleList>
            </actionGroup>
            <setInstallerVariable>
              <name>didError</name>
              <value>1</value>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>0</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
        <logMessage>
          <text>Installing Slony in ${installdir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(slony).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}\slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-windows.exe</program>
          <programArguments>--mode unattended --prefix "${installdir}" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing Slony ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(slony).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing pgJDBC in ${installdir}\pgJDBC</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgJdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}\pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-windows.exe</program>
          <programArguments>--mode unattended --prefix "${installdir}\pgJDBC" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing pgJDBC ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgJdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing psqlODBC in ${installdir}\psqlODBC</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(psqlOdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}\psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-windows.exe</program>
          <programArguments>--mode unattended --prefix "${installdir}\psqlODBC" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing psqlODBC ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(psqlOdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!--NpgSQL -->
    
        <logMessage>
          <text>Installing Npgsql in ${installdir}\Npgsql</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(npgsql).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}\npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-windows.exe</program>
          <programArguments>--mode unattended --prefix "${installdir}\Npgsql" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing NpgSQL ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(npgsql).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing PostGIS in ${installdir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}\postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-windows.exe</program>
          <programArguments>--mode unattended --prefix "${installdir}" --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing PostGIS ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing pgbouncer in ${installdir}\pgbouncer</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}\pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-windows.exe</program>
          <programArguments>--mode unattended --prefix "${installdir}\pgbouncer" --pghost ${defaultpghost} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --system_user "${serviceaccount}" --autostart no</programArguments>
          <progressText>Installing pgbouncer ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- pgAgent -->
    
        <logMessage>
          <text>Installing pgAgent in ${installdir}\pgAgent</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}\pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-windows.exe</program>
          <programArguments>--mode unattended --prefix "${installdir}\pgAgent" --pghost ${defaultpghost} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --systemuser "${serviceaccount}" --systempassword "${servicepassword.password}" --schema ${schema} --autostart no</programArguments>
          <progressText>Installing pgAgent ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </runProgram>
      
        <!-- Always install StackBuilderPlus as the last component -->
        <actionGroup>
          <actionList>
            <logMessage text="Installing StackBuilderPlus in ${installdir}\StackBuilderPlus"/>
            <runProgram abortOnError="0"
                        progressText="Installing StackBuilderPlus ... "
                        showMessageOnError="0"
                        program="${ppss_temp_directory}\stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-windows.exe"
                        programArguments="--mode unattended --prefix &quot;${installdir}\StackBuilderPlus&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; ${monitor_server} --install-monitoring ${installMonitoring}"/>
          </actionList>
          <ruleList>
            <isTrue value="${component(stackbuilderplus).selected}"/>
            <compareText logic="equals" text="${platform_name}" value="windows"/>
          </ruleList>
        </actionGroup>
    
    
        <!-- Run mac programs -->
        <actionGroup>
          <actionList>
            <!-- Install dbserver, if selected -->
            <actionGroup>
              <actionList>
                <logMessage>
                  <text>Installing Database Server in ${installdir} having data directory ${datadir} using Port:${serverport} and Locale:${locale}</text>
                </logMessage>
                <runProgram>
                  <abortOnError>0</abortOnError>
                  <program>${ppss_temp_directory}/postgresql-PG_PACKAGE_VERSION-osx.app/Contents/MacOS/installbuilder.sh</program>
                  <programArguments>--mode unattended --disable-stackbuilder 1 --installdir ${installdir} --datadir ${datadir} --serviceaccount "${serviceaccount}" --superaccount "${supername}" --superpassword "${superpassword.password}" --serverport ${serverport} --locale ${locale} --branding "Postgres Plus Standard Server ${product_version}" --servicename "${servicename}"</programArguments>
                  <progressText>Installing Database Server ... </progressText>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>
              </actionList>
              <ruleList>
                <isFalse>
                  <value>${IsUpgrade}</value>
                </isFalse>
              </ruleList>
            </actionGroup>
            <actionGroup>
              <actionList>
                <logMessage>
                  <text>Upgrading Database Server in ${installdir} and data directory:${datadir}</text>
                </logMessage>
                <runProgram>
                  <abortOnError>0</abortOnError>
                  <program>${ppss_temp_directory}/postgresql-PG_PACKAGE_VERSION-osx.app/Contents/MacOS/installbuilder.sh</program>
                  <programArguments>--mode unattended --disable-stackbuilder 1 --prefix "${installdir}" --datadir "${datadir}" --superpassword "${superpassword.password}" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
                  <progressText>Installing Database Server ... </progressText>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>
              </actionList>
              <ruleList>
                <isTrue>
                  <value>${IsUpgrade}</value>
                </isTrue>
              </ruleList>
            </actionGroup>
            <setInstallerVariable>
              <name>didError</name>
              <value>1</value>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>0</text>
                  <value>${program_exit_code}</value>
                </compareText>
              </ruleList>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </actionGroup>
    
    
        <logMessage>
          <text>Installing Slony in ${installdir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(slony).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
    
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-osx.app/Contents/MacOS/installbuilder.sh</program>
          <programArguments>--mode unattended --installdir ${installdir} --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing Slony ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(slony).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing pgJDBC in ${installdir}/pgJDBC</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgJdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-osx.app/Contents/MacOS/installbuilder.sh</program>
          <programArguments>--mode unattended --installdir ${installdir}/pgJDBC --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing pgJDBC ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgJdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing psqlODBC in ${installdir}/psqlODBC</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(psqlOdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-osx.app/Contents/MacOS/installbuilder.sh</program>
          <programArguments>--mode unattended --installdir ${installdir}/psqlODBC --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing psqlODBC ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(psqlOdbc).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing Npgsql in ${installdir}/Npgsql</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(npgsql).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-osx.app/Contents/MacOS/installbuilder.sh</program>
          <programArguments>--mode unattended --prefix "${installdir}/Npgsql" --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing NpgSQL ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(npgsql).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
        <logMessage>
          <text>Installing PostGIS in ${installdir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-osx.app/Contents/MacOS/installbuilder.sh</program>
          <programArguments>--mode unattended --installdir ${installdir} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --branding "Postgres Plus Standard Server ${product_version}"</programArguments>
          <progressText>Installing PostGIS ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing pgbouncer in ${installdir}/pgbouncer</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-osx.app/Contents/MacOS/installbuilder.sh</program>
          <programArguments>--mode unattended --installdir ${installdir}/pgbouncer --pghost ${defaultpghost} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --system_user "${serviceaccount}" --autostart no</programArguments>
          <progressText>Installing pgbouncer ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <logMessage>
          <text>Installing pgmemcache in ${installdir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgmemcache).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgmemcache-pgPG_CURRENT_VERSION-PG_VERSION_PGMEMCACHE-PG_BUILDNUM_PGMEMCACHE-osx.app/Contents/MacOS/installbuilder.sh</program>
          <programArguments>--mode unattended --installdir ${installdir}</programArguments>
          <progressText>Installing pgmemcache ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgmemcache).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- pgAgent -->
    
        <logMessage>
          <text>Installing pgAgent in ${installdir}/pgAgent</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>${ppss_temp_directory}/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-osx.app/Contents/MacOS/installbuilder.sh</program>
          <programArguments>--mode unattended --installdir ${installdir}/pgAgent --pghost ${defaultpghost} --pguser "${supername}" --pgpassword "${superpassword.password}" --pgport ${serverport} --systemuser "${serviceaccount}" --schema ${schema} --autostart no</programArguments>
          <progressText>Installing pgAgent ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!-- Message for manual installation of pgagent schema -->
    
        <!-- Inform user about configuring pgagent schema manually -->
        <showInfo text="${msg(info.pgagent.schema.manual.upgrade)}">
          <ruleList>
            <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
            <compareText logic="does_not_equal" text="${pgagent_schema_exist}" value=""/>
            <compareText logic="equals" text="${upgrade_schema}" value="no"/>
            <compareText logic="does_not_equal" text="${pgagent_installer_schema_version}" value="${pgagent_current_schema_version}"/>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </showInfo>
        <showInfo text="${msg(info.pgagent.schema.manual.upgrade.windows)}">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="windows"/>
            <compareText logic="does_not_equal" text="${pgagent_schema_exist}" value=""/>
            <compareText logic="equals" text="${upgrade_schema}" value="no"/>
            <compareText logic="does_not_equal" text="${pgagent_installer_schema_version}" value="${pgagent_current_schema_version}"/>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </showInfo>
    
        <!-- Always install StackBuilderPlus as the last component -->
        <actionGroup>
          <actionList>
            <logMessage text="Installing StackBuilderPlus in ${installdir}\StackBuilderPlus"/>
            <runProgram abortOnError="0"
                        progressText="Installing StackBuilderPlus ... "
                        showMessageOnError="0"
                        program="${ppss_temp_directory}/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-osx.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended --prefix &quot;${installdir}/StackBuilderPlus&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; ${monitor_server} --install-monitoring ${installMonitoring}"/>
          </actionList>
          <ruleList>
            <isTrue value="${component(stackbuilderplus).selected}"/>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
       </actionGroup>
    
    
        <!--Modify Postgresql.conf -->
    
        <logMessage>
          <text>Modifying postgresql.conf</text>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>/etc/init.d/postgresql-${product_version}</program>
          <programArguments>stop</programArguments>
          <progressText>${msg(progress.text.stopping.server)}</progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!--stop Mac service -->
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>launchctl</program>
          <programArguments>stop com.edb.launchd.postgresql-${product_version}</programArguments>
          <progressText>${msg(progress.text.stopping.server)}</progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </runProgram>
        <setInstallerVariableFromScriptOutput>
          <customErrorMessage>${msg(pgplus.modify.error)}</customErrorMessage>
          <exec>${ppss_temp_directory}/modifyPostgresql.o</exec>
          <execArgs>"${datadir}/postgresql.conf" "${autovacuum_var}" "${autovacuum_naptime_var}" "${autovacuum_vacuum_threshold_var}" "${autovacuum_analyze_threshold_var}" "${autovacuum_vacuum_scale_factor_var}" "${autovacuum_analyze_scale_factor_var}" "${checkpoint_segments_var}" "${effective_cache_size_var}" "${maintenance_work_mem_var}" "${max_fsm_pages_var}" "${max_fsm_relations_var}" "${random_page_cost_var}" "${shared_buffers_var}" "${wal_buffers_var}" "${work_mem_var}" "${max_connections_var}" "${stats_row_level_var}"</execArgs>
          <name>postgresql_conf_updated_result</name>
          <workingDirectory>${ppss_temp_directory}</workingDirectory>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </setInstallerVariableFromScriptOutput>
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>/etc/init.d/postgresql-${product_version}</program>
          <programArguments>start</programArguments>
          <progressText>${msg(progress.text.starting.server)}</progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!--start Mac service -->
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>launchctl</program>
          <programArguments>start com.edb.launchd.postgresql-${product_version}</programArguments>
          <progressText>${msg(progress.text.starting.server)}</progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <!--Modify Postgresql.conf Windows  WINDOWS: Stop the server -->
    
        <logMessage>
          <text>Modifying postgresql.conf</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </logMessage>
    
        <stopWindowsService>
          <abortOnError>0</abortOnError>
          <displayName></displayName>
          <serviceName>postgresql-${product_version}</serviceName>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </stopWindowsService>
        <setInstallerVariableFromScriptOutput>
          <customErrorMessage>${msg(pgplus.modify.error)}</customErrorMessage>
          <exec>${ppss_temp_directory}\modifyPostgresql.exe</exec>
          <execArgs>"${datadir}/postgresql.conf" "${autovacuum_var}" "${autovacuum_naptime_var}" "${autovacuum_vacuum_threshold_var}" "${autovacuum_analyze_threshold_var}" "${autovacuum_vacuum_scale_factor_var}" "${autovacuum_analyze_scale_factor_var}" "${checkpoint_segments_var}" "${effective_cache_size_var}" "${maintenance_work_mem_var}" "${max_fsm_pages_var}" "${max_fsm_relations_var}" "${random_page_cost_var}" "${shared_buffers_var}" "${wal_buffers_var}" "${work_mem_var}" "${max_connections_var}" "${stats_row_level_var}"</execArgs>
          <name>postgresql_conf_updated_result</name>
          <workingDirectory>${ppss_temp_directory}</workingDirectory>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </setInstallerVariableFromScriptOutput>
        <startWindowsService>
          <abortOnError>0</abortOnError>
          <delay>15000</delay>
          <displayName></displayName>
          <serviceName>postgresql-${product_version}</serviceName>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${dbInstallTune}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${IsUpgrade}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </startWindowsService>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>/etc/init.d/pgagent</program>
          <programArguments>start &amp;</programArguments>
          <progressText>Starting pgAgent ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>launchctl</program>
          <programArguments>load /Library/LaunchDaemons/com.edb.launchd.pgagent.plist</programArguments>
          <progressText>Starting pgAgent ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <startWindowsService>
          <abortOnError>0</abortOnError>
          <delay>20000</delay>
          <displayName></displayName>
          <serviceName>pgAgent</serviceName>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgagent).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </startWindowsService>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>/etc/init.d/pgbouncer</program>
          <programArguments>start</programArguments>
          <progressText>Starting pgBouncer ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>contains</logic>
              <text>${platform_name}</text>
              <value>linux</value>
            </compareText>
          </ruleList>
        </runProgram>
    
        <runProgram>
          <abortOnError>0</abortOnError>
          <program>launchctl</program>
          <programArguments>load /Library/LaunchDaemons/com.edb.launchd.pgbouncer.plist</programArguments>
          <progressText>Starting pgBouncer ... </progressText>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>osx</value>
            </compareText>
          </ruleList>
        </runProgram>
    
    
        <startWindowsService>
          <abortOnError>0</abortOnError>
          <delay>20000</delay>
          <displayName></displayName>
          <serviceName>pgBouncer</serviceName>
          <showMessageOnError>0</showMessageOnError>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${component(pgbouncer).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </startWindowsService>
    
    
        <deleteFile>
          <path>${ppss_temp_directory}/dynaTune.properties</path>
        </deleteFile>
        <deleteFile>
          <path>${ppss_temp_directory}</path>
        </deleteFile>
      </actionList>
      <ruleList>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </actionGroup>

    <!-- Run each installer with extract-only mode -->
    <actionGroup>
      <actionList>
        <!-- DevServer -->
        <setInstallerVariable name="devserver_installer" value="${ppss_temp_directory}/postgresql-PG_PACKAGE_VERSION-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="devserver_installer" value="${ppss_temp_directory}/postgresql-PG_PACKAGE_VERSION-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting Server binaries... "
                    showMessageOnError="0"
                    program="${devserver_installer}"
                    programArguments="--mode unattended --datadir &quot;&quot; --prefix &quot;${installdir}&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${devserver_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{devserver_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${devserver_installer}"/>
          </ruleList>
        </logMessage>

        <!-- StackBuilder Plus -->
        <setInstallerVariable name="sbp_installer" value="${ppss_temp_directory}/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="sbp_installer" value="${ppss_temp_directory}/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting StackBuilderPlus binaries... "
                    showMessageOnError="0"
                    program="${sbp_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}/StackBuilderPlus&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${sbp_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{sbp_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${sbp_installer}"/>
          </ruleList>
        </logMessage>

        <!-- Slony -->
        <setInstallerVariable name="slony_installer" value="${ppss_temp_directory}/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="slony_installer" value="${ppss_temp_directory}/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting Slony binaries... "
                    showMessageOnError="0"
                    program="${slony_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${slony_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{slony_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${slony_installer}"/>
          </ruleList>
        </logMessage>

        <!-- pgJDBC -->
        <setInstallerVariable name="pgjdbc_installer" value="${ppss_temp_directory}/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="pgjdbc_installer" value="${ppss_temp_directory}/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting pgJDBC libraries... "
                    showMessageOnError="0"
                    program="${pgjdbc_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}/pgJDBC&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${pgjdbc_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{pgjdbc_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${pgjdbc_installer}"/>
          </ruleList>
        </logMessage>

        <!-- PostGIS -->
        <setInstallerVariable name="postgis_installer" value="${ppss_temp_directory}/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="postgis_installer" value="${ppss_temp_directory}/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting PostGIS binaries... "
                    showMessageOnError="0"
                    program="${postgis_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${postgis_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{postgis_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${postgis_installer}"/>
          </ruleList>
        </logMessage>

        <!-- psqlODBC -->
        <setInstallerVariable name="psqlodbc_installer" value="${ppss_temp_directory}/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="psqlodbc_installer" value="${ppss_temp_directory}/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting psqlODBC binaries... "
                    showMessageOnError="0"
                    program="${psqlodbc_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}/psqlODBC&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${psqlodbc_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{psqlodbc_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${psqlodbc_installer}"/>
          </ruleList>
        </logMessage>

        <!-- Npgsql -->
        <setInstallerVariable name="npgsql_installer" value="${ppss_temp_directory}/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="npgsql_installer" value="${ppss_temp_directory}/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting Npgsql binaries... "
                    showMessageOnError="0"
                    program="${npgsql_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}/Npgsql&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${npgsql_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{npgsql_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${npgsql_installer}"/>
          </ruleList>
        </logMessage>

        <!-- pgbouncer -->
        <setInstallerVariable name="pgbouncer_installer" value="${ppss_temp_directory}/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="pgbouncer_installer" value="${ppss_temp_directory}/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting pgbouncer binaries... "
                    showMessageOnError="0"
                    program="${pgbouncer_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}/pgbouncer&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${pgbouncer_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{pgbouncer_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${pgbouncer_installer}"/>
          </ruleList>
        </logMessage>

        <!-- pgmemcache -->
        <setInstallerVariable name="pgmemcache_installer" value="${ppss_temp_directory}/pgmemcache-pgPG_CURRENT_VERSION-PG_VERSION_PGMEMCACHE-PG_BUILDNUM_PGMEMCACHE-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="pgmemcache_installer" value="${ppss_temp_directory}/pgmemcache-pgPG_CURRENT_VERSION-PG_VERSION_PGMEMCACHE-PG_BUILDNUM_PGMEMCACHE-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting pgmemcache binaries... "
                    showMessageOnError="0"
                    program="${pgmemcache_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}&quot; --branding &quot;Postgres Plus Standard Server ${product_version}&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${pgmemcache_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:$'{pgmemcache_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${pgmemcache_installer}"/>
          </ruleList>
        </logMessage>

        <!-- pgAgent -->
        <setInstallerVariable name="pgagent_installer" value="${ppss_temp_directory}/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-${platform_name}.${platform_exec_suffix}"/>
        <setInstallerVariable name="pgagent_installer" value="${ppss_temp_directory}/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-${platform_name}.${platform_exec_suffix}/Contents/MacOS/installbuilder.sh">
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </setInstallerVariable>
        <runProgram abortOnError="0"
                    progressText="Extracting pgagent binaries... "
                    showMessageOnError="0"
                    program="${pgagent_installer}"
                    programArguments="--mode unattended --prefix &quot;${installdir}/pgAgent&quot; --extract-only 1">
          <ruleList>
            <fileExists path="${pgagent_installer}"/>
          </ruleList>
        </runProgram>

        <logMessage text="Installer:'${pgagent_installer}' could not be found.">
          <ruleList>
            <fileTest condition="not_exists" path="${pgagent_installer}"/>
          </ruleList>
        </logMessage>

      </actionList>
      <ruleList>
        <isTrue value="${extract_mode}"/>
      </ruleList>
    </actionGroup>

    <!-- Make sure temporary directory gets deleted after the installation -->
    <deleteFile path="${ppss_temp_directory}"/>

  </postInstallationActionList>

  <!-- Final page actions -->
  <finalPageActionList>

    <runProgram>
      <!-- MAC: Run stackbuilder plus-->
      <program>open</program>
      <programArguments>"/Applications/Postgres Plus Standard Server ${product_version}/StackBuilder Plus.app"</programArguments>
      <progressText>${msg(progress.text.run.stackbuilderplus)}</progressText>
      <abortOnError>0</abortOnError>
      <showMessageOnError>0</showMessageOnError>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${platform_name}</text>
          <value>osx</value>
        </compareText>
        <compareText>
          <logic>does_not_equal</logic>
          <text>${didError}</text>
          <value>1</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </runProgram>

    <runProgram>
      <!-- Linux: Run stackbuilder plus-->
      <program>${installdir}/StackBuilderPlus/scripts/launchStackBuilderPlus.sh</program>
      <progressText>${msg(progress.text.run.stackbuilderplus)}</progressText>
      <abortOnError>0</abortOnError>
      <showMessageOnError>0</showMessageOnError>
      <ruleList>
        <compareText>
          <logic>contains</logic>
          <text>${platform_name}</text>
          <value>linux</value>
        </compareText>
        <compareText>
          <logic>does_not_equal</logic>
          <text>${didError}</text>
          <value>1</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </runProgram>

    <runProgram>
      <!-- Windows: Run stackbuilder -->
      <program>${installdir}/StackBuilderPlus/bin/stackbuilderplus.exe</program>
      <progressText>${msg(progress.text.run.stackbuilderplus)}</progressText>
      <abortOnError>0</abortOnError>
      <showMessageOnError>0</showMessageOnError>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${platform_name}</text>
          <value>windows</value>
        </compareText>
        <compareText>
          <logic>does_not_equal</logic>
          <text>${didError}</text>
          <value>1</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </runProgram>

  </finalPageActionList>

  <!-- Preuninstallation actions -->
  <preUninstallationActionList>
    <actionGroup>
      <actionList>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="databaseServer"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_dbserver"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="slony"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_slony"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="pgJdbc"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_pgjdbc"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="sbp"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_sbp"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="postgis"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_postgis"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="psqlOdbc"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_psqlOdbc"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="pgbouncer"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_pgbouncer"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="pgmemcache"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_pgmemcache"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="pgagent"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_pgagent"/>
        <iniFileGet file="/etc/postgresplus-reg.ini"
                    key="npgsql"
                    section="PostgreSQL/${product_version}"
                    variable="uninstall_npgsql"/>

        <actionGroup>
          <actionList>
            <!-- uninstall Slony1 -->
            <runProgram abortOnError="0"
                        program="${installdir}/Slony/uninstall-slony"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_slony}"/>
                <!-- It is possible that user may have uninstalled slony1 manually -->
                <fileTest path="${installdir}/Slony/uninstall-slony" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall jdbc -->
            <runProgram abortOnError="0"
                        program="${installdir}/pgJDBC/uninstall-pgjdbc"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_pgjdbc}"/>
                <!-- It is possible that user may have uninstalled pgJDBC manually -->
                <fileTest path="${installdir}/pgJDBC/uninstall-pgjdbc" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall StackBuilderPlus -->
            <runProgram abortOnError="0"
                        program="${installdir}/StackBuilderPlus/uninstall-stackbuilderplus"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_sbp}"/>
                <!-- It is possible that user may have uninstalled StackBuilderPlus manually -->
                <fileTest path="${installdir}/StackBuilderPlus/uninstall-stackbuilderplus" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall PostGIS -->
            <runProgram abortOnError="0"
                        program="${installdir}/PostGIS/uninstall-postgis"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_postgis}"/>
                <!-- It is possible that user may have uninstalled PostGIS manually -->
                <fileTest path="${installdir}/PostGIS/uninstall-postgis" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall psqlODBC -->
            <runProgram abortOnError="0"
                        program="${installdir}/psqlODBC/uninstall-psqlodbc"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_psqlOdbc}"/>
                <!-- It is possible that user may have uninstalled psqlODBC manually -->
                <fileTest path="${installdir}/psqlODBC/uninstall-psqlodbc" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall NpgSql -->
            <runProgram abortOnError="0"
                        program="${installdir}/Npgsql/uninstall-npgsql"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_npgsql}"/>
                <!-- It is possible that user may have uninstalled NpgSql manually -->
                <fileTest path="${installdir}/Npgsql/uninstall-npgsql" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall pgmemcache -->
            <runProgram abortOnError="0"
                        program="${installdir}/uninstall-pgmemcache"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_pgmemcache}"/>
                <!-- It is possible that user may have uninstalled pgmemcache manually -->
                <fileTest path="${installdir}/uninstall-pgmemcache" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall pgBouncer -->
            <runProgram abortOnError="0"
                        program="${installdir}/pgbouncer/uninstall-pgbouncer"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_pgbouncer}"/>
                <!-- It is possible that user may have uninstalled NpgSql manually -->
                <fileTest path="${installdir}/pgbouncer/uninstall-pgbouncer" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall pgAgent -->
            <runProgram abortOnError="0"
                        program="${installdir}/pgAgent/uninstall-pgagent"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_pgagent}"/>
                <!-- It is possible that user may have uninstalled pgAgent manually -->
                <fileTest path="${installdir}/pgAgent/uninstall-pgagent" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall dbserver/PostgreSQL -->
            <runProgram abortOnError="0"
                        program="${installdir}/uninstall-postgresql"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_dbserver}"/>
                <!-- It is possible that user may have uninstalled PostgreSQL server manually -->
                <fileTest path="${installdir}/uninstall-postgresql" condition="exists"/>
              </ruleList>
            </runProgram>
          </actionList>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="linux"/>
            <compareText logic="equals" text="${platform_name}" value="linux-x64"/>
          </ruleList>
        </actionGroup>

        <actionGroup>
          <actionList>
            <!-- uninstall Slony1 -->
            <runProgram abortOnError="0"
                        program="${installdir}/Slony/uninstall-slony.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_slony}"/>
                <!-- It is possible that user may have uninstalled slony1 manually -->
                <fileTest path="${installdir}/Slony/uninstall-slony.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall jdbc -->
            <runProgram abortOnError="0"
                        program="${installdir}/pgJDBC/uninstall-pgjdbc.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_pgjdbc}"/>
                <!-- It is possible that user may have uninstalled pgJDBC manually -->
                <fileTest path="${installdir}/pgJDBC/uninstall-pgjdbc.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall StackBuilderPlus -->
            <runProgram abortOnError="0"
                        program="${installdir}/StackBuilderPlus/uninstall-stackbuilderplus.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_sbp}"/>
                <!-- It is possible that user may have uninstalled StackBuilderPlus manually -->
                <fileTest path="${installdir}/StackBuilderPlus/uninstall-stackbuilderplus.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall PostGIS -->
            <runProgram abortOnError="0"
                        program="${installdir}/PostGIS/uninstall-postgis.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_postgis}"/>
                <!-- It is possible that user may have uninstalled PostGIS manually -->
                <fileTest path="${installdir}/PostGIS/uninstall-postgis.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall psqlODBC -->
            <runProgram abortOnError="0"
                        program="${installdir}/psqlODBC/uninstall-psqlodbc.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_psqlOdbc}"/>
                <!-- It is possible that user may have uninstalled psqlODBC manually -->
                <fileTest path="${installdir}/psqlODBC/uninstall-psqlodbc.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall NpgSql -->
            <runProgram abortOnError="0"
                        program="${installdir}/Npgsql/uninstall-npgsql.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_npgsql}"/>
                <!-- It is possible that user may have uninstalled NpgSql manually -->
                <fileTest path="${installdir}/Npgsql/uninstall-npgsql.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall pgmemcache -->
            <runProgram abortOnError="0"
                        program="${installdir}/uninstall-pgmemcache.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_pgmemcache}"/>
                <!-- It is possible that user may have uninstalled pgmemcache manually -->
                <fileTest path="${installdir}/uninstall-pgmemcache.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall pgBouncer -->
            <runProgram abortOnError="0"
                        program="${installdir}/pgbouncer/uninstall-pgbouncer.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_pgbouncer}"/>
                <!-- It is possible that user may have uninstalled NpgSql manually -->
                <fileTest path="${installdir}/pgbouncer/uninstall-pgbouncer.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall pgAgent -->
            <runProgram abortOnError="0"
                        program="${installdir}/pgAgent/uninstall-pgagent.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_pgagent}"/>
                <!-- It is possible that user may have uninstalled pgAgent manually -->
                <fileTest path="${installdir}/pgAgent/uninstall-pgagent.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
    
            <!-- uninstall dbserver/PostgreSQL -->
            <runProgram abortOnError="0"
                        program="${installdir}/uninstall-postgresql.app/Contents/MacOS/installbuilder.sh"
                        programArguments="--mode unattended">
              <ruleList>
                <isTrue value="${uninstall_dbserver}"/>
                <!-- It is possible that user may have uninstalled PostgreSQL server manually -->
                <fileTest path="${installdir}/uninstall-postgresql.app/Contents/MacOS/installbuilder.sh" condition="exists"/>
              </ruleList>
            </runProgram>
          </actionList>
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="osx"/>
          </ruleList>
        </actionGroup>
      </actionList>
      <ruleList>
        <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
      </ruleList>
    </actionGroup>

    <!-- WIN: Get existing directories -->
    <actionGroup>
      <actionList>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="databaseServer"
                     variable="uninstall_dbserver"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="slony"
                     variable="uninstall_slony"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="pgJdbc"
                     variable="uninstall_pgjdbc"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="sbp"
                     variable="uninstall_sbp"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="postgis"
                     variable="uninstall_postgis"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="psqlOdbc"
                     variable="uninstall_psqlOdbc"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="npgsql"
                     variable="uninstall_npgsql"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="pgmemcache"
                     variable="uninstall_pgmemcache"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="pgbouncer"
                     variable="uninstall_pgbouncer"/>
        <registryGet key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"
                     name="pgagent"
                     variable="uninstall_pgagent"/>

        <!-- uninstall Slony1 -->
        <runProgram abortOnError="0"
                    program="${installdir}\Slony\uninstall-slony.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_slony}"/>
            <!-- It is possible that user may have uninstalled only slony1 manually -->
            <fileTest path="${installdir}\Slony\uninstall-slony.exe" condition="exists"/>
          </ruleList>
        </runProgram>

        <!-- uninstall jdbc -->
        <runProgram abortOnError="0"
                    program="${installdir}\pgJDBC\uninstall-pgjdbc.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_pgjdbc}"/>
            <!-- It is possible that user may have uninstalled only pgJDBC manually -->
            <fileTest path="${installdir}\pgJDBC\uninstall-pgjdbc.exe" condition="exists"/>
          </ruleList>
        </runProgram>

        <!-- uninstall StackBuilderPlus -->
        <runProgram abortOnError="0"
                    program="${installdir}\StackBuilderPlus\uninstall-stackbuilderplus.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_sbp}"/>
            <!-- It is possible that user may have uninstalled only StackBuilderPlus manually -->
            <fileTest path="${installdir}\StackBuilderPlus\uninstall-stackbuilderplus.exe" condition="exists"/>
          </ruleList>
        </runProgram>
        <!-- uninstall PostGIS -->
        <runProgram abortOnError="0"
                    program="${installdir}\PostGIS\uninstall-postgis.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_postgis}"/>
            <!-- It is possible that user may have uninstalled only PostGIS manually -->
            <fileTest path="${installdir}\PostGIS\uninstall-postgis.exe" condition="exists"/>
          </ruleList>
        </runProgram>

        <!-- uninstall psqlODBC -->
        <runProgram abortOnError="0"
                    program="${installdir}\psqlODBC\uninstall-psqlodbc.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_psqlOdbc}"/>
            <!-- It is possible that user may have uninstalled only psqlODBC manually -->
            <fileTest path="${installdir}\psqlODBC\uninstall-psqlodbc.exe" condition="exists"/>
          </ruleList>
        </runProgram>

        <!-- uninstall NpgSql -->
        <runProgram abortOnError="0"
                    program="${installdir}\Npgsql\uninstall-npgsql.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_npgsql}"/>
            <!-- It is possible that user may have uninstalled only NpgSql manually -->
            <fileTest path="${installdir}\Npgsql\uninstall-npgsql.exe" condition="exists"/>
          </ruleList>
        </runProgram>

        <!-- uninstall pgmemcache -->
        <runProgram abortOnError="0"
                    program="${installdir}\uninstall-pgmemcache.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_pgmemcache}"/>
            <!-- It is possible that user may have uninstalled pgmemcache manually -->
            <fileTest path="${installdir}\uninstall-pgmemcache.exe" condition="exists"/>
          </ruleList>
        </runProgram>

        <!-- uninstall pgBouncer -->
        <runProgram abortOnError="0"
                    program="${installdir}\pgbouncer\uninstall-pgbouncer.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_pgbouncer}"/>
            <!-- It is possible that user may have uninstalled only NpgSql manually -->
            <fileTest path="${installdir}\pgbouncer\uninstall-pgbouncer.exe" condition="exists"/>
          </ruleList>
        </runProgram>

        <!-- uninstall pgAgent -->
        <runProgram abortOnError="0"
                    program="${installdir}\pgAgent\uninstall-pgagent.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_pgagent}"/>
            <!-- It is possible that user may have uninstalled only pgAgent manually -->
            <fileTest path="${installdir}\pgAgent\uninstall-pgagent.exe" condition="exists"/>
          </ruleList>
        </runProgram>

        <!-- uninstall dbserver/PostgreSQL -->
        <runProgram abortOnError="0"
                    program="${installdir}\uninstall-postgresql.exe"
                    programArguments="--mode unattended">
          <ruleList>
            <isTrue value="${uninstall_dbserver}"/>
            <!-- It is possible that user may have uninstalled only PostgreSQL server manually -->
            <fileTest path="${installdir}\uninstall-postgresql.exe" condition="exists"/>
          </ruleList>
        </runProgram>

      </actionList>
      <ruleList>
        <compareText logic="equals" text="${platform_name}" value="windows"/>
      </ruleList>
    </actionGroup>

  </preUninstallationActionList>

  <!-- Postuninstallation actions -->
  <postUninstallationActionList>
    <actionGroup>
      <actionList>
          <deleteFile path="/etc/postgresplus-reg.ini"/>
          <!-- Delete the Username from the PostgreSqlIni -->
          <iniFileSet file="${PostgreSqlIni}"
                      section="PostgresPlus/PG_MAJOR_VERSION"
                      key="Username"
                      value="">
          <ruleList>
            <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
            <fileTest path="${PostgreSqlIni}" condition="exists"/>
          </ruleList>
        </iniFileSet>
      </actionList>
      <ruleList>
        <compareText logic="does_not_equal" text="${platform_name}" value="windows"/>
      </ruleList>
    </actionGroup>

    <actionGroup>
      <actionList>
          
        <!-- WINDOWS: Unregister the event message DLL -->
        <registryDelete key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Uninstallations\postgresplus-${product_version}"/>
        <registryDelete key="HKEY_LOCAL_MACHINE\SOFTWARE\EnterpriseDB\PostgresPlus\Installations\postgresplus-${product_version}"/>
    
        <deleteFile path="${installdir}\Slony">
          <ruleList>
            <isTrue value="${uninstall_slony}"/>
          </ruleList>
        </deleteFile>
    
        <deleteFile path="${installdir}\PostGIS">
          <ruleList>
            <isTrue value="${uninstall_postgis}"/>
          </ruleList>
        </deleteFile>
    
        <deleteFile path="${installdir}\pgJDBC">
          <ruleList>
            <isTrue value="${uninstall_pgjdbc}"/>
          </ruleList>
        </deleteFile>
    
        <deleteFile path="${installdir}\StackBuilderPlus">
          <ruleList>
            <isTrue value="${uninstall_sbp}"/>
          </ruleList>
        </deleteFile>
    
        <deleteFile path="${installdir}\psqlODBC">
          <ruleList>
            <isTrue value="${uninstall_psqlOdbc}"/>
          </ruleList>
        </deleteFile>
    
        <deleteFile path="${installdir}\Npgsql">
          <ruleList>
            <isTrue value="${uninstall_npgsql}"/>
          </ruleList>
        </deleteFile>
    
        <deleteFile path="${installdir}\pgbouncer">
          <ruleList>
            <isTrue value="${uninstall_pgbouncer}"/>
          </ruleList>
        </deleteFile>
    
        <deleteFile path="${installdir}\pgAgent">
          <ruleList>
            <isTrue value="${uninstall_pgagent}"/>
          </ruleList>
        </deleteFile>
    
        <showWarning text="${msg(uninstall.restart.message)}">
          <ruleList>
            <fileExists path="${installdir}\bin"/>
            <fileTest path="${installdir}\bin" condition="is_not_empty"/>
          </ruleList>
        </showWarning>
    
        <deleteFile path="${installdir}\logs">
          <ruleList>
            <isTrue value="${uninstall_dbserver}"/>
          </ruleList>
        </deleteFile>
    
        <deleteFile path="${installdir}\man">
          <ruleList>
            <isTrue value="${uninstall_dbserver}"/>
          </ruleList>
        </deleteFile>

        <!-- Wait for 5 seconds and wait for all the uninstallers to finish execution -->
        <wait ms="5000"/>

      </actionList>
      <ruleList>
        <compareText logic="equals" text="${platform_name}" value="windows"/>
      </ruleList>
    </actionGroup>

  </postUninstallationActionList>

  <!-- Component Selection Screen -->

  <allowComponentSelection>1</allowComponentSelection>

  <!-- Components -->

  <componentList>

    <component>
      <name>dbserver</name>
      <description>Database Server</description>
      <detailedDescription>The PostgreSQL database server.</detailedDescription>
      <canBeEdited>1</canBeEdited>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <folder>
          <description>Program Files</description>
          <destination>${installdir}</destination>
          <name>programfiles</name>
          <platforms>all</platforms>
        </folder>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/postgresql-PG_PACKAGE_VERSION-linux.bin</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/getlocales.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/generate_uuid.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/sysinfo.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/validateUserClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/isUserValidated.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/dynaTuneClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/runvalidateUserClient.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/runisUserValidated.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/rundynaTuneClient.sh</origin>
            </distributionFile>
            <distributionDirectory>
              <origin>staging/linux/scripts/lib</origin>
            </distributionDirectory>

            <!-- starts here -->
            <distributionDirectory>
              <origin>staging/linux/scripts/pgcontrol</origin>
            </distributionDirectory>
            <distributionFile>
              <origin>staging/linux/scripts/runpgcontroldata.sh</origin>
            </distributionFile>

            <!-- ends here -->

            <distributionFile>
              <origin>staging/linux/scripts/modifyPostgresql.o</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>dbserverlinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/scripts/generate_uuid.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/sysinfo.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/validateUserClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/isUserValidated.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/dynaTuneClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/runvalidateUserClient.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/runisUserValidated.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/rundynaTuneClient.sh</origin>
            </distributionFile>
            <distributionDirectory>
              <origin>staging/linux/scripts/lib</origin>
            </distributionDirectory>

            <!-- starts here -->
            <distributionDirectory>
              <origin>staging/linux/scripts/pgcontrol</origin>
            </distributionDirectory>
            <distributionFile>
              <origin>staging/linux/scripts/runpgcontroldata.sh</origin>
            </distributionFile>

            <!-- ends here -->

            <distributionFile>
              <origin>staging/linux/scripts/modifyPostgresql.o</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64 -->

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/postgresql-PG_PACKAGE_VERSION-linux-x64.bin</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/getlocales.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/generate_uuid.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/sysinfo.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/validateUserClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/isUserValidated.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/dynaTuneClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/runvalidateUserClient.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/runisUserValidated.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/rundynaTuneClient.sh</origin>
            </distributionFile>
            <distributionDirectory>
              <origin>staging/linux-x64/scripts/lib</origin>
            </distributionDirectory>

            <!-- starts here -->
            <distributionDirectory>
              <origin>staging/linux-x64/scripts/pgcontrol</origin>
            </distributionDirectory>
            <distributionFile>
              <origin>staging/linux-x64/scripts/runpgcontroldata.sh</origin>
            </distributionFile>

            <!-- ends here -->

            <distributionFile>
              <origin>staging/linux-x64/scripts/modifyPostgresql.o</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>dbserverlinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/scripts/generate_uuid.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/sysinfo.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/validateUserClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/isUserValidated.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/dynaTuneClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/runvalidateUserClient.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/runisUserValidated.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/rundynaTuneClient.sh</origin>
            </distributionFile>
            <distributionDirectory>
              <origin>staging/linux-x64/scripts/lib</origin>
            </distributionDirectory>

            <!-- starts here -->
            <distributionDirectory>
              <origin>staging/linux-x64/scripts/pgcontrol</origin>
            </distributionDirectory>
            <distributionFile>
              <origin>staging/linux-x64/scripts/runpgcontroldata.sh</origin>
            </distributionFile>

            <!-- ends here -->

            <distributionFile>
              <origin>staging/linux-x64/scripts/modifyPostgresql.o</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileswindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/postgresql-PG_PACKAGE_VERSION-windows.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/getlocales.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/createuser.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/validateuser.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/dbserver_guid.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/validateUserClient.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/isUserValidated.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/getDynaTune.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/modifyPostgresql.exe</origin>
            </distributionFile>

            <!-- starts here -->
            <distributionDirectory>
              <origin>staging/windows/scripts/pgcontrol</origin>
            </distributionDirectory>

            <distributionFile>
              <origin>staging/windows/scripts/vcredist_x86.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/installruntimes.vbs</origin>
            </distributionFile>

            <!-- ends here -->

          </distributionFileList>
        </folder>
        <folder>
          <description>DEB</description>
          <destination>${ppss_temp_directory}</destination>
          <name>postgresplus</name>
          <platforms>all</platforms>
        </folder>
        <folder>
          <description>DEB</description>
          <destination>${ppss_temp_directory}</destination>
          <name>apache</name>
          <platforms>all</platforms>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfilesmacosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/osx/postgresql-PG_PACKAGE_VERSION-osx.app</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/getlocales.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/preinstall.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/generate_uuid.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/sysinfo.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/validateUserClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/isUserValidated.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/dynaTuneClient.o</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/modifyPostgresql.o</origin>
            </distributionFile>

            <!-- starts here -->
            <distributionDirectory>
              <origin>staging/osx/scripts/pgcontrol</origin>
            </distributionDirectory>


            <!-- ends here -->
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>
      </componentSelectionValidationActionList>
    </component>
    <component>
      <name>stackbuilderplus</name>
      <description>Stack-Builder Plus</description>
      <detailedDescription>An advanced application stack builder for PostgreSQL server.</detailedDescription>
      <canBeEdited>0</canBeEdited>
      <selected>1</selected>
      <show>0</show>
      <folderList>
        <!-- linux -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>stackbuilderpluslinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-linux.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64 -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>stackbuilderpluslinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-linux-x64.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>stackbuilderplusosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionDirectory>
              <origin>staging/osx/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-osx.app</origin>
            </distributionDirectory>
          </distributionFileList>
        </folder>

        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>stackbuilderpluswindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/stackbuilderplus-pg_PG_VERSION_STR-PG_VERSION_SBP-PG_BUILDNUM_SBP-windows.exe</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <setInstallerVariable name="noComponentSelected" persist="1" value="false"/>
      </componentSelectionValidationActionList>
    </component>
    <component>
      <name>slony</name>
      <description>Slony</description>
      <detailedDescription>A single master to multiple slaves replication engine.</detailedDescription>
      <canBeEdited>1</canBeEdited>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-linux.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64 -->

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-linux-x64.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>slonyosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionDirectory>
              <origin>staging/osx/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-osx.app</origin>
            </distributionDirectory>
          </distributionFileList>
        </folder>

        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>slonywindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/slony-pgPG_CURRENT_VERSION-PG_VERSION_SLONY-PG_BUILDNUM_SLONY-windows.exe</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}/bin/psql</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>does_not_equal</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>

        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}\bin\psql.exe</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>equals</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>

        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>

      </componentSelectionValidationActionList>
    </component>
    <component>
      <name>pgJdbc</name>
      <description>pgJDBC</description>
      <detailedDescription>The PostgreSQL JDBC driver.</detailedDescription>
      <canBeEdited>1</canBeEdited>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-linux.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64-->

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-linux-x64.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgjdbcosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionDirectory>
              <origin>staging/osx/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-osx.app</origin>
            </distributionDirectory>
          </distributionFileList>
        </folder>

        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgjdbcwindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/pgjdbc-PG_VERSION_PGJDBC-PG_BUILDNUM_PGJDBC-windows.exe</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}/bin/psql</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>does_not_equal</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}\bin\psql.exe</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>equals</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>
      </componentSelectionValidationActionList>
    </component>
    <component>
      <name>postgis</name>
      <description>PostGIS</description>
      <canBeEdited>1</canBeEdited>
      <detailedDescription>Spatial datatypes and functions for PostgreSQL.</detailedDescription>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-linux.bin</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/check-connection.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/check-db.sh</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>postgislinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/scripts/check-connection.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux/scripts/check-db.sh</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64-->

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-linux-x64.bin</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/check-connection.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/check-db.sh</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>postgislinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/scripts/check-connection.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/linux-x64/scripts/check-db.sh</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>postgisosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionDirectory>
              <origin>staging/osx/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-osx.app</origin>
            </distributionDirectory>
            <distributionFile>
              <origin>staging/osx/scripts/check-connection.sh</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/osx/scripts/check-db.sh</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>postgiswindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/postgis-pgPG_CURRENT_VERSION-PG_VERSION_POSTGIS-PG_BUILDNUM_POSTGIS-windows.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/createuser.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/validateuser.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/check-connection.bat</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/check-db.bat</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}/bin/psql</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>does_not_equal</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}\bin\psql.exe</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>equals</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>
      </componentSelectionValidationActionList>
    </component>
    <component>
      <name>psqlOdbc</name>
      <description>psqlODBC</description>
      <detailedDescription>The PostgreSQL ODBC driver.</detailedDescription>
      <canBeEdited>1</canBeEdited>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-linux.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64-->

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>programfileslinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-linux-x64.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>psqlodbcosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionDirectory>
              <origin>staging/osx/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-osx.app</origin>
            </distributionDirectory>
          </distributionFileList>
        </folder>

        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>psqlodbcwindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/psqlodbc-PG_VERSION_PSQLODBC-PG_BUILDNUM_PSQLODBC-windows.exe</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}/bin/psql</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>does_not_equal</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>

        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}\bin\psql.exe</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>equals</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>
      </componentSelectionValidationActionList>
    </component>

    <!--NpgSQL -->
    <component>
      <name>npgsql</name>
      <description>NpgSQL</description>
      <detailedDescription>The PostgreSQL .NET data provider.</detailedDescription>
      <canBeEdited>1</canBeEdited>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>npgsqlwindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-windows.exe</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
        <!-- linux -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>npgsqllinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-linux.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
        <!-- linux-x64 -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>npgsqllinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-linux-x64.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
        <!-- osx -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>npgsqlosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/osx/npgsql-PG_VERSION_NPGSQL-PG_BUILDNUM_NPGSQL-osx.app</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}/bin/psql</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>does_not_equal</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>

        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}\bin\psql.exe</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>equals</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>
      </componentSelectionValidationActionList>
    </component>
    <!-- pgbouncer -->
    <component>
      <name>pgbouncer</name>
      <description>pgBouncer</description>
      <detailedDescription>A connection pooler for PostgreSQL</detailedDescription>
      <canBeEdited>1</canBeEdited>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgbouncerlinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-linux.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64-->

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgbouncerlinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-linux-x64.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgbouncerosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionDirectory>
              <origin>staging/osx/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-osx.app</origin>
            </distributionDirectory>
          </distributionFileList>
        </folder>

        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgbouncerwindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/pgbouncer-PG_VERSION_PGBOUNCER-PG_BUILDNUM_PGBOUNCER-windows.exe</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}/bin/psql</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>does_not_equal</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}\bin\psql.exe</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>equals</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>
      </componentSelectionValidationActionList>
    </component>

    <!-- pgmemcache -->
    <component>
      <name>pgmemcache</name>
      <description>pgMemcache</description>
      <detailedDescription>A caching library for PostgreSQL</detailedDescription>
      <canBeEdited>1</canBeEdited>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgmemcachelinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/pgmemcache-pgPG_CURRENT_VERSION-PG_VERSION_PGMEMCACHE-PG_BUILDNUM_PGMEMCACHE-linux.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64-->

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgmemcachelinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/pgmemcache-pgPG_CURRENT_VERSION-PG_VERSION_PGMEMCACHE-PG_BUILDNUM_PGMEMCACHE-linux-x64.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgmemcacheosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionDirectory>
              <origin>staging/osx/pgmemcache-pgPG_CURRENT_VERSION-PG_VERSION_PGMEMCACHE-PG_BUILDNUM_PGMEMCACHE-osx.app</origin>
            </distributionDirectory>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}/bin/psql</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>does_not_equal</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>

        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}\bin\psql.exe</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>equals</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>
      </componentSelectionValidationActionList>
    </component>

    <!-- pgAgent -->
    <component>
      <name>pgagent</name>
      <description>pgAgent</description>
      <detailedDescription>A job scheduler for PostgreSQL</detailedDescription>
      <canBeEdited>1</canBeEdited>
      <selected>1</selected>
      <show>1</show>
      <folderList>
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgagentlinux</name>
          <platforms>linux</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-linux.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- linux-x64-->

        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgagentlinux-x64</name>
          <platforms>linux-x64</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/linux-x64/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-linux-x64.bin</origin>
            </distributionFile>
          </distributionFileList>
        </folder>

        <!-- MAC: Program files -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgagentosx</name>
          <platforms>osx</platforms>
          <distributionFileList>
            <distributionDirectory>
              <origin>staging/osx/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-osx.app</origin>
            </distributionDirectory>
          </distributionFileList>
        </folder>

        <!-- Windows -->
        <folder>
          <description>Program Files</description>
          <destination>${ppss_temp_directory}</destination>
          <name>pgagentwindows</name>
          <platforms>windows</platforms>
          <distributionFileList>
            <distributionFile>
              <origin>staging/windows/pgagent-PG_VERSION_PGAGENT-PG_BUILDNUM_PGAGENT-windows.exe</origin>
            </distributionFile>
            <distributionFile>
              <origin>staging/windows/scripts/validateuser.exe</origin>
            </distributionFile>
          </distributionFileList>
        </folder>
      </folderList>
      <componentSelectionValidationActionList>
        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}/bin/psql</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>does_not_equal</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>

        <throwError>
          <text>${msg(dbserver.required.pgerror)}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>0</value>
            </compareText>
            <fileTest>
              <path>${installdir}\bin\psql.exe</path>
              <condition>not_exists</condition>
            </fileTest>
            <compareText>
              <text>${platform_name}</text>
              <logic>equals</logic>
              <value>windows</value>
            </compareText>
          </ruleList>
        </throwError>
        <setInstallerVariable>
          <name>noComponentSelected</name>
          <persist>1</persist>
          <value>false</value>
        </setInstallerVariable>
      </componentSelectionValidationActionList>
    </component>

  </componentList>

  <parameterList>
    <booleanParameter name="extract_mode" cliOptionName="extract-only" default="0" ask="1" cliOptionShow="1"/>
    <booleanParameter name="admin_rights" cliOptionName="require-admin" default="0" ask="0" cliOptionShow="0"/>
    <stringParameter name="originalplatform" ask="0" cliOptionShow="0">
      <description></description>
      <explanation></explanation>
      <value></value>
      <default></default>
      <allowEmptyValue>1</allowEmptyValue>
      <width>30</width>
    </stringParameter>

    <stringParameter name="superaccount" ask="1" cliOptionShow="1" cliOptionName="superaccount" default="postgres"
        description="${msg(superaccount.description)}"/>
    <stringParameter name="servicename" ask="1" cliOptionShow="1" cliOptionName="servicename" default="postgresql-PG_MAJOR_VERSION"
        description="${msg(servicename.description)}"/>
    <stringParameter name="serviceaccount" ask="1" cliOptionShow="1" cliOptionName="serviceaccount" default="postgres"
        description="${msg(serviceaccount.description)}"/>

    <!-- Installation directory. Only show if ${iBaseDirectory} is empty -->
    <directoryParameter>
      <name>installdir</name>
      <description>Installer.Parameter.installdir.description</description>
      <explanation>Installer.Parameter.installdir.explanation</explanation>
      <value></value>
      <default>${default_installdir}</default>
      <allowEmptyValue>0</allowEmptyValue>
      <ask>yes</ask>
      <cliOptionName>prefix</cliOptionName>
      <mustBeWritable>yes</mustBeWritable>
      <mustExist>0</mustExist>
      <width>30</width>

      <!-- Note that this validation occurs in a postShowPageActionList due     
           to some odd behaviour in InstallBuilder in the way <allowEmptyValue> 
           interacts with default values, on the advice of tech support         
           !WIN: Always check if the installation directory path looks valid 
      -->
      <postShowPageActionList>
        <actionGroup>
          <actionList>
            <showWarning>
              <text>${msg(error.install.directory.invalid)}</text>
            </showWarning>
            <setInstallerVariable name="next_page" value="installdir">
              <persist>1</persist>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <regExMatch>
              <logic>does_not_match</logic>
              <pattern>^/([0-9a-zA-Z_/\.\-]*)$</pattern>
              <text>${installdir}</text>
            </regExMatch>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
        <actionGroup>
          <actionList>
            <showWarning>
              <text>${msg(error.install.directory.invalid.linux)}</text>
            </showWarning>
            <setInstallerVariable name="next_page" value="installdir">
              <persist>1</persist>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <regExMatch>
              <logic>matches</logic>
              <pattern>^/+(usr)?$</pattern>
              <text>${installdir}</text>
            </regExMatch>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>


        <!-- WIN: Always check if the installation directory path looks valid -->
        <actionGroup>
          <actionList>
            <showWarning>
              <text>${msg(error.install.directory.invalid)}</text>
            </showWarning>
            <setInstallerVariable name="next_page" value="installdir">
              <persist>1</persist>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <regExMatch>
              <logic>does_not_match</logic>
              <pattern>^([a-zA-Z]:)\\([0-9a-zA-Z_\\\s\.\-\(\)]*)$</pattern>
              <text>${installdir}</text>
            </regExMatch>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
        <!-- Switch to upgrade mode -->
        <actionGroup>
          <actionList>
            <setInstallerVariable>
              <name>IsUpgrade</name>
              <value>1</value>
            </setInstallerVariable>
            <logMessage>
              <text>Switching to upgrade mode with cluster: ${datadir}</text>
            </logMessage>
          </actionList>

          <!-- We only check the data directory if it exists and isn't empty -->
          <ruleList>
            <fileExists>
              <path>${installdir}\data</path>
            </fileExists>
            <fileTest>
              <path>${installdir}\data</path>
              <condition>is_not_empty</condition>
            </fileTest>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
        <!-- End of data directory check -->

      </postShowPageActionList>
      <ruleList>
        <stringTest>
          <text>${iBaseDirectory}</text>
          <type>empty</type>
        </stringTest>
      </ruleList>
    </directoryParameter>

    <!-- Explain that we're using an existing installation directory -->
    <labelParameter>
      <name>upgrade</name>
      <title>${msg(upgrade.existing.installation.title)}</title>
      <description>${msg(upgrade.existing.installation.description)}</description>
      <explanation></explanation>
      <image></image>
      <preShowPageActionList>
        <!-- Set the installation directory to the existing location-->
        <setInstallerVariable>
          <name>installdir</name>
          <persist>1</persist>
          <value>${iBaseDirectory}</value>
        </setInstallerVariable>
      </preShowPageActionList>
      <ruleList>
        <stringTest>
          <text>${iBaseDirectory}</text>
          <type>not_empty</type>
        </stringTest>
      </ruleList>
    </labelParameter>

    <!--Value Added Screen -->
    <parameterGroup>
      <name>valueAddedServices</name>
      <title>${msg(valueadded.title.value)}</title>
      <explanation></explanation>
      <value></value>
      <default></default>
      <parameterList>
        <booleanParameter>
          <name>dbInstallTune</name>
          <description>${msg(valueadded.dbInstallTuning.rb1.value)} </description>
          <explanation></explanation>
          <value></value>
          <default>1</default>
          <displayStyle>checkbox-left</displayStyle>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${showInstallationTuning}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </booleanParameter>
        <labelParameter>
          <name>lblInstallTune</name>
          <description></description>
          <explanation>${msg(valueadded.dbInstallTuning.lbl.value)}</explanation>
          <image></image>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${showInstallationTuning}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </labelParameter>
        <booleanParameter>
          <name>updateNotification</name>
          <description>${msg(valueadded.updateNotification.rb2.value)}</description>
          <explanation></explanation>
          <value></value>
          <default>1</default>
          <displayStyle>checkbox-left</displayStyle>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${showUpdateNotification}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </booleanParameter>
        <labelParameter>
          <name>lblUpdateNotification</name>
          <description></description>
          <explanation>${msg(valueadded.updateNotification.lbl.value)}</explanation>
          <image></image>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${showUpdateNotification}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </labelParameter>
      </parameterList>
      <postShowPageActionList>
        <actionGroup>
          <actionList>
            <setInstallerVariable>
              <name>dbInstallTune</name>
              <persist>1</persist>
              <value>0</value>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </actionGroup>
        <actionGroup>
          <actionList>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/a.properties</file>
              <key>dbser_guid</key>
              <variable>dbserver_guid</variable>
            </propertiesFileGet>
          </actionList>
        </actionGroup>
        <actionGroup>
          <actionList>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/sysinfo.properties</file>
              <key>PROCESSOR_ARCH</key>
              <variable>processor_arch</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/sysinfo.properties</file>
              <key>TOTAL_MEM_IN_GB</key>
              <variable>total_mem_in_gb</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/sysinfo.properties</file>
              <key>OS</key>
              <variable>os</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/sysinfo.properties</file>
              <key>NUMBER_OF_PROCESSORS</key>
              <variable>number_of_processors</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/sysinfo.properties</file>
              <key>PROCESSOR_TYPE</key>
              <variable>processor_type</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/sysinfo.properties</file>
              <key>LANGUAGE</key>
              <variable>language</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/sysinfo.properties</file>
              <key>SHARED_MEMORY_IN_MB</key>
              <variable>shared_memory_in_mb</variable>
            </propertiesFileGet>
          </actionList>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>
        <setInstallerVariable name="dbInstallTuneBool" value="false" />
        <actionGroup>
          <actionList>
            <setInstallerVariable>
              <name>dbInstallTuneBool</name>
              <persist>1</persist>
              <value>true</value>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <isTrue value="${dbInstallTune}" />
          </ruleList>
        </actionGroup>
        <setInstallerVariable name="updateNotificationBool" value="false" />
        <actionGroup>
          <actionList>
            <setInstallerVariable>
              <name>updateNotificationBool</name>
              <persist>1</persist>
              <value>true</value>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <isTrue value="${updateNotification}" />
          </ruleList>
        </actionGroup>
        <setInstallerVariable name="showAuthenticateScreen" value="0" />
        <setInstallerVariable>
          <name>showAuthenticateScreen</name>
          <persist>0</persist>
          <value>1</value>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
            <isTrue value="${dbInstallTune}" />
            <isTrue value="${updateNotification}" />
          </ruleList>
        </setInstallerVariable>
        <setInstallerVariable name="showNextPage" value="0" />
        <setInstallerVariable>
          <name>showNextPage</name>
          <persist>1</persist>
          <value>1</value>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </setInstallerVariable>
        <setInstallerVariable name="showNextPage2" value="0" />
        <setInstallerVariable>
          <name>showNextPage2</name>
          <persist>1</persist>
          <value>1</value>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${component(postgis).selected}</text>
              <value>1</value>
            </compareText>
          </ruleList>
        </setInstallerVariable>

        <!-- authenticateUser variable is created to check whether we should call webservice to authenticate user or not-->
        <setInstallerVariable name="authenticateUser" value="0" />
        <setInstallerVariable>
          <name>authenticateUser</name>
          <persist>1</persist>
          <value>1</value>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
            <isTrue value="${dbInstallTune}" />
            <isTrue value="${updateNotification}" />
          </ruleList>
        </setInstallerVariable>
      </postShowPageActionList>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${showValueAddedServicePage}</text>
          <value>1</value>
        </compareText>
        <compareText>
          <logic>equals</logic>
          <text>${component(dbserver).selected}</text>
          <value>1</value>
        </compareText>
        <compareText>
          <logic>equals</logic>
          <text>${noComponentSelected}</text>
          <value>false</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </parameterGroup>

    <!-- User Authentication -->

    <parameterGroup>
      <name>userAuthentication</name>
      <title>${msg(existingUser.title.value)}</title>
      <parameterList>
        <labelParameter>
          <name>lblcreateUserAccount</name>
          <explanation>${msg(existingUser.lbl.text.value)}</explanation>
        </labelParameter>
        <booleanParameter>
          <name>rbExistingUser</name>
          <ask>yes</ask>
          <default>0</default>
          <value>1</value>
          <description>${msg(userAuth.existing.user.lbl.value)}</description>
        </booleanParameter>
      </parameterList>
      <postShowPageActionList>
        <launchBrowser>
          <url>https://www.enterprisedb.com/create-account.do</url>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${rbExistingUser}</text>
              <value>0</value>
            </compareText>
          </ruleList>
        </launchBrowser>
      </postShowPageActionList>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${showAuthenticateScreen}</text>
          <value>1</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </parameterGroup>
    <parameterGroup>
      <name>userAuthenticationField</name>
      <title>${msg(userAuth.title.value)}</title>
      <explanation></explanation>
      <value></value>
      <default></default>
      <parameterList>
        <labelParameter>
          <name>lblemail</name>
          <description></description>
          <explanation>${msg(lbl.email.value)}</explanation>
          <image></image>
        </labelParameter>
        <stringParameter>
          <name>existingEmail</name>
          <description>${msg(userAuth.email.value)}</description>
          <explanation></explanation>
          <value></value>
          <default></default>
          <allowEmptyValue>1</allowEmptyValue>
          <width>30</width>
          <validationActionList>
            <throwError>
              <text>${msg(error.invalid.email.value)}</text>
              <ruleList>
                <regExMatch>
                  <logic>does_not_match</logic>
                  <pattern>^[a-zA-Z][\w\.-]*[a-zA-Z0-9]@[a-zA-Z0-9][\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]$</pattern>
                  <text>${existingEmail}</text>
                </regExMatch>
              </ruleList>
            </throwError>
          </validationActionList>
        </stringParameter>
        <passwordParameter>
          <name>existingpassword</name>
          <description>${msg(userAuth.existing.password.value)}</description>
          <explanation></explanation>
          <value></value>
          <default>${defaultpassword}</default>
          <allowEmptyValue>0</allowEmptyValue>
          <ask>yes</ask>
          <askForConfirmation>0</askForConfirmation>
          <cliOptionName>existingpassword</cliOptionName>
          <descriptionRetype></descriptionRetype>
          <width>30</width>
          <validationActionList>
            <throwError>
              <text>${msg(error.invalid.password.value)}</text>
              <ruleEvaluationLogic>or</ruleEvaluationLogic>
              <ruleList>
                <stringTest>
                  <text>${existingpassword}</text>
                  <type>empty</type>
                </stringTest>
                <regExMatch>
                  <logic>matches</logic>
                  <pattern>\s+</pattern>
                  <text>${existingpassword}</text>
                </regExMatch>
              </ruleList>
            </throwError>
          </validationActionList>
        </passwordParameter>
      </parameterList>
      <postShowPageActionList>
        <actionGroup>
          <actionList>
            <setInstallerVariable name="features" value="DBServer">
              <ruleList>
                <isTrue value="${component(dbserver).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},StackBuilderPlus">
              <ruleList>
                <isTrue value="${component(stackbuilderplus).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},Slony">
              <ruleList>
                <isTrue value="${component(slony).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},pgJdbc">
              <ruleList>
                <isTrue value="${component(pgJdbc).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},postGIS">
              <ruleList>
                <isTrue value="${component(postgis).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},psqlODBC">
              <ruleList>
                <isTrue value="${component(psqlOdbc).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},Npgsql">
              <ruleList>
                <isTrue value="${component(npgsql).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},pgbouncer">
              <ruleList>
                <isTrue value="${component(pgbouncer).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},pgmemcache">
              <ruleList>
                <isTrue value="${component(pgmemcache).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="features" value="${features},pgAgent">
              <ruleList>
                <isTrue value="${component(pgagent).selected}"/>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariableFromRegEx name="features" pattern="^," substitution="" text="${features}">
              <ruleList>
                  <regExMatch logic="matches" pattern="^,([0-9a-zA-Z_/\.\-]*)$" text="${features}"/>
              </ruleList>
            </setInstallerVariableFromRegEx>

            <logMessage>
              <text>Validating Existing User ...</text>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${authenticateUser}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </logMessage>

            <logMessage>
              <text>Passing values:"${dbserver_guid}" "${features}" "${dbInstallTuneBool}" "${updateNotificationBool}" "${language}" "${os}" "${number_of_processors}" "${processor_arch}" "${processor_type}" "${total_mem_in_gb}" "${shared_memory_in_mb}" "${existingEmail}" "password"</text>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${authenticateUser}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </logMessage>

            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}/validateUserClient.o</exec>
              <execArgs>"${dbserver_guid}" "${features}" "${dbInstallTuneBool}" "${updateNotificationBool}" "${language}" "${os}" "${number_of_processors}" "${processor_arch}" "${processor_type}" "${total_mem_in_gb}" "${shared_memory_in_mb}" "${existingEmail}" "${existingpassword.password}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_existing_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>osx</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${authenticateUser}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>

            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}/runvalidateUserClient.sh</exec>
              <execArgs>"${ppss_temp_directory}" "${dbserver_guid}" "${features}" "${dbInstallTuneBool}" "${updateNotificationBool}" "${language}" "${os}" "${number_of_processors}" "${processor_arch}" "${processor_type}" "${total_mem_in_gb}" "${shared_memory_in_mb}" "${existingEmail}" "${existingpassword.password}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_existing_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${authenticateUser}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>

            <logMessage>
              <text>Validating Existing User ...</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${authenticateUser}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </logMessage>

            <logMessage>
              <text>Passing values:"${features}" "${dbInstallTuneBool}" "${updateNotificationBool}" "${existingEmail}" "password" "${dbserver_guid}"</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${authenticateUser}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </logMessage>

            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}\validateUserClient.exe</exec>
              <execArgs>"${features}" "${dbInstallTuneBool}" "${updateNotificationBool}" "${existingEmail}" "${existingpassword.password}" "${dbserver_guid}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_existing_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
                <compareText>
                  <logic>equals</logic>
                  <text>${authenticateUser}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>

            <logMessage>
              <text>Returned value=${ws_existing_result}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${authenticateUser}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </logMessage>
            <throwError text="${msg(ws.email.not.authenticated)}">
              <abortOnError>0</abortOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_existing_result}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </throwError>
            <throwError>
              <abortOnError>0</abortOnError>
              <text>${msg(ws.email.not.valid)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_existing_result}</text>
                  <value>2</value>
                </compareText>
              </ruleList>
            </throwError>
            <throwError>
              <abortOnError>0</abortOnError>
              <text>${msg(ws.email.already.exists)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_existing_result}</text>
                  <value>3</value>
                </compareText>
              </ruleList>
            </throwError>
            <throwError>
              <abortOnError>0</abortOnError>
              <text>${msg(ws.exception.from.server)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_existing_result}</text>
                  <value>4</value>
                </compareText>
              </ruleList>
            </throwError>
            <throwError>
              <abortOnError>0</abortOnError>
              <text>${msg(ws.internet.not.connected)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_existing_result}</text>
                  <value></value>
                </compareText>
              </ruleList>
            </throwError>
            <setInstallerVariable name="next_page" value="userAuthenticationField">
              <persist>0</persist>
              <ruleEvaluationLogic>or</ruleEvaluationLogic>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${ws_existing_result}</text>
                  <value>0</value>
                </compareText>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${ws_existing_result}</text>
                  <value>00</value>
                </compareText>
              </ruleList>
            </setInstallerVariable>

            <!--User is authenticated so we will install SBP with monitoring -->
            <setInstallerVariable name="installMonitoring" value="1">
              <persist>0</persist>
              <ruleList>
                <ruleGroup>
                  <ruleEvaluationLogic>or</ruleEvaluationLogic>
                  <ruleList>
                    <compareText>
                      <logic>equals</logic>
                      <text>${ws_existing_result}</text>
                      <value>0</value>
                    </compareText>
                    <compareText>
                      <logic>equals</logic>
                      <text>${ws_existing_result}</text>
                      <value>00</value>
                    </compareText>
                  </ruleList>
                </ruleGroup>
                <isTrue value="${updateNotification}"/>
              </ruleList>
            </setInstallerVariable>

          </actionList>
        </actionGroup>
      </postShowPageActionList>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${showAuthenticateScreen}</text>
          <value>1</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </parameterGroup>

    <!-- Server Utilization -->
    <parameterGroup>
      <name>server_utilization</name>
      <title>${msg(server_utilization.title.value)}</title>
      <explanation></explanation>
      <value></value>
      <default></default>
      <parameterList>
        <labelParameter>
          <name>lblServerUtilization_exp</name>
          <description></description>
          <explanation>${msg(server_utilization.explaination.lbl.value)}</explanation>
          <image></image>
        </labelParameter>
        <choiceParameter>
          <name>rbServerUtil</name>
          <description></description>
          <explanation></explanation>
          <value></value>
          <default>66</default>
          <allowEmptyValue>1</allowEmptyValue>
          <displayType>radiobuttons</displayType>
          <width>30</width>
          <optionList>
            <option>
              <description></description>
              <image></image>
              <text>${msg(server_utilization.development.title.value)}</text>
              <value>33</value>
            </option>
            <option>
              <description></description>
              <image></image>
              <text>${msg(server_utilization.mixed.title.value)}</text>
              <value>66</value>
            </option>
            <option>
              <description></description>
              <image></image>
              <text>${msg(server_utilization.dedicated.title.value)}</text>
              <value>100</value>
            </option>
          </optionList>
        </choiceParameter>
      </parameterList>
      <ruleList>
        <isTrue value="${dbInstallTune}" />
        <isFalse value="${IsUpgrade}" />
        <compareText>
          <logic>equals</logic>
          <text>${ws_existing_result}</text>
          <value>0</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </parameterGroup>

    <!-- Workload Profile -->
    <parameterGroup>
      <name>workload_profile</name>
      <title>${msg(workload_profile.title.value)}</title>
      <explanation></explanation>
      <value></value>
      <default></default>
      <parameterList>
        <labelParameter>
          <name>lblWorkload_exp</name>
          <description></description>
          <explanation>${msg(workload_profile.explaination.lbl.value)}</explanation>
          <image></image>
        </labelParameter>
        <choiceParameter>
          <name>rbWorkload</name>
          <description></description>
          <explanation></explanation>
          <value></value>
          <default>MIXED</default>
          <allowEmptyValue>1</allowEmptyValue>
          <displayType>radiobuttons</displayType>
          <width>30</width>
          <optionList>
            <option>
              <description></description>
              <image></image>
              <text>${msg(workload_profile.transaction.title.value)}</text>
              <value>OLTP</value>
            </option>
            <option>
              <description></description>
              <image></image>
              <text>${msg(workload_profile.general.title.value)}</text>
              <value>MIXED</value>
            </option>
            <option>
              <description></description>
              <image></image>
              <text>${msg(workload_profile.reporting.title.value)}</text>
              <value>REPORTING</value>
            </option>
          </optionList>
        </choiceParameter>
      </parameterList>
      <postShowPageActionList>
        <actionGroup>
          <actionList>
            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}/isUserValidated.o</exec>
              <execArgs>"${existingEmail}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_validated_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>osx</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>
            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}/runisUserValidated.sh</exec>
              <execArgs>"${ppss_temp_directory}" "${existingEmail}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_validated_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>

            <!--Windows scripts -->
            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}\isUserValidated.exe</exec>
              <execArgs>"${existingEmail}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_validated_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>
            <throwError>
              <abortOnError>0</abortOnError>
              <text>${msg(ws.email.not.valid.dynatune)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_validated_result}</text>
                  <value>false</value>
                </compareText>
              </ruleList>
            </throwError>
            <setInstallerVariable name="next_page" value="workload_profile">
              <persist>0</persist>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_validated_result}</text>
                  <value>false</value>
                </compareText>
              </ruleList>
            </setInstallerVariable>
            <setInstallerVariable name="next_page" value="datadir">
              <persist>0</persist>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_validated_result}</text>
                  <value>true</value>
                </compareText>
              </ruleList>
            </setInstallerVariable>

            <logMessage>
              <text>Calling DynaTune WebService ...</text>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </logMessage>

            <logMessage>
              <text>Passing values:"${dbserver_guid}" "${rbServerUtil}" "${rbWorkload}" "${total_mem_in_gb}" "${shared_memory_in_mb}"</text>
              <ruleList>
                <compareText>
                  <logic>does_not_equal</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </logMessage>

            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}/dynaTuneClient.o</exec>
              <execArgs>"${dbserver_guid}" "${rbServerUtil}" "${rbWorkload}" "${total_mem_in_gb}" "${shared_memory_in_mb}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_dynatune_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>osx</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>

            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}/rundynaTuneClient.sh</exec>
              <execArgs>"${ppss_temp_directory}" "${dbserver_guid}" "${rbServerUtil}" "${rbWorkload}" "${total_mem_in_gb}" "${shared_memory_in_mb}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_dynatune_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>

            <logMessage>
              <text>Calling DynaTune WebService ...</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </logMessage>

            <logMessage>
              <text>Passing values:"${dbserver_guid}" "${rbServerUtil}" "${rbWorkload}"</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </logMessage>

            <setInstallerVariableFromScriptOutput>
              <customErrorMessage>${msg(pgplus.ws.error)}</customErrorMessage>
              <exec>${ppss_temp_directory}\getDynaTune.exe</exec>
              <execArgs>"${dbserver_guid}" "${rbServerUtil}" "${rbWorkload}" "${proxyHost}" "${proxyPort}"</execArgs>
              <name>ws_dynatune_result</name>
              <workingDirectory>${ppss_temp_directory}</workingDirectory>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </setInstallerVariableFromScriptOutput>
            <throwError>
              <abortOnError>0</abortOnError>
              <text>${msg(ws.internet.not.connected)}</text>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${ws_dynatune_result}</text>
                  <value></value>
                </compareText>
              </ruleList>
            </throwError>

            <logMessage>
              <text>writing returned values to ${ppss_temp_directory}/dynaTune.properties</text>
            </logMessage>

            <writeFile>
              <path>${ppss_temp_directory}/dynaTune.properties</path>
              <text>${ws_dynatune_result}</text>
            </writeFile>

            <!--Read properties from dynaTune.properties -->
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>max_connections</key>
              <variable>max_connections_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>work_mem</key>
              <variable>work_mem_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>maintenance_work_mem</key>
              <variable>maintenance_work_mem_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>shared_buffers</key>
              <variable>shared_buffers_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>max_fsm_relations</key>
              <variable>max_fsm_relations_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>max_fsm_pages</key>
              <variable>max_fsm_pages_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>wal_buffers</key>
              <variable>wal_buffers_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>effective_cache_size</key>
              <variable>effective_cache_size_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>random_page_cost</key>
              <variable>random_page_cost_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>checkpoint_segments</key>
              <variable>checkpoint_segments_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>autovacuum_vacuum_threshold</key>
              <variable>autovacuum_vacuum_threshold_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>autovacuum_vacuum_scale_factor</key>
              <variable>autovacuum_vacuum_scale_factor_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>autovacuum_analyze_threshold</key>
              <variable>autovacuum_analyze_threshold_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>autovacuum_analyze_scale_factor</key>
              <variable>autovacuum_analyze_scale_factor_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>autovacuum_naptime</key>
              <variable>autovacuum_naptime_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>stats_row_level</key>
              <variable>stats_row_level_var</variable>
            </propertiesFileGet>
            <propertiesFileGet>
              <file>${ppss_temp_directory}/dynaTune.properties</file>
              <key>autovacuum</key>
              <variable>autovacuum_var</variable>
            </propertiesFileGet>
          </actionList>
        </actionGroup>
      </postShowPageActionList>
      <ruleList>
        <isTrue value="${dbInstallTune}" />
        <isFalse value="${IsUpgrade}" />
        <compareText>
          <logic>equals</logic>
          <text>${ws_existing_result}</text>
          <value>0</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </parameterGroup>

    <!-- Data directory. Only show if not upgrading -->
    <directoryParameter>
      <name>datadir</name>
      <description>${msg(config.datadir.description)}</description>
      <explanation>${msg(config.datadir.explanation)}</explanation>
      <value></value>
      <default>${installdir}/data</default>
      <allowEmptyValue>0</allowEmptyValue>
      <ask>yes</ask>
      <cliOptionName>datadir</cliOptionName>
      <mustBeWritable>yes</mustBeWritable>
      <mustExist>0</mustExist>
      <width>30</width>

      <!-- Check the directory selected. If it's a valid data directory, change to upgrade mode 
           Note that this validation occurs in a postShowPageActionList due     
           to some odd behaviour in InstallBuilder in the way <allowEmptyValue> 
           interacts with default values, on the advice of tech support
      -->
      <postShowPageActionList>
        <!-- !WIN: Always check if the data directory path looks valid and is writeable -->
        <actionGroup>
          <!-- We need this because this isn't a validateActionList> -->
          <abortOnError>0</abortOnError>
          <actionList>
            <setInstallerVariable name="next_page" value="datadir">
              <persist>0</persist>
            </setInstallerVariable>
            <throwError>
              <text>${msg(error.data.directory.invalid)}</text>
            </throwError>
          </actionList>
          <ruleList>
            <regExMatch>
              <logic>does_not_match</logic>
              <pattern>^/([0-9a-zA-Z_/\.\-]*)$</pattern>
              <text>${datadir}</text>
            </regExMatch>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>

        <!-- WIN: Always check if the data directory path looks valid and is writeable -->
        <actionGroup>
          <!-- We need this because this isn't a validateActionList> -->
          <abortOnError>0</abortOnError>
          <actionList>
            <setInstallerVariable name="next_page" value="datadir">
              <persist>0</persist>
            </setInstallerVariable>
            <throwError>
              <text>${msg(error.data.directory.invalid)}</text>
            </throwError>
          </actionList>
          <ruleList>
            <regExMatch>
              <logic>does_not_match</logic>
              <pattern>^([a-zA-Z]:)\\([0-9a-zA-Z_\\\s\.\-\(\)]*)$</pattern>
              <text>${datadir}</text>
            </regExMatch>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </actionGroup>

        <!-- Build a regexp to test that the install dir is not a sub dir of the data dir 
             Remove trailing / from path -->
        <setInstallerVariableFromRegEx>
          <name>_re</name>
          <pattern>\/$</pattern>
          <substitution></substitution>
          <text>${datadir}</text>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>_re</name>
          <pattern>\\$</pattern>
          <substitution></substitution>
          <text>${datadir}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariableFromRegEx>

        <!-- Replace / with \/ or \ with \\ on windows -->
        <setInstallerVariableFromRegEx>
          <name>_re</name>
          <pattern>\/</pattern>
          <substitution>\/</substitution>
          <text>${_re}</text>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariableFromRegEx>
        <setInstallerVariableFromRegEx>
          <name>_re</name>
          <pattern>\\</pattern>
          <substitution>\\\\</substitution>
          <text>${_re}</text>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariableFromRegEx>

        <!-- build the regexp -->
        <setInstallerVariable>
          <name>_re</name>
          <persist>0</persist>
          <value>^${_re}\/([0-9a-zA-Z_/\.\-]*)</value>
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
          <name>_re</name>
          <persist>0</persist>
          <value>^${_re}\\([0-9a-zA-Z_\\\s\.\-]*)</value>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariable>

        <!-- Check the data directory does not match the installation directory -->
        <actionGroup>
          <!-- We need this because this isn't a validateActionList> -->
          <abortOnError>0</abortOnError>
          <actionList>
            <setInstallerVariable name="next_page" value="datadir">
              <persist>0</persist>
            </setInstallerVariable>
            <throwError>
              <text>${msg(error.data.directory.matches.install)}</text>
            </throwError>
          </actionList>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${datadir}</text>
              <value>${installdir}</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${datadir}/</text>
              <value>${installdir}</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${datadir}\</text>
              <value>${installdir}</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${datadir}</text>
              <value>${installdir}/</value>
            </compareText>
            <compareText>
              <logic>equals</logic>
              <text>${datadir}</text>
              <value>${installdir}\</value>
            </compareText>
            <regExMatch>
              <logic>matches</logic>
              <pattern>${_re}</pattern>
              <text>${installdir}</text>
            </regExMatch>
          </ruleList>
        </actionGroup>

        <!-- Check an existing, non-empty data directory -->
        <actionGroup>
          <!-- We need this because this isn't a validateActionList> -->
          <abortOnError>0</abortOnError>

          <!-- Switch to upgrade mode -->
          <actionList>
            <!-- Do we have a pg_control file? -->
            <actionGroup>
              <actionList>
                <setInstallerVariable name="next_page" value="datadir">
                  <persist>0</persist>
                </setInstallerVariable>
                <throwError>
                  <text>${msg(error.data.directory.existing.broken)}</text>
                </throwError>
              </actionList>
              <ruleList>
                <fileTest>
                  <condition>not_exists</condition>
                  <path>${datadir}/global/pg_control</path>
                </fileTest>
              </ruleList>
            </actionGroup>

            <!-- starts here -->

            <!-- Do we have a valid catalog version? -->
            <runProgram>
              <program>${ppss_temp_directory}/pgcontrol/bin/pg_controldata</program>
              <programArguments>"${datadir}"</programArguments>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>osx</value>
                </compareText>
              </ruleList>
            </runProgram>

            <runProgram>
              <program>${ppss_temp_directory}/runpgcontroldata.sh</program>
              <programArguments>${ppss_temp_directory}/pgcontrol "${datadir}"</programArguments>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>contains</logic>
                  <text>${platform_name}</text>
                  <value>linux</value>
                </compareText>
              </ruleList>
            </runProgram>

            <runProgram>
              <program>${ppss_temp_directory}\pgcontrol\pg_controldata.exe</program>
              <programArguments>"${datadir}"</programArguments>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${platform_name}</text>
                  <value>windows</value>
                </compareText>
              </ruleList>
            </runProgram>

            <setInstallerVariableFromRegEx>
              <name>CurrentCatalogVersion</name>
              <text>${program_stdout}</text>
              <pattern>^.*Catalog version number:\s+([\d]+).*$</pattern>
              <substitution>\1</substitution>
            </setInstallerVariableFromRegEx>

            <logMessage>
              <text>Existing cluster catalog version: ${CurrentCatalogVersion}, installer catalog version: ${CatalogVersion}</text>
            </logMessage>
            <actionGroup>
              <actionList>
                <setInstallerVariable name="next_page" value="datadir"/>
                <throwError>
                  <text>${msg(error.data.directory.incompatible)}</text>
                </throwError>
              </actionList>
              <ruleList>
                <compareText>
                  <value>${CurrentCatalogVersion}</value>
                  <logic>does_not_equal</logic>
                  <text>${CatalogVersion}</text>
                </compareText>
              </ruleList>
            </actionGroup>
          </actionList>

          <!-- Switch to upgrade mode -->
          <actionList>
            <setInstallerVariable>
              <name>IsUpgrade</name>
              <value>1</value>
            </setInstallerVariable>
            <!-- ends here -->
            <logMessage>
              <text>Switching to upgrade mode with cluster: ${datadir}</text>
            </logMessage>
          </actionList>
          <!-- We only check the data directory if it exists and isn't empty -->
          <ruleList>
            <fileExists>
              <path>${datadir}</path>
            </fileExists>
            <fileTest>
              <condition>is_not_empty</condition>
              <path>${datadir}</path>
            </fileTest>
          </ruleList>
        </actionGroup>

        <!-- End of data directory check -->
      </postShowPageActionList>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${component(dbserver).selected}</text>
          <value>1</value>
        </compareText>
        <compareValues>
          <logic>equals</logic>
          <value1>${IsUpgrade}</value1>
          <value2>0</value2>
        </compareValues>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </directoryParameter>

    <!-- Explain that we're using an existing installation directory -->
    <labelParameter>
      <name>upgrade2</name>
      <title>${msg(upgrade.existing.datadir.title)}</title>
      <description>${msg(upgrade.existing.datadir.description)}</description>
      <explanation></explanation>
      <image></image>
      <preShowPageActionList>
        <!-- As we're upgrading, grab the port number from the existing config file -->
        <actionGroup>
          <actionList>
            <logMessage>
              <text>Reading port number from ${datadir}/postgresql.conf</text>
            </logMessage>
            <readFile>
              <name>serverconfig</name>
              <path>${datadir}/postgresql.conf</path>
            </readFile>
            <setInstallerVariableFromRegEx>
              <name>serverport</name>
              <pattern>^.*port\s*=\s*([\d]+)\s+.*$</pattern>
              <substitution>\1</substitution>
              <text>${serverconfig}</text>
            </setInstallerVariableFromRegEx>
          </actionList>
        </actionGroup>
      </preShowPageActionList>
      <ruleList>
        <compareValues>
          <logic>equals</logic>
          <value1>${IsUpgrade}</value1>
          <value2>1</value2>
        </compareValues>
      </ruleList>
    </labelParameter>

    <!-- Superuser password. Show this if not an upgrade, unless this is Windows -->
    <passwordParameter>
      <name>superpassword</name>
      <description>${msg(config.superpassword.description)}</description>
      <explanation>${_explanation}</explanation>
      <value></value>
      <default>${defaultpassword}</default>
      <allowEmptyValue>1</allowEmptyValue>
      <ask>yes</ask>
      <cliOptionName>superpassword</cliOptionName>
      <descriptionRetype>${msg(config.superpassword.confirm)}</descriptionRetype>
      <width>20</width>
      <preShowPageActionList>
        <setInstallerVariable>
          <name>_explanation</name>
          <persist>0</persist>
          <value>${msg(config.superpassword.explanation)}</value>
        </setInstallerVariable>

        <!-- On Windows, we need a different explanation -->
        <actionGroup>
          <actionList>

            <!-- servicepassword is not provided through the command-line, superpassword and servicepassword will be same -->
            <setInstallerVariable>
              <name>_explanation</name>
              <persist>0</persist>
              <value>${msg(config.superpassword.servicepassword.explanation.windows)}</value>
            </setInstallerVariable>

            <!-- servicepassword is provided through the command-line, this input will be only for superpassword -->
            <setInstallerVariable>
              <name>_explanation</name>
              <value>${msg(config.superpassword.cliservicepassword.explanation.windows)}</value>
              <ruleList>
                <stringTest text="${cliServicePassword}" type="not_empty"/>
              </ruleList>
            </setInstallerVariable>

            <!-- upgrade mode & servicepassword is provided through the command-line. -->
            <setInstallerVariable>
              <name>_explanation</name>
              <value>${msg(config.superpassword.servicepassword.upgrade.explanation.windows)}</value>
              <ruleList>
                <stringTest text="${cliServicePassword}" type="empty"/>
                <isTrue value="${IsUpgrade}"/>
              </ruleList>
            </setInstallerVariable>

          </actionList>
          <ruleList>
            <compareText logic="equals" text="${platform_name}" value="windows"/>
          </ruleList>
        </actionGroup>
        <!-- pgagent group -->
        <actionGroup>
          <actionList>
            <setInstallerVariableFromRegEx>
              <name>pgagent_installer_schema_version</name>
              <text>PG_VERSION_PGAGENT</text>
              <!-- PG_VERSION_PGAGENT -->
              <pattern>^([0-9]*).(.*)$</pattern>
              <substitution>\1</substitution>
            </setInstallerVariableFromRegEx>

            <setInstallerVariable name="pgagent_schema_exist" value="0"/>
            <setInstallerVariable name="pgagent_schema_version_function_exist" value="0"/>
            <setInstallerVariable name="pgagent_current_schema_version" value=""/>
            <setInstallerVariable name="schema" value="install"/>

          </actionList>
          <ruleList>
            <isTrue value="${component(pgagent).selected}"/>
          </ruleList>
        </actionGroup>
        <!-- Ends pgagent group -->
      </preShowPageActionList>
      <ruleList>
        <ruleGroup>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
            <isTrue value="${component(postgis).selected}"/>
            <isTrue value="${component(pgagent).selected}"/>
            <isTrue value="${component(dbserver).selected}"/>
          </ruleList>
        </ruleGroup>
        <isFalse value="${extract_mode}"/>
      </ruleList>

      <validationActionList>

        <!-- Do not allow empty password -->
        <throwError>
          <text>${msg(config.superpassword.no.password)}</text>
          <ruleList>
            <stringTest>
              <text>${superpassword}</text>
              <type>empty</type>
            </stringTest>
          </ruleList>
        </throwError>

        <!-- START: Authentication for the super-password -->
        <!-- Set variable psql_path -->
        <!-- Set variable psql_path -->
        <setInstallerVariable name="psql_path" value="${installdir}/bin/psql">
          <ruleList>
            <compareText>
              <logic>does_not_equal</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariable>
        <setInstallerVariable name="psql_path" value="${installdir}\bin\psql.exe">
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${platform_name}</text>
              <value>windows</value>
            </compareText>
          </ruleList>
        </setInstallerVariable>

        <!-- Set Environment variable PGHOST, PGUSER, PGPASSWORD, PGPORT, PGDATABASE
             on all the platform & LD_LIBRARY_PATH on linux/linux-x64 -->
        <setEnvironmentVariable name="PGHOST" value="localhost"/>
        <setEnvironmentVariable name="PGUSER" value="${supername}"/>
        <setEnvironmentVariable name="PGPASSWORD" value="${superpassword}"/>
        <setEnvironmentVariable name="PGPORT" value="${serverport}"/>
        <setEnvironmentVariable name="PGDATABASE" value="postgres"/>
        <setEnvironmentVariable name="LD_LIBRARY_PATH" value="${installdir}/lib">
          <ruleList>
            <compareText logic="contains" text="${platform_name}" value="linux"/>
          </ruleList>
        </setEnvironmentVariable>

        <setInstallerVariable>
          <name>connection</name>
          <value/>
        </setInstallerVariable>

        <setInstallerVariableFromScriptOutput>
          <exec>${psql_path}</exec>
          <execArgs>-l</execArgs>
          <name>connection</name>
          <workingDirectory>${installdir}/bin</workingDirectory>
          <abortOnError>1</abortOnError>
          <showMessageOnError>1</showMessageOnError>
          <customErrorMessage>${program_stderr}</customErrorMessage>
          <ruleList>
            <fileExists path="${psql_path}"/>
            <isTrue value="${IsUpgrade}"/>
          </ruleList>
        </setInstallerVariableFromScriptOutput>
        <!-- END: Authentication for the super-password -->

        <!-- Check for the template_postgis database exist -->
        <actionGroup>
          <actionList>
            <setInstallerVariable>
              <name>template_postgis_exists</name>
              <value/>
            </setInstallerVariable>
            <setInstallerVariableFromScriptOutput>
              <exec>${psql_path}</exec>
              <execArgs>-t -c "SELECT d.datname FROM pg_catalog.pg_database d WHERE d.datname='template_postgis'"</execArgs>
              <name>template_postgis_exists</name>
              <workingDirectory>${installdir}/bin</workingDirectory>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
            </setInstallerVariableFromScriptOutput>

            <actionGroup>
              <actionList>
                <showQuestion>
                  <default>yes</default>
                  <text>${msg(templatedb.found.info)}</text>
                  <variable>response</variable>
                </showQuestion>
                <setInstallerVariable name="templatedbexists" value="yes"/>
              </actionList>
              <ruleList>
                <stringTest>
                  <type>not_empty</type>
                  <text>${template_postgis_exists}</text>
                </stringTest>
              </ruleList>
            </actionGroup>
            <componentSelection>
              <deselect>postgis</deselect>
              <ruleList>
                <compareText>
                  <logic>equals</logic>
                  <text>${response}</text>
                  <value>no</value>
                </compareText>
              </ruleList>
            </componentSelection>
          </actionList>
          <ruleList>
              <isTrue value="${component(postgis).selected}"/>
              <stringTest type="not_empty" text="${connection}"/>
              <fileExists path="${psql_path}"/>
          </ruleList>
        </actionGroup>

        <!-- pgAgent Checks starts here-->
        <actionGroup>
          <actionList>
            <!-- Check for existing pgagent schema -->
            <setInstallerVariableFromScriptOutput exec="${psql_path}"
                                                  execArgs="-t -c &quot;SELECT has_schema_privilege('pgagent', 'USAGE')&quot;"
                                                  name="pgagent_schema_exist"
                                                  showMessageOnError="0"
                                                  abortOnError="0"
                                                  workingDirectory="${installdir}/bin"/>
            <stringModify text="${pgagent_schema_exist}" variable="pgagent_schema_exist" logic="trim"/>

            <!-- Check for pgagent_schema_version function exist -->
            <setInstallerVariableFromScriptOutput exec="${psql_path}"
                                                  execArgs="-t -c &quot;SELECT COUNT(*) FROM pg_proc WHERE proname = 'pgagent_schema_version' AND pronamespace = (SELECT oid FROM pg_namespace WHERE nspname = 'pgagent') AND prorettype = (SELECT oid FROM pg_type WHERE typname = 'int2') AND proargtypes = ''&quot;"
                                                  name="pgagent_schema_version_function_exist"
                                                  showMessageOnError="0"
                                                  abortOnError="0"
                                                  workingDirectory="${installdir}/bin">
              <ruleList>
                <stringTest type="not_empty" text="${pgagent_schema_exist}"/>
              </ruleList>
            </setInstallerVariableFromScriptOutput>
            <stringModify text="${pgagent_schema_version_function_exist}" variable="pgagent_schema_version_function_exist" logic="trim"/>

            <!-- Check for the current version of the pgagent schema -->
            <setInstallerVariableFromScriptOutput exec="${psql_path}"
                                                  execArgs="-t -c &quot;SELECT pgagent.pgagent_schema_version()&quot;"
                                                  name="pgagent_current_schema_version"
                                                  showMessageOnError="0"
                                                  abortOnError="0"
                                                  workingDirectory="${installdir}/bin">
              <ruleList>
                <stringTest type="not_empty" text="${pgagent_schema_exist}"/>
                <stringTest type="not_empty" text="${pgagent_schema_version_function_exist}"/>
              </ruleList>
            </setInstallerVariableFromScriptOutput>
            <stringModify text="${pgagent_current_schema_version}" variable="pgagent_current_schema_version" logic="trim"/>


            <!-- 1. pgagent schema exist and pgagent_schema_version function does not exist -->
            <showQuestion text="${msg(pgagent.schema.older.exist)}" variable="upgrade_schema">
              <ruleList>
                <compareText logic="does_not_equal" text="${pgagent_schema_version_function_exist}" value="1"/>
                <stringTest type="not_empty" text="${pgagent_schema_exist}"/>
              </ruleList>
            </showQuestion>

            <setInstallerVariable name="schema" persist="0" value="upgrade">
              <ruleList>
                <compareText logic="equals" text="${upgrade_schema}" value="yes"/>
                <compareText logic="does_not_equal" text="${pgagent_schema_version_function_exist}" value="1"/>
                <stringTest type="not_empty" text="${pgagent_schema_exist}"/>
              </ruleList>
            </setInstallerVariable>

            <setInstallerVariable name="schema" persist="0" value="none">
              <ruleList>
                <compareText logic="equals" text="${upgrade_schema}" value="no"/>
                <compareText logic="does_not_equal" text="${pgagent_schema_version_function_exist}" value="1"/>
                <stringTest type="not_empty" text="${pgagent_schema_exist}"/>
              </ruleList>
            </setInstallerVariable>

            <!-- 2. pgagnet schema exist and pgagent_schema_version function exists,
                but current_schema_version less than the installer_schema_version -->
            <showQuestion text="${msg(pgagent.schema.older.version.exist)}" variable="upgrade_schema">
              <ruleList>
                <isTrue value="${pgagent_schema_version_function_exist}"/>
                <compareValues logic="less" value1="${pgagent_current_schema_version}" value2="${pgagent_installer_schema_version}"/>
              </ruleList>
            </showQuestion>

            <setInstallerVariable name="schema" persist="0" value="upgrade">
              <ruleList>
                <compareText logic="equals" text="${upgrade_schema}" value="yes"/>
                <isTrue value="${pgagent_schema_version_function_exist}"/>
                <compareValues logic="less" value1="${pgagent_current_schema_version}" value2="${pgagent_installer_schema_version}"/>
              </ruleList>
            </setInstallerVariable>

            <setInstallerVariable name="schema" persist="0" value="none">
              <ruleList>
                <compareText logic="equals" text="${upgrade_schema}" value="no"/>
                <isTrue value="${pgagent_schema_version_function_exist}"/>
                <compareValues logic="less" value1="${pgagent_current_schema_version}" value2="${pgagent_installer_schema_version}"/>
              </ruleList>
            </setInstallerVariable>

            <!-- 3. pgagnet schema exist and pgagent_schema_version function exists,
                and current_schema_version matches the installer_schema_version -->
            <actionGroup>
              <actionList>
                <showInfo text="${msg(pgagent.schema.found)}"/>
                <setInstallerVariable name="schema" persist="0" value="exists"/>
              </actionList>
              <ruleList>
                <isTrue value="${pgagent_schema_version_function_exist}"/>
                <compareValues logic="equals" value1="${pgagent_current_schema_version}" value2="${pgagent_installer_schema_version}"/>
              </ruleList>
            </actionGroup>

            <!-- 4. pgagnet schema exist and pgagent_schema_version function exists,
                but current_schema_version greater than the installer_schema_version -->
            <actionGroup>
              <actionList>
                <throwError text="${msg(pgagent.schema.newer.version.exist)}"/>
                <setInstallerVariable name="next_page" value="sysuserdetails"/>
              </actionList>
              <ruleList>
                <isTrue value="${pgagent_schema_version_function_exist}"/>
                <compareValues logic="greater" value1="${pgagent_current_schema_version}" value2="${pgagent_installer_schema_version}"/>
              </ruleList>
            </actionGroup>

          </actionList>
          <ruleList>
            <stringTest type="not_empty" text="${connection}"/>
            <fileExists path="${psql_path}"/>
            <isTrue value="${component(pgagent).selected}"/>
            <isTrue value="${IsUpgrade}"/>
          </ruleList>
        </actionGroup>
        <!-- pgagent Checks ends here -->

        <!-- START: System user authention -->
        <setInstallerVariable name="user_authentication_error" value=""/>

        <actionGroup>
          <actionList>
            <!-- servicepassword and superpassword will same, if servicepassword is not provided as the command-line argument. -->
            <setInstallerVariable name="servicepassword" value="${superpassword}">
              <ruleList>
                <stringTest text="${cliServicePassword}" type="empty"/>
              </ruleList>
            </setInstallerVariable>
    
            <actionGroup>
              <actionList>
                <setInstallerVariable name="project.parameter(servicepassword).ask" value="1"/>
                <runProgram>
                  <program>${ppss_temp_directory}\createuser.exe</program>
                  <!-- The dot at the beginning of the arguments is the domain -->
                  <programArguments>"${servicedomain}" "${serviceaccount_wo_domain}" "${servicepassword.password}"</programArguments>
                  <abortOnError>0</abortOnError>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>
                <setInstallerVariable name="createuser_exist_code" value="${program_exit_code}"/>
                <setInstallerVariable>
                  <name>user_authentication_error</name>
                  <value>${msg(script.command.line.error)}</value>
                  <ruleList>
                    <compareText logic="equals" text="127" value="${createuser_exist_code}"/>
                  </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                  <name>user_authentication_error</name>
                  <value>${msg(error.could.not.create.user)}</value>
                  <ruleList>
                    <compareText logic="does_not_equal" text="2224" value="${createuser_exist_code}"/>
                    <compareText logic="does_not_equal" text="2203" value="${createuser_exist_code}"/>
                    <compareText logic="does_not_equal" text="2245" value="${createuser_exist_code}"/>
                    <compareText logic="does_not_equal" text="0" value="${createuser_exist_code}"/>
                    <stringTest type="empty" text="${user_authentication_error}"/>
                  </ruleList>
                </setInstallerVariable>
                <actionGroup>
                  <actionList>
                    <setInstallerVariable>
                      <name>user_authentication_error</name>
                      <value>${msg(config.superpassword.format.error.windows)}</value>
                      <ruleEvaluationLogic>or</ruleEvaluationLogic>
                      <ruleList>
                        <compareText logic="equals" text="2203" value="${createuser_exist_code}"/>
                        <compareText logic="equals" text="2245" value="${createuser_exist_code}"/>
                      </ruleList>
                    </setInstallerVariable>
                  </actionList>
                  <ruleList>
                    <stringTest type="empty" text="${user_authentication_error}"/>
                  </ruleList>
                </actionGroup>
              </actionList>
            </actionGroup>
    
            <!-- On Windows we need to validate the password if the user account exists -->
            <actionGroup>
              <actionList>
                <runProgram>
                  <abortOnError>0</abortOnError>
                  <program>${ppss_temp_directory}\validateuser.exe</program>
                  <programArguments>"${servicedomain}" "${serviceaccount_wo_domain}" "${servicepassword.password}"</programArguments>
                  <showMessageOnError>0</showMessageOnError>
                </runProgram>
                <setInstallerVariable name="validateuser_exit_code" value="${program_exit_code}"/>
                <setInstallerVariable>
                  <name>user_authentication_error</name>
                  <value>${msg(script.command.line.error)}</value>
                  <ruleList>
                    <compareText logic="equals" text="127" value="${validateuser_exit_code}"/>
                  </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                  <name>user_authentication_error</name>
                  <value>${msg(config.servicepassword.incorrect)}</value>
                  <ruleList>
                    <stringTest type="empty" text="${user_authentication_error}"/>
                    <compareText logic="does_not_equal" text="0" value="${validateuser_exit_code}"/>
                  </ruleList>
                </setInstallerVariable>
              </actionList>
              <ruleList>
                <stringTest type="empty" text="${user_authentication_error}"/>
              </ruleList>
            </actionGroup>
    
            <actionGroup>
              <actionList>
                <!-- INSTALLATIOIN MODE: Use the same page in user authenticaion for both super-password/service-password -->
                <throwError>
                  <text>${user_authentication_error}</text>
                  <ruleList>
                    <isFalse value="${IsUpgrade}"/>
                    <stringTest type="empty" text="${cliServicePassword}"/>
                  </ruleList>
                </throwError>
                <!-- UPGRADE MODE, But only data directory exists -->
                <throwError>
                  <text>${user_authentication_error}</text>
                  <ruleList>
                    <isTrue value="${IsUpgrade}"/>
            	    <fileTest condition="not_exists" path="${psql_path}"/>
            	    <fileTest condition="not_exists" path="${installdir}\bin\postgres.exe"/>
                    <stringTest type="empty" text="${cliServicePassword}"/>
                  </ruleList>
                </throwError>
                <!-- Show different pages for the service-password, when service-password could be different from the super-password in upgrade mode -->
                <setInstallerVariable name="project.parameter(servicepassword).ask" value="1"/>
              </actionList>
              <ruleList>
                <stringTest type="not_empty" text="${user_authentication_error}"/>
              </ruleList>
            </actionGroup>
            <setInstallerVariable name="project.parameter(servicepassword).ask" value="0">
              <ruleList>
                <stringTest type="empty" text="${user_authentication_error}"/>
              </ruleList>
            </setInstallerVariable>
          </actionList>
          <ruleList>
            <compareText text="${platform_name}" logic="equals" value="windows"/>
          </ruleList>
        </actionGroup>
        <!-- START: System user authention -->

      </validationActionList>
    </passwordParameter>

    <passwordParameter name="servicepassword" ask="1" cliOptionShow="1" cliOptionName="servicepassword">
      <description>${msg(config.servicepassword.description)}</description>
      <explanation>${msg(config.servicepassword.explanation)}</explanation>
      <descriptionRetype>${msg(config.superpassword.confirm)}</descriptionRetype>
      <ruleList>
        <compareText text="${platform_name}" logic="equals" value="windows"/>
        <isFalse value="${extract_mode}"/>
      </ruleList>
      <validationActionList>

        <!-- START: System user authention -->
        <actionGroup>
          <actionList>
            <runProgram>
              <program>${ppss_temp_directory}\createuser.exe</program>
              <!-- The dot at the beginning of the arguments is the domain -->
              <programArguments>"${servicedomain}" "${serviceaccount_wo_domain}" "${servicepassword.password}"</programArguments>
              <abortOnError>0</abortOnError>
              <showMessageOnError>0</showMessageOnError>
            </runProgram>
            <setInstallerVariable name="createuser_exit_code" value="${program_exit_code}"/>
    
            <throwError>
              <text>${msg(script.command.line.error)}</text>
              <ruleList>
                <compareText logic="equals" text="127" value="${createuser_exit_code}"/>
              </ruleList>
            </throwError>
    
            <throwError>
              <text>${msg(error.could.not.create.user)}</text>
              <ruleList>
                <compareText logic="does_not_equal" text="2224" value="${createuser_exit_code}"/>
                <compareText logic="does_not_equal" text="2203" value="${createuser_exit_code}"/>
                <compareText logic="does_not_equal" text="2245" value="${createuser_exit_code}"/>
                <compareText logic="does_not_equal" text="0" value="${createuser_exit_code}"/>
              </ruleList>
            </throwError>
    
            <throwError>
              <text>${msg(config.superpassword.format.error.windows)}</text>
              <ruleEvaluationLogic>or</ruleEvaluationLogic>
              <ruleList>
                <compareText logic="equals" text="2203" value="${createuser_exit_code}"/>
                <compareText logic="equals" text="2245" value="${createuser_exit_code}"/>
              </ruleList>
            </throwError>
    
            <!-- On Windows we need to validate the password if the user account exists -->
            <runProgram>
              <abortOnError>0</abortOnError>
              <program>${ppss_temp_directory}\validateuser.exe</program>
              <programArguments>"${servicedomain}" "${serviceaccount_wo_domain}" "${servicepassword.password}"</programArguments>
              <showMessageOnError>0</showMessageOnError>
            </runProgram>
            <setInstallerVariable name="validateuser_exit_code" value="${program_exit_code}"/>
            <throwError>
              <text>${msg(script.command.line.error)}</text>
              <ruleList>
                <compareText logic="equals" text="127" value="${validateuser_exit_code}"/>
              </ruleList>
            </throwError>
            <throwError>
              <text>${msg(config.servicepassword.incorrect)}</text>
              <ruleList>
                <isTrue value="${validateuser_exit_code}"/>
              </ruleList>
            </throwError>
          </actionList>
          <ruleList>
            <compareText text="${platform_name}" logic="equals" value="windows"/>
          </ruleList>
        </actionGroup>
        <!-- START: System user authention -->

      </validationActionList>

    </passwordParameter>

    <!-- Port number. Only show if there is no data directory -->
    <parameterGroup>
      <name>PortLocale</name>
      <title>${msg(portlocale.title.value)}</title>
      <explanation></explanation>
      <value></value>
      <default></default>
      <parameterList>
        <stringParameter>
          <name>serverport</name>
          <description>${msg(config.port.description)}</description>
          <explanation>${msg(config.port.explanation)}</explanation>
          <value></value>
          <default>${defaultport}</default>
          <allowEmptyValue>1</allowEmptyValue>
          <ask>yes</ask>
          <cliOptionName>serverport</cliOptionName>
          <width>30</width>
          <validationActionList>
            <throwError>
              <text>${msg(config.port.invalid)}</text>
              <ruleList>
                <stringTest>
                  <text>${serverport}</text>
                  <type>not_digit</type>
                </stringTest>
              </ruleList>
            </throwError>
            <throwError>
              <text>${msg(config.port.invalid)}</text>
              <ruleList>
                <stringTest>
                  <text>${serverport}</text>
                  <type>empty</type>
                </stringTest>
              </ruleList>
            </throwError>
            <throwError>
              <text>${msg(config.port.invalid)}</text>
              <ruleEvaluationLogic>or</ruleEvaluationLogic>
              <ruleList>
                <compareValues>
                  <logic>less</logic>
                  <value1>${serverport}</value1>
                  <value2>1024</value2>
                </compareValues>
                <compareValues>
                  <logic>greater</logic>
                  <value1>${serverport}</value1>
                  <value2>65535</value2>
                </compareValues>
              </ruleList>
            </throwError>
            <throwError>
              <text>${msg(config.port.in.use)}</text>
              <ruleList>
                <portTest>
                  <condition>cannot_bind</condition>
                  <port>${serverport}</port>
                </portTest>
                <compareText>
                  <logic>equals</logic>
                  <text>${component(dbserver).selected}</text>
                  <value>1</value>
                </compareText>
              </ruleList>
            </throwError>

            <!--Ends here -->
          </validationActionList>
        </stringParameter>

        <!-- Locale -->
        <choiceParameter>
          <name>locale</name>
          <description>${msg(config.locale.description)}</description>
          <explanation>${msg(config.locale.explanation)}</explanation>
          <value></value>
          <default></default>
          <allowEmptyValue>1</allowEmptyValue>
          <ask>yes</ask>
          <cliOptionName>locale</cliOptionName>
          <displayType>combobox</displayType>
          <width>30</width>
          <ruleList>
            <compareText>
              <logic>equals</logic>
              <text>${component(dbserver).selected}</text>
              <value>1</value>
            </compareText>
            <compareValues>
              <logic>equals</logic>
              <value1>${IsUpgrade}</value1>
              <value2>0</value2>
            </compareValues>
          </ruleList>
          <validationActionList>
            <throwError>
              <text>${msg(config.locale.no.locale)}</text>
              <ruleList>
                <stringTest>
                  <text>${locale}</text>
                  <type>empty</type>
                </stringTest>
              </ruleList>
            </throwError>
          </validationActionList>
        </choiceParameter>
      </parameterList>
      <ruleList>
        <compareText>
          <logic>equals</logic>
          <text>${component(dbserver).selected}</text>
          <value>1</value>
        </compareText>
        <compareText>
          <logic>does_not_equal</logic>
          <text>${IsUpgrade}</text>
          <value>1</value>
        </compareText>
        <isFalse value="${extract_mode}"/>
      </ruleList>
    </parameterGroup>
  </parameterList>
</project>
